{
    "Event":{
        "threat_level_id":"1",
        "date":"2023-04-13",
        "published":true,
        "info":"SNOWYAMBER - Malware Analysis Report",
        "publish_timestamp":"1681802291",
        "timestamp":"1681739653",
        "Tag":[
            {
                "name":"type:OSINT"
            },
            {
                "name":"osint:lifetime=\"perpetual\""
            },
            {
                "name":"osint:certainty=\"50\""
            },
            {
                "name":"tlp:white"
            },
            {
                "name":"tlp:clear"
            },
            {
                "name":"misp-galaxy:tool=\"SNOWYAMBER\""
            },
            {
                "name":"misp-galaxy:mitre-attack-pattern=\"Virtual Private Server - T1583.003\""
            },
            {
                "name":"misp-galaxy:mitre-attack-pattern=\"Web Services - T1583.006\""
            },
            {
                "name":"misp-galaxy:mitre-attack-pattern=\"Compromise Infrastructure - T1584\""
            },
            {
                "name":"misp-galaxy:mitre-attack-pattern=\"Phishing - T1566\""
            },
            {
                "name":"misp-galaxy:mitre-attack-pattern=\"Spearphishing Attachment - T1566.001\""
            },
            {
                "name":"misp-galaxy:mitre-attack-pattern=\"Spearphishing Link - T1566.002\""
            },
            {
                "name":"misp-galaxy:mitre-attack-pattern=\"User Execution - T1204\""
            },
            {
                "name":"misp-galaxy:mitre-attack-pattern=\"Malicious File - T1204.002\""
            },
            {
                "name":"misp-galaxy:mitre-attack-pattern=\"Malicious Link - T1204.001\""
            },
            {
                "name":"misp-galaxy:mitre-attack-pattern=\"Registry Run Keys / Startup Folder - T1547.001\""
            },
            {
                "name":"misp-galaxy:mitre-attack-pattern=\"DLL Search Order Hijacking - T1574.001\""
            },
            {
                "name":"misp-galaxy:mitre-attack-pattern=\"DLL Side-Loading - T1574.002\""
            },
            {
                "name":"misp-galaxy:mitre-attack-pattern=\"HTML Smuggling - T1027.006\""
            },
            {
                "name":"misp-galaxy:mitre-attack-pattern=\"Right-to-Left Override - T1036.002\""
            },
            {
                "name":"misp-galaxy:mitre-attack-pattern=\"Deobfuscate/Decode Files or Information - T1140\""
            },
            {
                "name":"misp-galaxy:mitre-attack-pattern=\"Mark-of-the-Web Bypass - T1553.005\""
            },
            {
                "name":"misp-galaxy:mitre-attack-pattern=\"Web Service - T1102\""
            },
            {
                "name":"misp-galaxy:mitre-attack-pattern=\"One-Way Communication - T1102.003\""
            }
        ],
        "Attribute":[
            {
                "category":"External analysis",
                "comment":"phishing email mimicking diplomatic correspondence. The link hidden under “here” leads to the ENVYSCOUT",
                "timestamp":"1681726432",
                "type":"attachment",
                "value":"PhishMailImpers1.png",
                "to_ids":false
            },
            {
                "category":"Network activity",
                "comment":"ENVYSCOUT delivering SNOWYAMBER ZIP",
                "timestamp":"1681738835",
                "type":"url",
                "value":"totalmassasje.no/schedule.php",
                "to_ids":true
            },
            {
                "category":"Network activity",
                "comment":"ENVYSCOUT delivering SNOWYAMBER ISO",
                "timestamp":"1681738835",
                "type":"url",
                "value":"signitivelogics.com/Schedule.html",
                "to_ids":true
            },
            {
                "category":"Network activity",
                "comment":"Cobalt Strike Team Server",
                "timestamp":"1681738835",
                "type":"url",
                "value":"humanecosmetics.com/category/noteworthy/6426-7346-9789",
                "to_ids":true
            },
            {
                "category":"Network activity",
                "comment":"ENVYSCOUT delivering SNOWYAMBER ISO",
                "timestamp":"1681738835",
                "type":"url",
                "value":"signitivelogics.com/BMW.html",
                "to_ids":true
            },
            {
                "category":"Network activity",
                "comment":"BRUTERATEL C2",
                "timestamp":"1681738835",
                "type":"domain",
                "value":"badriatimimi.com",
                "to_ids":true
            },
            {
                "category":"Network activity",
                "comment":"ENVYSCOUT delivering SNOWYAMBER ZIP",
                "timestamp":"1681738835",
                "type":"url",
                "value":"literaturaelsalvador.com/Instructions.html",
                "to_ids":true
            },
            {
                "category":"Network activity",
                "comment":"ENVYSCOUT delivering SNOWYAMBER ISO",
                "timestamp":"1681738835",
                "type":"url",
                "value":"literaturaelsalvador.com/Schedule.html",
                "to_ids":true
            },
            {
                "category":"Network activity",
                "comment":"ENVYSCOUT URL",
                "timestamp":"1681738835",
                "type":"url",
                "value":"parquesanrafael.cl/note.html",
                "to_ids":true
            },
            {
                "category":"Network activity",
                "comment":"ENVYSCOUT URL",
                "timestamp":"1681738835",
                "type":"url",
                "value":"inovaoftalmologia.com.br/form.html",
                "to_ids":true
            },
            {
                "category":"Payload delivery",
                "comment":"Used to distribute phishing emails with a link to ENVYSCOUT",
                "timestamp":"1681739023",
                "type":"email-src",
                "value":"miodrag.sekulic@mod.gov.rs",
                "to_ids":true
            },
            {
                "category":"Payload delivery",
                "comment":"Used to distribute phishing emails with a link to ENVYSCOUT",
                "timestamp":"1681739023",
                "type":"email-src",
                "value":"bohuslava.kopalova@seznam.cz",
                "to_ids":true
            },
            {
                "category":"Payload delivery",
                "comment":"Used to distribute phishing emails with a link to i.php (reconnaissance?)",
                "timestamp":"1681739023",
                "type":"email-src",
                "value":"navratilova.lucie.etnologie@seznam.cz",
                "to_ids":true
            },
            {
                "category":"Payload delivery",
                "comment":"Used to distribute phishing emails with a link to ENVYSCOUT",
                "timestamp":"1681739023",
                "type":"email-src",
                "value":"zdenek.holych@seznam.cz",
                "to_ids":true
            }
        ],
        "Object":[
            {
                "comment":"",
                "description":"Metadata used to generate an executive level report",
                "meta-category":"misc",
                "name":"report",
                "timestamp":"1681726216",
                "Attribute":[
                    {
                        "category":"External analysis",
                        "comment":"",
                        "timestamp":"1681726216",
                        "type":"link",
                        "value":"https://www.gov.pl/attachment/ee91f24d-3e67-436d-aa50-7fa56acf789d",
                        "to_ids":false
                    },
                    {
                        "category":"Other",
                        "comment":"",
                        "timestamp":"1681726216",
                        "type":"text",
                        "value":"SNOWYAMBER is a dropper that was used in an espionage campaign significantly overlapping with publicly described activity linked to the APT29 and NOBELIUM activity sets. SNOWYAMBER abuses the NOTION collaboration service as a communication channel. It does not contain any other capabilities aside from downloading and executing 2nd stage. To bypass security products, SNOWYAMBER uses several antidetection and obfuscation techniques, including string encryption, dynamic API resolving, EDR/AV unhooking, and direct syscalls.",
                        "to_ids":false
                    },
                    {
                        "category":"Other",
                        "comment":"",
                        "timestamp":"1681726216",
                        "type":"text",
                        "value":"Report",
                        "to_ids":false
                    },
                    {
                        "category":"External analysis",
                        "comment":"",
                        "timestamp":"1681726216",
                        "type":"attachment",
                        "value":"SNOWYAMBER_.pdf",
                        "to_ids":false
                    }
                ]
            },
            {
                "comment":"",
                "description":"File object describing a file with meta-information",
                "meta-category":"file",
                "name":"file",
                "timestamp":"1681731313",
                "Attribute":[
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681730403",
                        "type":"filename",
                        "value":"vcruntime140.dll",
                        "to_ids":true
                    }
                ]
            },
            {
                "comment":"",
                "description":"File object describing a file with meta-information",
                "meta-category":"file",
                "name":"file",
                "timestamp":"1681731274",
                "Attribute":[
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681730487",
                        "type":"filename",
                        "value":"schedule.zip",
                        "to_ids":true
                    }
                ]
            },
            {
                "comment":"",
                "description":"File object describing a file with meta-information",
                "meta-category":"file",
                "name":"file",
                "timestamp":"1681736959",
                "Attribute":[
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681736959",
                        "type":"filename",
                        "value":"7za.dll",
                        "to_ids":true
                    },
                    {
                        "category":"Other",
                        "comment":"",
                        "timestamp":"1681736959",
                        "type":"size-in-bytes",
                        "value":"270336",
                        "to_ids":false
                    },
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681736959",
                        "type":"sha1",
                        "value":"<sha1>",
                        "to_ids":true
                    },
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681736959",
                        "type":"md5",
                        "value":"<md5>",
                        "to_ids":true
                    },
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681736959",
                        "type":"sha256",
                        "value":"<sha256>",
                        "to_ids":true
                    }
                ]
            },
            {
                "comment":"",
                "description":"File object describing a file with meta-information",
                "meta-category":"file",
                "name":"file",
                "timestamp":"1681731328",
                "Attribute":[
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681730507",
                        "type":"filename",
                        "value":"november_schedulexe.pdf",
                        "to_ids":true
                    }
                ]
            },
            {
                "comment":"",
                "description":"File object describing a file with meta-information",
                "meta-category":"file",
                "name":"file",
                "timestamp":"1681732508",
                "Attribute":[
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681732508",
                        "type":"filename",
                        "value":"Instructions.lnk",
                        "to_ids":true
                    }
                ]
            },
            {
                "comment":"It seems that the adversary made a mistake while compiling this sample. Internal functions were added to exports (authored by the adversary as well as those from libraries: SysWhispers3, Nlohmann JSON, Obfuscate). While binary itself is stripped, those exported functions have names that can be demangled revealing naming, prototypes and datatypes.",
                "description":"File object describing a file with meta-information",
                "meta-category":"file",
                "name":"file",
                "timestamp":"1681737208",
                "Attribute":[
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681737208",
                        "type":"filename",
                        "value":"BugSplatRc64.dll",
                        "to_ids":true
                    },
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681737208",
                        "type":"sha1",
                        "value":"<sha1>",
                        "to_ids":true
                    },
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681737208",
                        "type":"md5",
                        "value":"<md5>",
                        "to_ids":true
                    },
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681737208",
                        "type":"sha256",
                        "value":"<sha256>",
                        "to_ids":true
                    },
                    {
                        "category":"Other",
                        "comment":"",
                        "timestamp":"1681737208",
                        "type":"size-in-bytes",
                        "value":"271360",
                        "to_ids":false
                    }
                ]
            },
            {
                "comment":"",
                "description":"An object describing a YARA rule (or a YARA rule name) along with its version.",
                "meta-category":"misc",
                "name":"yara",
                "timestamp":"1681735978",
                "Attribute":[
                    {
                        "category":"Payload installation",
                        "comment":"",
                        "timestamp":"1681735978",
                        "type":"yara",
                        "value":"rule APT29_SNOWYAMBER\r\n{\r\nmeta:\r\ndescription = \"Detects APT29-linked SNOWYAMBER dropper\"\r\nstrings:\r\n// Payload decryption loop\r\n// Custom algorithm based on XOR\r\n$op_decrypt_payload = {49 8B 45 08 48 ?? ?? ?? 48 39 ?? 76 2B 48 89 C8 31 D2 4C 8B 4C 24 ?? 48 F7 74 24 ?? 49 8B 45\r\n00 41 8A 14 11 32 54 08 10 89 C8 41 0F AF C0 31 C2 88 14 0B 48 FF C1}\r\n// Decryption routine generated by Obfuscate library\r\n$op_decrypt_string = {48 39 D0 74 19 48 89 C1 4D 89 C2 83 E1 07 48 C1 E1 03 49 D3 EA 45 30 14 01 48 FF C0 EB E2}\r\n// Hardcoded inital value used as beaconing counter\r\n$op_initialize_emoji = {C6 [3] A5 66 [4] F0 9F}\r\n// src/json.hpp - string left in binary using nlohmann JSON\r\n$str_nlohmann = {73 72 63 2F 6A 73 6F 6E 2E 68 70 70 00}\r\ncondition:\r\nuint16(0) == 0x5A4D\r\nand\r\nfilesize < 500KB\r\nand\r\n$str_nlohmann\r\nand\r\n$op_decrypt_string\r\nand\r\n($op_initialize_emoji or $op_decrypt_payload)\r\n}",
                        "to_ids":true
                    },
                    {
                        "category":"Other",
                        "comment":"",
                        "timestamp":"1681735978",
                        "type":"text",
                        "value":"APT29_SNOWYAMBER",
                        "to_ids":false
                    }
                ]
            },
            {
                "comment":"",
                "description":"File object describing a file with meta-information",
                "meta-category":"file",
                "name":"file",
                "timestamp":"1681737803",
                "Attribute":[
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681737803",
                        "type":"sha1",
                        "value":"<sha1>",
                        "to_ids":true
                    },
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681737803",
                        "type":"md5",
                        "value":"<md5>",
                        "to_ids":true
                    },
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681737803",
                        "type":"sha256",
                        "value":"<sha256>",
                        "to_ids":true
                    },
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681737803",
                        "type":"filename",
                        "value":"BugSplatRc64.dll",
                        "to_ids":true
                    },
                    {
                        "category":"Other",
                        "comment":"",
                        "timestamp":"1681737803",
                        "type":"size-in-bytes",
                        "value":"301056",
                        "to_ids":false
                    }
                ]
            },
            {
                "comment":"2nd stage - CobaltStrike beacon (decrypted)",
                "description":"File object describing a file with meta-information",
                "meta-category":"file",
                "name":"file",
                "timestamp":"1681738413",
                "Attribute":[
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681738413",
                        "type":"sha1",
                        "value":"<sha1>",
                        "to_ids":true
                    },
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681738413",
                        "type":"md5",
                        "value":"<md5>",
                        "to_ids":true
                    },
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681738413",
                        "type":"sha256",
                        "value":"<sha256>",
                        "to_ids":true
                    },
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681738413",
                        "type":"filename",
                        "value":"hXaIk1725.pdf",
                        "to_ids":true
                    },
                    {
                        "category":"Other",
                        "comment":"",
                        "timestamp":"1681738413",
                        "type":"size-in-bytes",
                        "value":"261635",
                        "to_ids":false
                    }
                ]
            },
            {
                "comment":"2nd stage – BruteRatel stageless badger (decrypted)",
                "description":"File object describing a file with meta-information",
                "meta-category":"file",
                "name":"file",
                "timestamp":"1681738525",
                "Attribute":[
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681738525",
                        "type":"sha1",
                        "value":"<sha1>",
                        "to_ids":true
                    },
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681738525",
                        "type":"md5",
                        "value":"<md5>",
                        "to_ids":true
                    },
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681738525",
                        "type":"sha256",
                        "value":"<sha256>",
                        "to_ids":true
                    },
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681738525",
                        "type":"filename",
                        "value":"hXaIk1314.pdf",
                        "to_ids":true
                    },
                    {
                        "category":"Other",
                        "comment":"",
                        "timestamp":"1681738525",
                        "type":"size-in-bytes",
                        "value":"347837",
                        "to_ids":false
                    }
                ]
            }
        ]
    }
}