{
    "Event":{
        "threat_level_id":"1",
        "date":"2023-04-13",
        "published":true,
        "info":"QUARTERRIG - Malware Analysis Report",
        "publish_timestamp":"1682166797",
        "timestamp":"1682166784",
        "Tag":[
            {
                "name":"misp-galaxy:tool=\"QUARTERRIG\""
            },
            {
                "name":"misp-galaxy:mitre-attack-pattern=\"Virtual Private Server - T1583.003\""
            },
            {
                "name":"misp-galaxy:mitre-attack-pattern=\"Compromise Infrastructure - T1584\""
            },
            {
                "name":"misp-galaxy:mitre-attack-pattern=\"Phishing - T1566\""
            },
            {
                "name":"misp-galaxy:mitre-attack-pattern=\"Spearphishing Attachment - T1566.001\""
            },
            {
                "name":"misp-galaxy:mitre-attack-pattern=\"Spearphishing Link - T1566.002\""
            },
            {
                "name":"misp-galaxy:mitre-attack-pattern=\"User Execution - T1204\""
            },
            {
                "name":"misp-galaxy:mitre-attack-pattern=\"Malicious File - T1204.002\""
            },
            {
                "name":"misp-galaxy:mitre-attack-pattern=\"Registry Run Keys / Startup Folder - T1547.001\""
            },
            {
                "name":"misp-galaxy:mitre-attack-pattern=\"DLL Search Order Hijacking - T1574.001\""
            },
            {
                "name":"misp-galaxy:mitre-attack-pattern=\"DLL Side-Loading - T1574.002\""
            },
            {
                "name":"misp-galaxy:mitre-attack-pattern=\"HTML Smuggling - T1027.006\""
            },
            {
                "name":"misp-galaxy:mitre-attack-pattern=\"Deobfuscate/Decode Files or Information - T1140\""
            },
            {
                "name":"misp-galaxy:mitre-attack-pattern=\"Mark-of-the-Web Bypass - T1553.005\""
            },
            {
                "name":"type:OSINT"
            },
            {
                "name":"osint:lifetime=\"perpetual\""
            },
            {
                "name":"tlp:white"
            },
            {
                "name":"tlp:clear"
            }
        ],
        "Attribute":[
            {
                "category":"External analysis",
                "comment":"phishing email containing a PDF with a link to ENVYSCOUT delivering QUARTERRIG",
                "timestamp":"1681974807",
                "type":"attachment",
                "value":"phishing email containing a PDF with a link to ENVYSCOUT delivering QUARTERRIG.png",
                "to_ids":false
            },
            {
                "category":"External analysis",
                "comment":"phishing email containing a PDF with a link to ENVYSCOUT delivering QUARTERRIG",
                "timestamp":"1681974916",
                "type":"attachment",
                "value":"PDF containing a link to ENVYSCOUT.png",
                "to_ids":false
            },
            {
                "category":"External analysis",
                "comment":"PDF containing a link to ENVYSCOUT",
                "timestamp":"1681975186",
                "type":"attachment",
                "value":"PDF containing a link to ENVYSCOUT2.png",
                "to_ids":false
            },
            {
                "category":"Network activity",
                "comment":"QUARTERRIG C2 URL",
                "timestamp":"1681996406",
                "type":"url",
                "value":"pateke.com/auth/login.php",
                "to_ids":true
            },
            {
                "category":"Network activity",
                "comment":"QUARTERRIG C2 URL",
                "timestamp":"1681996406",
                "type":"url",
                "value":"pateke.com/index.php",
                "to_ids":true
            },
            {
                "category":"Network activity",
                "comment":"COBALT STRIKE Handler URL",
                "timestamp":"1681996406",
                "type":"url",
                "value":"gatewan.com/c/msdownload/update/others/2021/10/se9fW4z8WJtmMyPQu",
                "to_ids":true
            },
            {
                "category":"Network activity",
                "comment":"COBALT STRIKE Handler URL",
                "timestamp":"1681996406",
                "type":"url",
                "value":"gatewan.com/c/msdownload/update/others/2021/10/8PaDBDxLtokI3eH8",
                "to_ids":true
            },
            {
                "category":"Network activity",
                "comment":"QUARTERRIG C2 URL",
                "timestamp":"1681996406",
                "type":"url",
                "value":"sharpledge.com/login.php",
                "to_ids":true
            },
            {
                "category":"Network activity",
                "comment":"URL to ENYVYSCOUT used to deliver QUARTERRIG",
                "timestamp":"1681996407",
                "type":"url",
                "value":"sylvio.com.br/form.php",
                "to_ids":true
            },
            {
                "category":"Network activity",
                "comment":"Domain used to host ENVYSCOUT",
                "timestamp":"1681996407",
                "type":"hostname",
                "value":"sylvio.com.br",
                "to_ids":true
            }
        ],
        "Object":[
            {
                "comment":"",
                "description":"Metadata used to generate an executive level report",
                "meta-category":"misc",
                "name":"report",
                "timestamp":"1681910172",
                "Attribute":[
                    {
                        "category":"External analysis",
                        "comment":"",
                        "timestamp":"1681910172",
                        "type":"link",
                        "value":"https://www.gov.pl/attachment/6f51bb1a-3ad2-461c-a16d-408915a56f77",
                        "to_ids":false
                    },
                    {
                        "category":"Other",
                        "comment":"",
                        "timestamp":"1681910172",
                        "type":"text",
                        "value":"QUARTERRIG is a dropper that was used in an espionage campaign significantly overlapping with publicly described activity linked to the APT29 and NOBELIUM activity sets. QUARTERRIG does not contain any other capabilities aside from downloading and executing 2nd stage. To bypass security products, QUARTERRIG heavily relies on obfuscation based on opaque predicates and multi-stage execution, interweaving shellcode and PE files. HALFRIG and QUARTERRIG share some of the codebase, suggesting that QUARTERRIG authors have access to both HALFRIG source code and the same obfuscation libraries.",
                        "to_ids":false
                    },
                    {
                        "category":"Other",
                        "comment":"",
                        "timestamp":"1681910172",
                        "type":"text",
                        "value":"Report",
                        "to_ids":false
                    },
                    {
                        "category":"External analysis",
                        "comment":"",
                        "timestamp":"1681910172",
                        "type":"attachment",
                        "value":"QUARTERRIG_.pdf",
                        "to_ids":false
                    }
                ]
            },
            {
                "comment":"",
                "description":"An object describing a YARA rule (or a YARA rule name) along with its version.",
                "meta-category":"misc",
                "name":"yara",
                "timestamp":"1681991395",
                "Attribute":[
                    {
                        "category":"Other",
                        "comment":"",
                        "timestamp":"1681991395",
                        "type":"comment",
                        "value":"A rule that can be used to scan for QUARTERRIG",
                        "to_ids":false
                    },
                    {
                        "category":"External analysis",
                        "comment":"",
                        "timestamp":"1681991395",
                        "type":"link",
                        "value":"https://www.gov.pl/attachment/6e085a2c-ac05-4b62-9423-5d6e9ef730bf",
                        "to_ids":false
                    },
                    {
                        "category":"Payload installation",
                        "comment":"",
                        "timestamp":"1681991395",
                        "type":"yara",
                        "value":"rule apt29_QUARTERRIG {\r\nstrings:\r\n$str_dll_name = \"hijacker.dll\"\r\n$str_import_name = \"VCRUNTIME140.dll\"\r\n// 48 8B 15 39 6A 00 00\r\nmov\r\nrdx, cs:api_stuff.OpenThread\r\n// 48 8D 0D FA 68 00 00\r\nlea\r\nrcx, api_stuff\r\n// 8B D8\r\nmov\r\nebx, eax\r\n// E8 3F 25 00 00\r\ncall\r\nload_api_addr\r\n// 44 8B C3\r\nmov\r\nr8d, ebx\r\n// 33 D2\r\nxor\r\nedx, edx\r\n// B9 FF FF 1F 00\r\nmov\r\necx, 1FFFFFh\r\n// FF D0\r\ncall\r\nrax\r\n$op_resolve_and_call_openthread = { 48 [6] 48 [6] 8B D8 E8 [4] [3] 33 D2 B9 FF FF 1F 00 FF D0 }\r\n// E8 A0 25 00 00\r\ncall\r\nload_api_addr\r\n// 48 8B CB\r\nmov\r\nrcx, rbx\r\n// FF D0\r\ncall\r\nrax\r\n// 83 F8 FF\r\ncmp\r\neax, 0FFFFFFFFh\r\n$op_resolve_and_call_suspendthread = { E8 [4] 48 8B CB FF D0 83 F8 FF }\r\ncondition:\r\nall of them\r\n}",
                        "to_ids":true
                    },
                    {
                        "category":"Other",
                        "comment":"",
                        "timestamp":"1681991395",
                        "type":"text",
                        "value":"apt29_QUARTERRIG",
                        "to_ids":false
                    }
                ]
            },
            {
                "comment":"Virtual disc container\r\n",
                "description":"File object describing a file with meta-information",
                "meta-category":"file",
                "name":"file",
                "timestamp":"1682059182",
                "Attribute":[
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681991513",
                        "type":"sha1",
                        "value":"<sha1>",
                        "to_ids":true
                    },
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681991513",
                        "type":"md5",
                        "value":"<md5>",
                        "to_ids":true
                    },
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681991513",
                        "type":"sha256",
                        "value":"<sha256>",
                        "to_ids":true
                    },
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681991513",
                        "type":"filename",
                        "value":"Note.iso",
                        "to_ids":true
                    },
                    {
                        "category":"Other",
                        "comment":"",
                        "timestamp":"1681991513",
                        "type":"size-in-bytes",
                        "value":"2624000",
                        "to_ids":false
                    }
                ]
            },
            {
                "comment":"Legitimate executable used to load the malicious DLL",
                "description":"File object describing a file with meta-information",
                "meta-category":"file",
                "name":"file",
                "timestamp":"1681992221",
                "Attribute":[
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681992221",
                        "type":"sha1",
                        "value":"<sha1>",
                        "to_ids":true
                    },
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681992221",
                        "type":"md5",
                        "value":"<md5>",
                        "to_ids":true
                    },
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681992221",
                        "type":"sha256",
                        "value":"<sha256>",
                        "to_ids":true
                    },
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681992221",
                        "type":"filename",
                        "value":"Note.exe",
                        "to_ids":true
                    },
                    {
                        "category":"Other",
                        "comment":"",
                        "timestamp":"1681992221",
                        "type":"size-in-bytes",
                        "value":"1600000",
                        "to_ids":false
                    }
                ]
            },
            {
                "comment":"QUARTERRIG - loader\r\n",
                "description":"File object describing a file with meta-information",
                "meta-category":"file",
                "name":"file",
                "timestamp":"1681993008",
                "Attribute":[
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681993008",
                        "type":"sha1",
                        "value":"<sha1>",
                        "to_ids":true
                    },
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681993008",
                        "type":"md5",
                        "value":"<md5>",
                        "to_ids":true
                    },
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681993008",
                        "type":"sha256",
                        "value":"<sha256>",
                        "to_ids":true
                    },
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681993008",
                        "type":"filename",
                        "value":"AppvIsvSubsystems64.dll",
                        "to_ids":true
                    },
                    {
                        "category":"Other",
                        "comment":"",
                        "timestamp":"1681993008",
                        "type":"size-in-bytes",
                        "value":"28000",
                        "to_ids":false
                    }
                ]
            },
            {
                "comment":"",
                "description":"File object describing a file with meta-information",
                "meta-category":"file",
                "name":"file",
                "timestamp":"1681994371",
                "Attribute":[
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681994371",
                        "type":"sha1",
                        "value":"<sha1>",
                        "to_ids":true
                    },
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681994371",
                        "type":"md5",
                        "value":"<md5>",
                        "to_ids":true
                    },
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681994371",
                        "type":"sha256",
                        "value":"<sha256>",
                        "to_ids":true
                    },
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681994371",
                        "type":"filename",
                        "value":"bdcmetadataresource.xsd",
                        "to_ids":true
                    },
                    {
                        "category":"Other",
                        "comment":"",
                        "timestamp":"1681994371",
                        "type":"size-in-bytes",
                        "value":"456000",
                        "to_ids":false
                    }
                ]
            },
            {
                "comment":"Virtual disc container",
                "description":"File object describing a file with meta-information",
                "meta-category":"file",
                "name":"file",
                "timestamp":"1681994539",
                "Attribute":[
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681994539",
                        "type":"sha1",
                        "value":"<sha1>",
                        "to_ids":true
                    },
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681994539",
                        "type":"md5",
                        "value":"<md5>",
                        "to_ids":true
                    },
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681994539",
                        "type":"sha256",
                        "value":"<sha256>",
                        "to_ids":true
                    },
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681994539",
                        "type":"filename",
                        "value":"Invite.iso",
                        "to_ids":true
                    },
                    {
                        "category":"Other",
                        "comment":"",
                        "timestamp":"1681994539",
                        "type":"size-in-bytes",
                        "value":"6464000",
                        "to_ids":false
                    }
                ]
            },
            {
                "comment":"Legitimate executable used to load the malicious DLL",
                "description":"File object describing a file with meta-information",
                "meta-category":"file",
                "name":"file",
                "timestamp":"1681994789",
                "Attribute":[
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681994789",
                        "type":"sha1",
                        "value":"<sha1>",
                        "to_ids":true
                    },
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681994789",
                        "type":"md5",
                        "value":"<md5>",
                        "to_ids":true
                    },
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681994789",
                        "type":"sha256",
                        "value":"<sha256>",
                        "to_ids":true
                    },
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681994789",
                        "type":"filename",
                        "value":"Invite.exe",
                        "to_ids":true
                    },
                    {
                        "category":"Other",
                        "comment":"",
                        "timestamp":"1681994789",
                        "type":"size-in-bytes",
                        "value":"5380000",
                        "to_ids":false
                    }
                ]
            },
            {
                "comment":"QUATERRIG loader",
                "description":"File object describing a file with meta-information",
                "meta-category":"file",
                "name":"file",
                "timestamp":"1681994834",
                "Attribute":[
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681994834",
                        "type":"sha1",
                        "value":"<sha1>",
                        "to_ids":true
                    },
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681994834",
                        "type":"md5",
                        "value":"<md5>",
                        "to_ids":true
                    },
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681994834",
                        "type":"sha256",
                        "value":"<sha256>",
                        "to_ids":true
                    },
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681994835",
                        "type":"filename",
                        "value":"winhttp.dll",
                        "to_ids":true
                    },
                    {
                        "category":"Other",
                        "comment":"",
                        "timestamp":"1681994835",
                        "type":"size-in-bytes",
                        "value":"32000",
                        "to_ids":false
                    }
                ]
            },
            {
                "comment":"Encrypted resource containing the second stage",
                "description":"File object describing a file with meta-information",
                "meta-category":"file",
                "name":"file",
                "timestamp":"1681994920",
                "Attribute":[
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681994920",
                        "type":"sha1",
                        "value":"<sha1>",
                        "to_ids":true
                    },
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681994920",
                        "type":"md5",
                        "value":"<md5>",
                        "to_ids":true
                    },
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681994920",
                        "type":"sha256",
                        "value":"<sha256>",
                        "to_ids":true
                    },
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681994920",
                        "type":"filename",
                        "value":"Stamp.aapp",
                        "to_ids":true
                    },
                    {
                        "category":"Other",
                        "comment":"",
                        "timestamp":"1681994920",
                        "type":"size-in-bytes",
                        "value":"460000",
                        "to_ids":false
                    }
                ]
            },
            {
                "comment":"Virtual disc container",
                "description":"File object describing a file with meta-information",
                "meta-category":"file",
                "name":"file",
                "timestamp":"1681995198",
                "Attribute":[
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681995198",
                        "type":"sha1",
                        "value":"<sha1>",
                        "to_ids":true
                    },
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681995198",
                        "type":"md5",
                        "value":"<md5>",
                        "to_ids":true
                    },
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681995198",
                        "type":"sha256",
                        "value":"<sha256>",
                        "to_ids":true
                    },
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681995198",
                        "type":"filename",
                        "value":"Note.iso",
                        "to_ids":true
                    },
                    {
                        "category":"Other",
                        "comment":"",
                        "timestamp":"1681995198",
                        "type":"size-in-bytes",
                        "value":"2688000",
                        "to_ids":false
                    }
                ]
            },
            {
                "comment":"QUATERRIG loader",
                "description":"File object describing a file with meta-information",
                "meta-category":"file",
                "name":"file",
                "timestamp":"1681995316",
                "Attribute":[
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681995316",
                        "type":"sha1",
                        "value":"<sha1>",
                        "to_ids":true
                    },
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681995316",
                        "type":"md5",
                        "value":"<md5>",
                        "to_ids":true
                    },
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681995316",
                        "type":"sha256",
                        "value":"<sha256>",
                        "to_ids":true
                    },
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681995316",
                        "type":"filename",
                        "value":"AppvIsvSubsystems64.dll",
                        "to_ids":true
                    },
                    {
                        "category":"Other",
                        "comment":"",
                        "timestamp":"1681995316",
                        "type":"size-in-bytes",
                        "value":"26000",
                        "to_ids":false
                    }
                ]
            },
            {
                "comment":"Encrypted resource containing the second stage",
                "description":"File object describing a file with meta-information",
                "meta-category":"file",
                "name":"file",
                "timestamp":"1681996267",
                "Attribute":[
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681995527",
                        "type":"md5",
                        "value":"<md5>",
                        "to_ids":true
                    },
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681995527",
                        "type":"sha256",
                        "value":"<sha256>",
                        "to_ids":true
                    },
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681995527",
                        "type":"filename",
                        "value":"bdcmetadataresource.xsd",
                        "to_ids":true
                    },
                    {
                        "category":"Other",
                        "comment":"",
                        "timestamp":"1681996267",
                        "type":"size-in-bytes",
                        "value":"489757",
                        "to_ids":false
                    },
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1681995527",
                        "type":"sha1",
                        "value":"<sha1>",
                        "to_ids":true
                    }
                ]
            },
            {
                "comment":"",
                "description":"A domain/hostname and IP address seen as a tuple in a specific time frame.",
                "meta-category":"network",
                "name":"domain-ip",
                "timestamp":"1681996431",
                "Attribute":[
                    {
                        "category":"Network activity",
                        "comment":"QUARTERRIG C2 Domain",
                        "timestamp":"1681996431",
                        "type":"domain",
                        "value":"sharpledge.com",
                        "to_ids":true
                    },
                    {
                        "category":"Network activity",
                        "comment":"QUARTERRIG server IP",
                        "timestamp":"1681996431",
                        "type":"ip-dst",
                        "value":"51.75.210.218",
                        "to_ids":true
                    }
                ]
            },
            {
                "comment":"",
                "description":"A domain/hostname and IP address seen as a tuple in a specific time frame.",
                "meta-category":"network",
                "name":"domain-ip",
                "timestamp":"1681996454",
                "Attribute":[
                    {
                        "category":"Network activity",
                        "comment":"QUARTERRIG Domain",
                        "timestamp":"1681996454",
                        "type":"domain",
                        "value":"pateke.com",
                        "to_ids":true
                    },
                    {
                        "category":"Network activity",
                        "comment":"QUARTERRIG server IP",
                        "timestamp":"1681996454",
                        "type":"ip-dst",
                        "value":"85.195.89.91",
                        "to_ids":true
                    }
                ]
            },
            {
                "comment":"",
                "description":"A domain/hostname and IP address seen as a tuple in a specific time frame.",
                "meta-category":"network",
                "name":"domain-ip",
                "timestamp":"1681996465",
                "Attribute":[
                    {
                        "category":"Network activity",
                        "comment":"COBALT STRIKE C2 Domain",
                        "timestamp":"1681996465",
                        "type":"domain",
                        "value":"gatewan.com",
                        "to_ids":true
                    },
                    {
                        "category":"Network activity",
                        "comment":"COBALT STRIKE C2 IP",
                        "timestamp":"1681996465",
                        "type":"ip-dst",
                        "value":"91.218.183.90",
                        "to_ids":true
                    }
                ]
            }
        ]
    }
}