{
    "Event":{
        "threat_level_id":"3",
        "date":"2020-06-12",
        "published":true,
        "info":"Dharma Ransomware Event",
        "publish_timestamp":"1592742388",
        "timestamp":"1592742357",
        "Tag":[
            {
                "name":"misp-galaxy:malpedia=\"Dharma\""
            },
            {
                "name":"misp-galaxy:ransomware=\"Dharma Ransomware\""
            },
            {
                "name":"Ransomware"
            },
            {
                "name":"tlp:white"
            },
            {
                "name":"misp-galaxy:mitre-attack-pattern=\"External Remote Services - T1133\""
            },
            {
                "name":"misp-galaxy:mitre-attack-pattern=\"Valid Accounts - T1078\""
            },
            {
                "name":"misp-galaxy:mitre-attack-pattern=\"Scripting - T1064\""
            },
            {
                "name":"misp-galaxy:mitre-attack-pattern=\"Data Encrypted for Impact - T1486\""
            },
            {
                "name":"misp-galaxy:mitre-attack-pattern=\"File and Directory Discovery - T1083\""
            },
            {
                "name":"misp-galaxy:mitre-attack-pattern=\"Network Share Discovery - T1135\""
            }
        ],
        "Attribute":[
            {
                "category":"Network activity",
                "comment":"rdp actor login source",
                "timestamp":"1591968666",
                "type":"ip-src",
                "value":"217.138.202.116",
                "to_ids":true
            },
            {
                "category":"Artifacts dropped",
                "comment":"",
                "timestamp":"1591973283",
                "type":"yara",
                "value":"/*\r\n   YARA Rule Set\r\n   Author: DFIR Report\r\n   Date: 2020-06-12\r\n   Identifier: dharma-06-12-20\r\n   Reference: https://thedfirreport.com/\r\n*/\r\n\r\n/* Rule Set ----------------------------------------------------------------- */\r\n\r\nimport \"pe\"\r\n\r\nrule vssadmin_Shadow_bat {\r\n   meta:\r\n      description = \"dharma-06-12-20 - file Shadow.bat\"\r\n      author = \"DFIR Report\"\r\n      reference = \"https://thedfirreport.com/\"\r\n      date = \"2020-06-12\"\r\n      hash1 = \"da3f155cfb98ce0add29a31162d23da7596da44ba2391389517fe1a2790da878\"\r\n   strings:\r\n      $s1 = \"vssadmin delete shadows /all\" fullword ascii\r\n   condition:\r\n      uint16(0) == 0x7376 and filesize < 1KB and\r\n      all of them\r\n}\r\n\r\nrule Network_Scanner_post_exploit_enumeration {\r\n   meta:\r\n      description = \"dharma-06-12-20 - file NS.exe\"\r\n      author = \"DFIR Report\"\r\n      reference = \"https://thedfirreport.com/\"\r\n      date = \"2020-06-12\"\r\n      hash1 = \"f47e3555461472f23ab4766e4d5b6f6fd260e335a6abc31b860e569a720a5446\"\r\n   strings:\r\n      $s1 = \"CreateMutex error: %d\" fullword ascii\r\n      $s2 = \"--Error mount \\\\\\\\%s\\\\%s Code: %d\" fullword wide\r\n      $s3 = \"-Found share \\\\\\\\%s\\\\%s\" fullword wide\r\n      $s4 = \"--Share \\\\\\\\%s\\\\%s successfully mounted\" fullword wide\r\n      $s5 = \"host %s is up\" fullword ascii\r\n      $s6 = \"Get ip: %s and mask: %s\" fullword wide\r\n      $s7 = \"GetAdaptersInfo failed with error: %d\" fullword wide\r\n      $s8 = \"# Network scan and mount include chek for unmounted local volumes. #\" fullword wide\r\n      $s9 = \"####################################################################\" fullword wide /* reversed goodware string '####################################################################' */\r\n      $s10 = \"Share %s successfully mounted\" fullword wide\r\n      $s11 = \"Error mount %s %d\" fullword wide\r\n      $s12 = \"Failed to create thread.\" fullword ascii\r\n      $s13 = \" start scan for shares. \" fullword wide\r\n      $s14 = \"# '98' was add for standalone usage!                               #\" fullword wide\r\n      $s15 = \"Error, wrong value.\" fullword wide\r\n      $s16 = \"QueryDosDeviceW failed with error code %d\" fullword wide\r\n      $s17 = \"FindFirstVolumeW failed with error code %d\" fullword wide\r\n      $s18 = \"FindNextVolumeW failed with error code %d\" fullword wide\r\n      $s19 = \"SetVolumeMountPointW failed with error code %d\" fullword wide\r\n      $s20 = \"|    + scan local volumes for unmounted drives.                   |\" fullword wide\r\n   condition:\r\n      uint16(0) == 0x5a4d and filesize < 400KB and\r\n      ( pe.imphash() == \"0b0d8152ea7241cce613146b80a998fd\" or 8 of them )\r\n}\r\n\r\nrule Dharma_ransomware_1pgp {\r\n   meta:\r\n      description = \"dharma-06-12-20 - file 1pgp.exe\"\r\n      author = \"DFIR Report\"\r\n      reference = \"https://thedfirreport.com/\"\r\n      date = \"2020-06-12\"\r\n      hash1 = \"2f2e75affe9217c7211043936678fb1777e2db4a8f1986b8805ddb1e84e9e99b\"\r\n   strings:\r\n      $x1 = \"C:\\\\crysis\\\\Release\\\\PDB\\\\payload.pdb\" fullword ascii\r\n      $s2 = \"sssssbsss\" fullword ascii\r\n      $s3 = \"sssssbs\" fullword ascii\r\n      $s4 = \"9c%Q%f\" fullword ascii\r\n      $s5 = \"jNYZO\\\\\" fullword ascii\r\n      $s6 = \"RSDS%~m\" fullword ascii\r\n      $s7 = \"xy  ?*5\" fullword ascii\r\n      $s8 = \"<a-g6J\" fullword ascii\r\n      $s9 = \"]q)WtH?\" fullword ascii\r\n      $s10 = \"s=9uo^\" fullword ascii\r\n      $s11 = \"\\\"iMw\\\\e\" fullword ascii\r\n      $s12 = \"{?nT*}2g\" fullword ascii\r\n      $s13 = \"h*UqD*\" fullword ascii\r\n      $s14 = \"b,_f n7\" fullword ascii\r\n      $s15 = \"+mm7S%I\" fullword ascii\r\n      $s16 = \"+L]DAb\" fullword ascii\r\n      $s17 = \"nq0<3AD\" fullword ascii\r\n      $s18 = \"U2cUbO\" fullword ascii\r\n      $s19 = \";C!|E2z\" fullword ascii\r\n      $s20 = \"P)8$X=\" fullword ascii\r\n   condition:\r\n      uint16(0) == 0x5a4d and filesize < 300KB and\r\n      ( pe.imphash() == \"f86dec4a80961955a89e7ed62046cc0e\" or ( 1 of ($x*) or 4 of them ) )\r\n}\r\n\r\nrule closeapps_bat {\r\n   meta:\r\n      description = \"dharma-06-12-20 - file closeapps.bat\"\r\n      author = \"DFIR Report\"\r\n      reference = \"https://thedfirreport.com/\"\r\n      date = \"2020-06-12\"\r\n      hash1 = \"e25245f98a23596e03e51535beb0f73c000de63e473580c4c26e7b8b01b4e593\"\r\n   strings:\r\n      $x1 = \"taskkill /F /IM MSExchangeTransportLogSearch.exe\" fullword ascii\r\n      $x2 = \"taskkill /F /IM Veeam.Backup.Agent.ConfigurationService.exe\" fullword ascii\r\n      $x3 = \"taskkill /F /IM MSExchangeTransport.exe\" fullword ascii\r\n      $x4 = \"taskkill /F /IM EdgeTransport.exe\" fullword ascii\r\n      $x5 = \"taskkill /F /IM Microsoft.Exchange.ServiceHost.exe\" fullword ascii\r\n      $x6 = \"taskkill /F /IM Microsoft.Exchange.ProtectedServiceHost.exe\" fullword ascii\r\n      $x7 = \"taskkill /F /IM agent.exe\" fullword ascii\r\n      $x8 = \"taskkill /F /IM fdhost.exe\" fullword ascii\r\n      $x9 = \"taskkill /F /IM MSExchangeThrottling.exe\" fullword ascii\r\n      $x10 = \"taskkill /F /IM sqlagentc.exe\" fullword ascii\r\n      $x11 = \"taskkill /F /IM Microsoft.Exchange.ContentFilter.Wrapper.exe\" fullword ascii\r\n      $x12 = \"taskkill /F /IM Veeam.Backup.CatalogDataService.exe\" fullword ascii\r\n      $x13 = \"taskkill /F /IM cbInterface.exe\" fullword ascii\r\n      $x14 = \"taskkill /F /IM httpd.exe\" fullword ascii\r\n      $x15 = \"taskkill /F /IM VeeamTransportSvc.exe\" fullword ascii\r\n      $x16 = \"taskkill /F /IM cbService.exe\" fullword ascii\r\n      $x17 = \"taskkill /F /IM Veeam.Backup.BrokerService.exe\" fullword ascii\r\n      $x18 = \"taskkill /F /IM wsusservice.exe\" fullword ascii\r\n      $x19 = \"taskkill /F /IM pvxcom.exe\" fullword ascii\r\n      $x20 = \"taskkill /F /IM Veeam.Backup.MountService.exe\" fullword ascii\r\n   condition:\r\n      uint16(0) == 0x6c3a and filesize < 10KB and\r\n      1 of ($x*)\r\n}\r\n\r\nrule LogDelete_bat {\r\n   meta:\r\n      description = \"dharma-06-12-20 - file LogDelete.bat\"\r\n      author = \"DFIR Report\"\r\n      reference = \"https://thedfirreport.com/\"\r\n      date = \"2020-06-12\"\r\n      hash1 = \"e17ca6c764352c0a74e1e6b80278bb4395588df4bed64833b1b127ea2ca5c5fd\"\r\n   strings:\r\n      $s1 = \"FOR /F \\\"delims=\\\" %%I IN ('WEVTUTIL EL') DO (WEVTUTIL CL \\\"%%I\\\") \" fullword ascii\r\n   condition:\r\n      uint16(0) == 0x4f46 and filesize < 1KB and\r\n      all of them\r\n}\r\n\r\nrule Everything_seach_tool {\r\n   meta:\r\n      description = \"dharma-06-12-20 - file Everything.exe\"\r\n      author = \"DFIR Report\"\r\n      reference = \"https://thedfirreport.com/\"\r\n      date = \"2020-06-12\"\r\n      hash1 = \"35c4a6c1474eb870eec901cef823cc4931919a4e963c432ce9efbb30c2d8a413\"\r\n   strings:\r\n      $x1 = \"<assembly xmlns=\\\"urn:schemas-microsoft-com:asm.v1\\\" manifestVersion=\\\"1.0\\\" xmlns:asmv3=\\\"urn:schemas-microsoft-com:asm.v3\\\"><a\" ascii\r\n      $s2 = \"\\\" version=\\\"6.0.0.0\\\" processorArchitecture=\\\"*\\\" publicKeyToken=\\\"6595b64144ccf1df\\\" language=\\\"*\\\"></assemblyIdentity></depen\" ascii\r\n      $s3 = \"http://www.voidtools.com/downloads/\" fullword ascii\r\n      $s4 = \"http://www.voidtools.com/downloads/#language\" fullword ascii\r\n      $s5 = \"Folder\\\\shell\\\\%s\\\\command\" fullword ascii\r\n      $s6 = \"Directory\\\\background\\\\shell\\\\%s\\\\command\" fullword ascii\r\n      $s7 = \"Directory\\\\Background\\\\shell\\\\%s\\\\command\" fullword ascii\r\n      $s8 = \"yIdentity version=\\\"1.0.0.0\\\" processorArchitecture=\\\"*\\\" name=\\\"Everything\\\" type=\\\"win32\\\"></assemblyIdentity><description>Eve\" ascii\r\n      $s9 = \"; settings stored in %APPDATA%\\\\Everything\\\\Everything.ini\" fullword ascii\r\n      $s10 = \"Host the pipe server with the security descriptor.\" fullword ascii\r\n      $s11 = \"http://www.voidtools.com/support/everything/\" fullword ascii\r\n      $s12 = \"username:password@host:port\" fullword ascii\r\n      $s13 = \"<html><meta http-equiv=\\\"Content-Type\\\" content=\\\"text/html; charset=utf-8\\\"><meta name=\\\"viewport\\\" content=\\\"width=512\\\"><head\" ascii\r\n      $s14 = \"\\\\\\\\.\\\\PIPE\\\\Everything Service\" fullword ascii\r\n      $s15 = \"Everything Service Debug Log.txt\" fullword wide\r\n      $s16 = \"Auto detect will attempt to read file contents with the associated IFilter.\" fullword ascii\r\n      $s17 = \"processed %I64u / %I64u file records\" fullword ascii\r\n      $s18 = \"SERVICE_SERVER_COMMAND_REFS_MONITOR_READ_USN_JOURNAL_DATA read ok %d\" fullword ascii\r\n      $s19 = \"Store settings and data in %APPDATA%\\\\Everything?\" fullword ascii\r\n      $s20 = \"http://www.voidtools.com/donate/\" fullword ascii\r\n   condition:\r\n      uint16(0) == 0x5a4d and filesize < 5000KB and\r\n      ( pe.imphash() == \"e7a8222fca78bde6fe29c9cc10d97ca2\" or ( 1 of ($x*) or 4 of them ) )\r\n}\r\n\r\n/* Super Rules ------------------------------------------------------------- */\r\n\r\nrule Everything_search_tool_super {\r\n   meta:\r\n      description = \"dharma-06-12-20 - from files Everything.exe, Everything.exe\"\r\n      author = \"DFIR Report\"\r\n      reference = \"https://thedfirreport.com/\"\r\n      date = \"2020-06-12\"\r\n      hash1 = \"35c4a6c1474eb870eec901cef823cc4931919a4e963c432ce9efbb30c2d8a413\"\r\n      hash2 = \"35c4a6c1474eb870eec901cef823cc4931919a4e963c432ce9efbb30c2d8a413\"\r\n   strings:\r\n      $s1 = \"-disable-run-as-admin\" fullword ascii /* Goodware String - occured 1 times */\r\n      $s2 = \"type=%s;\" fullword ascii /* Goodware String - occured 1 times */\r\n      $s3 = \"EVERYTHING\" fullword ascii /* Goodware String - occured 1 times */\r\n      $s4 = \"-install-run-on-system-startup\" fullword ascii /* Goodware String - occured 2 times */\r\n      $s5 = \"-uninstall-url-protocol\" fullword ascii /* Goodware String - occured 2 times */\r\n      $s6 = \"-app-data\" fullword ascii /* Goodware String - occured 2 times */\r\n      $s7 = \"-uninstall-service\" fullword ascii /* Goodware String - occured 2 times */\r\n      $s8 = \"-uninstall-efu-association\" fullword ascii /* Goodware String - occured 2 times */\r\n   condition:\r\n      ( uint16(0) == 0x5a4d and filesize < 5000KB and pe.imphash() == \"e7a8222fca78bde6fe29c9cc10d97ca2\" and ( all of them )\r\n      ) or ( all of them )\r\n}",
                "to_ids":false
            },
            {
                "category":"External analysis",
                "comment":"",
                "timestamp":"1592308993",
                "type":"link",
                "value":"https://thedfirreport.com/2020/06/16/the-little-ransomware-that-couldnt-dharma/",
                "to_ids":false
            }
        ],
        "Object":[
            {
                "comment":"",
                "description":"File object describing a file with meta-information",
                "meta-category":"file",
                "name":"file",
                "timestamp":"1591968369",
                "Attribute":[
                    {
                        "category":"Artifacts dropped",
                        "comment":"",
                        "timestamp":"1591968370",
                        "type":"malware-sample",
                        "value":"1pgp.exe|1ebb6bb49ac1077c5e7eba4d56f6a3a1",
                        "to_ids":true
                    },
                    {
                        "category":"Artifacts dropped",
                        "comment":"",
                        "timestamp":"1591968370",
                        "type":"filename",
                        "value":"1pgp.exe",
                        "to_ids":false
                    },
                    {
                        "category":"Artifacts dropped",
                        "comment":"",
                        "timestamp":"1591968370",
                        "type":"md5",
                        "value":"<md5>",
                        "to_ids":true
                    },
                    {
                        "category":"Artifacts dropped",
                        "comment":"",
                        "timestamp":"1591968370",
                        "type":"sha1",
                        "value":"<sha1>",
                        "to_ids":true
                    },
                    {
                        "category":"Artifacts dropped",
                        "comment":"",
                        "timestamp":"1591968370",
                        "type":"sha256",
                        "value":"<sha256>",
                        "to_ids":true
                    },
                    {
                        "category":"Other",
                        "comment":"",
                        "timestamp":"1591968370",
                        "type":"size-in-bytes",
                        "value":"94720",
                        "to_ids":false
                    }
                ]
            },
            {
                "comment":"",
                "description":"File object describing a file with meta-information",
                "meta-category":"file",
                "name":"file",
                "timestamp":"1591968379",
                "Attribute":[
                    {
                        "category":"Artifacts dropped",
                        "comment":"",
                        "timestamp":"1591968379",
                        "type":"malware-sample",
                        "value":"closeapps.bat|9b0d6df42f879ba969f82c7a0ab48bc6",
                        "to_ids":true
                    },
                    {
                        "category":"Artifacts dropped",
                        "comment":"",
                        "timestamp":"1591968379",
                        "type":"filename",
                        "value":"closeapps.bat",
                        "to_ids":false
                    },
                    {
                        "category":"Artifacts dropped",
                        "comment":"",
                        "timestamp":"1591968379",
                        "type":"md5",
                        "value":"<md5>",
                        "to_ids":true
                    },
                    {
                        "category":"Artifacts dropped",
                        "comment":"",
                        "timestamp":"1591968379",
                        "type":"sha1",
                        "value":"<sha1>",
                        "to_ids":true
                    },
                    {
                        "category":"Artifacts dropped",
                        "comment":"",
                        "timestamp":"1591968379",
                        "type":"sha256",
                        "value":"<sha256>",
                        "to_ids":true
                    },
                    {
                        "category":"Other",
                        "comment":"",
                        "timestamp":"1591968379",
                        "type":"size-in-bytes",
                        "value":"3611",
                        "to_ids":false
                    }
                ]
            },
            {
                "comment":"",
                "description":"File object describing a file with meta-information",
                "meta-category":"file",
                "name":"file",
                "timestamp":"1591968391",
                "Attribute":[
                    {
                        "category":"Artifacts dropped",
                        "comment":"",
                        "timestamp":"1591968391",
                        "type":"malware-sample",
                        "value":"Everything.exe|8add121fa398ebf83e8b5db8f17b45e0",
                        "to_ids":true
                    },
                    {
                        "category":"Artifacts dropped",
                        "comment":"",
                        "timestamp":"1591968391",
                        "type":"filename",
                        "value":"Everything.exe",
                        "to_ids":false
                    },
                    {
                        "category":"Artifacts dropped",
                        "comment":"",
                        "timestamp":"1591968391",
                        "type":"md5",
                        "value":"<md5>",
                        "to_ids":true
                    },
                    {
                        "category":"Artifacts dropped",
                        "comment":"",
                        "timestamp":"1591968391",
                        "type":"sha1",
                        "value":"<sha1>",
                        "to_ids":true
                    },
                    {
                        "category":"Artifacts dropped",
                        "comment":"",
                        "timestamp":"1591968428",
                        "type":"sha256",
                        "value":"<sha256>",
                        "to_ids":true
                    },
                    {
                        "category":"Other",
                        "comment":"",
                        "timestamp":"1591968429",
                        "type":"size-in-bytes",
                        "value":"1668200",
                        "to_ids":false
                    }
                ]
            },
            {
                "comment":"",
                "description":"File object describing a file with meta-information",
                "meta-category":"file",
                "name":"file",
                "timestamp":"1591968458",
                "Attribute":[
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1591968488",
                        "type":"malware-sample",
                        "value":"LogDelete.bat|fb9c610ba195f9b18a96b84c5e755df7",
                        "to_ids":true
                    },
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1591968488",
                        "type":"filename",
                        "value":"LogDelete.bat",
                        "to_ids":false
                    },
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1591968488",
                        "type":"md5",
                        "value":"<md5>",
                        "to_ids":true
                    },
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1591968488",
                        "type":"sha1",
                        "value":"<sha1>",
                        "to_ids":true
                    },
                    {
                        "category":"Payload delivery",
                        "comment":"",
                        "timestamp":"1591968488",
                        "type":"sha256",
                        "value":"<sha256>",
                        "to_ids":true
                    },
                    {
                        "category":"Other",
                        "comment":"",
                        "timestamp":"1591968488",
                        "type":"size-in-bytes",
                        "value":"63",
                        "to_ids":false
                    }
                ]
            },
            {
                "comment":"",
                "description":"File object describing a file with meta-information",
                "meta-category":"file",
                "name":"file",
                "timestamp":"1592266867",
                "Attribute":[
                    {
                        "category":"Artifacts dropped",
                        "comment":"",
                        "timestamp":"1592266867",
                        "type":"malware-sample",
                        "value":"NS.exe|597de376b1f80c06d501415dd973dcec",
                        "to_ids":true
                    },
                    {
                        "category":"Artifacts dropped",
                        "comment":"",
                        "timestamp":"1592266867",
                        "type":"filename",
                        "value":"NS.exe",
                        "to_ids":false
                    },
                    {
                        "category":"Artifacts dropped",
                        "comment":"",
                        "timestamp":"1592266867",
                        "type":"md5",
                        "value":"<md5>",
                        "to_ids":true
                    },
                    {
                        "category":"Artifacts dropped",
                        "comment":"",
                        "timestamp":"1592266867",
                        "type":"sha1",
                        "value":"<sha1>",
                        "to_ids":true
                    },
                    {
                        "category":"Artifacts dropped",
                        "comment":"",
                        "timestamp":"1592266867",
                        "type":"sha256",
                        "value":"<sha256>",
                        "to_ids":true
                    },
                    {
                        "category":"Other",
                        "comment":"",
                        "timestamp":"1592266867",
                        "type":"size-in-bytes",
                        "value":"128000",
                        "to_ids":false
                    },
                    {
                        "category":"Other",
                        "comment":"",
                        "timestamp":"1592266867",
                        "type":"text",
                        "value":"%USERPROFILE%\\Desktop\\Oc\\NS.exe",
                        "to_ids":false
                    }
                ]
            },
            {
                "comment":"",
                "description":"File object describing a file with meta-information",
                "meta-category":"file",
                "name":"file",
                "timestamp":"1591968579",
                "Attribute":[
                    {
                        "category":"Artifacts dropped",
                        "comment":"",
                        "timestamp":"1591968611",
                        "type":"malware-sample",
                        "value":"Shadow.bat|df8394082a4e5b362bdcb17390f6676d",
                        "to_ids":true
                    },
                    {
                        "category":"Artifacts dropped",
                        "comment":"",
                        "timestamp":"1591968613",
                        "type":"filename",
                        "value":"Shadow.bat",
                        "to_ids":false
                    },
                    {
                        "category":"Artifacts dropped",
                        "comment":"",
                        "timestamp":"1591968613",
                        "type":"md5",
                        "value":"<md5>",
                        "to_ids":true
                    },
                    {
                        "category":"Artifacts dropped",
                        "comment":"",
                        "timestamp":"1591968613",
                        "type":"sha1",
                        "value":"<sha1>",
                        "to_ids":true
                    },
                    {
                        "category":"Artifacts dropped",
                        "comment":"",
                        "timestamp":"1591968613",
                        "type":"sha256",
                        "value":"<sha256>",
                        "to_ids":true
                    },
                    {
                        "category":"Other",
                        "comment":"",
                        "timestamp":"1591968613",
                        "type":"size-in-bytes",
                        "value":"28",
                        "to_ids":false
                    }
                ]
            }
        ]
    }
}