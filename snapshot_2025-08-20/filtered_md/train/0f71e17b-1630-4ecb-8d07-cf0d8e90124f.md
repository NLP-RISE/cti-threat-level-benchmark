# Threat Report: 2023-08-16: German Embassy Lure: Likely Part of Campaign Against NATO Aligned Ministries of Foreign Affairs


## Key Intelligence
* Date: 2023-08-16
* Threat Level: 1 (High)
* Tags: misp-galaxy:sector="Diplomacy", misp-galaxy:sector="Government, Administration", misp-galaxy:threat-actor="APT 29", misp-galaxy:mitre-attack-pattern="DLL Side-Loading - T1574.002", misp-galaxy:mitre-attack-pattern="Mshta - T1218.005", misp-galaxy:mitre-attack-pattern="Spearphishing Attachment - T1566.001", misp-galaxy:mitre-attack-pattern="Web Protocols - T1071.001", misp-galaxy:mitre-attack-pattern="Malicious File - T1204.002", tlp:white

---

## Indicators of Compromise (IOCs)
### External analysis
* link: https://blog.eclecticiq.com/german-embassy-lure-likely-part-of-campaign-against-nato-aligned-ministries-of-foreign-affairs

### Network activity
* hostname: toyy.zulipchat.com — C2 Servers
* hostname: sgrhf.org.pk — C2 Servers
* domain: edenparkweddings.com — C2 Servers

### Payload delivery
* md5: <md5> — PDF Lure
* md5: <md5> — PDF Lure
* md5: <md5> — Duke Malware Variant
* md5: <md5> — Duke Malware Variant
* md5: <md5> — Duke Malware Variant
* filename: Invitation_Farewell_DE_EMB.zip
* filename: AppVIsvSubsystems64.dll — A library loaded into msoev.exe to perform the execution without any failure
* filename: Mso.dll — Duke malware variant loaded into msoev.exe via DLL Sideloading.
* filename: Msoev.exe — A legitimate signed Windows binary, automatically loading Mso.dll and AppVIsvSubsystems64.dll upon execution

### Payload installation
* yara: rule APT29_Duke_Malware_Jul17
{
    meta: 
        description = "Detects APT29 Duke malware variant "  
        Author = "EclecticIQ Threat Research Team"   
        creation_date = "2023-07-30"  
        classification = "TLP:WHITE"
        hash1 = "0be11b4f34ede748892ea49e473d82db"
        hash2 = "5e1389b494edc86e17ff1783ed6b9d37"
    strings:
        $x1 = {48 89 4C 24 08 48 89 54 24 10 4C 89 44 24 18 4C 89 4C 24 20 48 83 EC 64 48 C7 C1}
            /*
0x2ac406170 80790F00                   cmp byte ptr [rcx + 0xf], 0
0x2ac406174 4889C8                      mov rax, rcx
0x2ac406177 751C                          jne 0x2ac406195
0x2ac406179 4889CA                     mov rdx, rcx
0x2ac40617c 488D490F                  lea rcx, [rcx + 0xf]
0x2ac406180 440FB64010              movzx r8d, byte ptr [rax + 0x10]
0x2ac406185 443002                       xor byte ptr [rdx], r8b
0x2ac406188 4883C201                  add rdx, 1
0x2ac40618c 4839CA                      cmp rdx, rcx
0x2ac40618f 75EF                           jne 0x2ac406180
0x2ac406191 C6400F01                  mov byte ptr [rax + 0xf], 1
0x2ac406195 C3                              ret 
 */
  $decryption_routine = {
80 79 ?? 00
48 89 C8
75 ??
48 89 CA
48 8D 49 ??
44 0F B6 40 ??
44 30 02
48 83 C2 01
48 39 CA
75 ??
C6 40 ?? 01
C3
}
    condition:
        uint16(0) == 0x5A4D and
        $x1 or $decryption_routine and 
        filesize <= 2MB
} — APT29_Duke_Malware_Jul17 YARA rule.
* yara: rule APT29_Embassy_Invitation_Lure
{
    meta: 
        description = "Detects APT29 Embassy Invitation Lure"  
        Author = "EclecticIQ Threat Research Team"   
        creation_date = "2023-07-30"  
        classification = "TLP:WHITE"
        hash1 = "fc53c75289309ffb7f65a3513e7519eb"
    strings:
        $pdf_meta1 = {2f 54 79 70 65 20 2f 45 6d 62 65 64 64 65 64 46 69 6c 65}
        $pdf_meta2 = "q='+btoa(p)" fullword ascii wide nocase 
        $x1 = {2F 50 72 6F 64 75 63 65 72 20 28 50 79 50 44 46 32 29}  
        $x2 = "Invitation"  fullword ascii wide nocase 
        $x3 = "embassy"  fullword ascii wide nocase 
        $x4 = "reception"  fullword ascii wide nocase 
    condition:
         ( uint32(0) == 0x46445025 or uint32(0) == 0x4450250a ) and
         all of ($pdf_meta*) and any of ($x*) and
         filesize <= 1MB
} — APT29_Embassy_Invitation_Lure YARA rule.
