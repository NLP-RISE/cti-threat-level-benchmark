# Threat Report: 2022-02-23: New data wiper malware used in Ukraine


## Key Intelligence
* Date: 2022-02-23
* Threat Level: 1 (High)
* Tags: tlp:white, HermeticWiper, misp-galaxy:target-information="Ukraine", misp-galaxy:mitre-attack-pattern="Data Destruction - T1485", misp-galaxy:mitre-attack-pattern="Disk Structure Wipe - T1561.002", misp-galaxy:mitre-attack-pattern="Group Policy Modification - T1484.001", misp-galaxy:mitre-attack-pattern="Inhibit System Recovery - T1490", misp-galaxy:mitre-attack-pattern="Signed Binary Proxy Execution - T1218"

---

## Indicators of Compromise (IOCs)
### Artifacts dropped
* regkey|value: SYSTEM\CurrentControlSet\Control\CrashControl|0 — effectively disabling crash dumps before the abused driver’s execution starts

### External analysis
* link: ﻿https://twitter.com/esetresearch/status/1496581903205511181?s=12 — Twitter post esetresearch
* link: https://www.joesandbox.com/analysis/577715/0/html
* link: https://www.sentinelone.com/labs/hermetic-wiper-ukraine-under-attack/
* link: https://www.welivesecurity.com/2022/02/24/hermeticwiper-new-data-wiping-malware-hits-ukraine/
* link: https://www.joesandbox.com/analysis/578047/0/html
* link: https://analyze.intezer.com/files/0385eeab00e946a302b24a91dea4187c1210597b8e17cd9e2230450f5ece21da?vt
* link: https://pbs.twimg.com/media/FMbX2LXaMAEik8g?format=png&name=large — Overview of HermeticWiper by Thomas Roccia
* link: https://symantec-enterprise-blogs.security.com/blogs/threat-intelligence/ukraine-wiper-malware-russia
* link: https://twitter.com/juanandres_gs/status/1496581710368358400?s=20&t=ceSYl9EWREXS0ELncl4grA
* link: https://twitter.com/0xAmit/status/1496641159371837444?s=20&t=BGgh4TA4xPH1SbmShMkULw
* link: https://twitter.com/JusticeRage/status/1496894253376720901?s=20&t=j42L_Y0O-Q2-oTI3YEcSZw
* link: https://securityintelligence.com/posts/new-destructive-malware-cyber-attacks-ukraine/
* link: https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-fscc/a82e9105-2405-4e37-b2c3-28c773902d85
* link: https://docs.microsoft.com/en-us/windows/win32/devnotes/attribute-list-entry
* link: https://twitter.com/Lexsek_/status/1496806942630633475?s=20&t=BGgh4TA4xPH1SbmShMkULw
* link: https://api.greynoise.io/datashots/ukraine/spoofable.csv — IPs only targeting GreyNoise sensors in Ukraine that may have been spoofed.
* link: https://api.greynoise.io/datashots/ukraine/ukraine.csv — IPs only targeting GreyNoise sensors in Ukraine that were not spoofed.
* link: https://api.greynoise.io/datashots/ukraine/manifest.json — GreyNoise sensor data
* link: https://blog.nviso.eu/2022/02/24/threat-update-ukraine-russia-tensions/ — Threat Update – Ukraine & Russia conflict
* link: https://www.zscaler.com/blogs/security-research/hermetic-wiper-resurgence-targeted-attacks-ukraine — Hermetic Wiper & resurgence of targeted attacks on Ukraine
* link: https://www.cisa.gov/uscert/ncas/alerts/aa22-057a — CISA Alert (AA22-057A)
* link: https://otx.alienvault.com/pulse/621802d015d213ff12c78818
* link: https://yoroi.company/research/diskkill-hermeticwiper-a-disruptive-cyber-weapon-targeting-ukraines-critical-infrastructures/

### Network activity
* hostname: i.ua-passport.space — https://www.facebook.com/UACERT/posts/312939130865352
* hostname: id.bigmir.space — https://www.facebook.com/UACERT/posts/312939130865352
* hostname: kfctm.online — From SANS webcast
* hostname: my.cloud-file.online — From SANS webcast
* hostname: my.mondeychamp.xyz — From SANS webcast
* hostname: files-download.infousa.xyz — From SANS webcast
* hostname: download.logins.online — From SANS webcast
* hostname: surname192.temp.swtest.ru — C2 Domain https://www.zscaler.com/blogs/security-research/hermetic-wiper-resurgence-targeted-attacks-ukraine
* hostname: deer.dentist.coagula.online — C2 Domain https://www.zscaler.com/blogs/security-research/hermetic-wiper-resurgence-targeted-attacks-ukraine
* hostname: declaration.deed.coagula.online — C2 Domain https://www.zscaler.com/blogs/security-research/hermetic-wiper-resurgence-targeted-attacks-ukraine
* url: http://surname192.temp.swtest.ru/prapor/su/ino.gif — Download URLs
* url: http://surname192.temp.swtest.ru/prapor/su/derg.gif — Download URLs
* url: http://surname192.temp.swtest.ru/prapor/su/flagua.gif — Download URLs
* url: http://surname192.temp.swtest.ru/prapor/su/flages.gif — Download URLs
* url: 94.158.244.27/absolute.ace — Secondary payload
* url: 94.158.244.27/distant.cdr — Secondary payload

### Other
* comment: The PE compilation timestamp of one of the sample is 2021-12-28
* comment: The Wiper binary is signed using a code signing certificate issued to Hermetica Digital Ltd
* comment: The wiper abuses legitimate drivers from the EaseUS Partition Master software in order to corrupt data. As a final step the wiper reboot computer
* comment: In one of the targeted organizations, the wiper was dropped via the default (domain policy) GPO meaning that attackers had likely taken control of the Active Directory server.
* comment: Win32/KillDisk.NCV trojan
* comment: The malware also enumerates common folders (‘My Documents’, ‘Desktop’, ‘AppData’), makes references to the registry (‘ntuser’), and Windows Event Logs ("\\\\?\\C:\\Windows\\System32\\winevt\\Logs"). — SentinelLabs
* comment: Continue to focus on the fundamentals. While the sense of urgency has changed, how people are targeted has not. Focus your security training and communications on
* Phishing
* Passwords
* Updating — From SANS webcast

### Payload delivery
* filename: empntdrv.sys — Sentinel: Abuses driver
* sha256: <sha256> — DRV_X64 / Compressed
* sha256: <sha256> — DRV_X64 / Decompressed
* sha256: <sha256> — DRV_X86 / Compressed
* sha256: <sha256> — DRV_X86 / Decompressed
* sha256: <sha256> — DRV_XP_X64 / Compressed
* sha256: <sha256> — DRV_XP_X64 / Decompressed
* sha256: <sha256> — DRV_XP_X86 / Compressed
* sha256: <sha256> — DRV_XP_X86 / Decompressed
* url: http://kfctm.online/0102adqeczoL2.txt — Download URLs
* domain: kfctm.online — Download URLs
* md5: <md5> — RAR archive
* md5: <md5> — Template
* md5: <md5> — Template
* md5: <md5> — Document
* md5: <md5> — Document
* sha256: <sha256> — Symantec - Ransomware
* sha256: <sha256> — Symantec - Trojan.Killdisk

## Objects
### file — File object describing a file with meta-information
* [Payload delivery] sha1: <sha1> — HermetiWiper - Win32/KillDisk.NCV - Win32 EXE
* [Payload delivery] md5: <md5> — HermetiWiper - Win32/KillDisk.NCV - Win32 EXE
* [Payload delivery] sha256: <sha256> — HermetiWiper - Win32/KillDisk.NCV - Win32 EXE
* [Payload delivery] filename: conhosts.exe
* [Payload delivery] imphash: <imphash>
* [Other] text: Trojan.Killdisk

### yara — An object describing a YARA rule (or a YARA rule name) along with its version.
* [Payload installation] yara: rule MAL_HERMETIC_WIPER {
    meta:
      desc = "HermeticWiper - broad hunting rule"
      author = "Friends @ SentinelLabs"
      version = "1.0"
      last_modified = "02.23.2022"
      hash = "1bc44eef75779e3ca1eefb8ff5a64807dbc942b1e4a2672d77b9f6928d292591"
    strings:
        $string1 = "DRV_XP_X64" wide ascii nocase
        $string2 = "EPMNTDRV\\%u" wide ascii nocase
        $string3 = "PhysicalDrive%u" wide ascii nocase
        $cert1 = "Hermetica Digital Ltd" wide ascii nocase
    condition:
      uint16(0) == 0x5A4D and
      all of them
}
* [Other] comment: HermeticWiper - broad hunting rule
* [Other] text: disk
* [Other] text: MAL_HERMETIC_WIPER

### virustotal-report — VirusTotal report
* [External analysis] link: https://www.virustotal.com/gui/file/1bc44eef75779e3ca1eefb8ff5a64807dbc942b1e4a2672d77b9f6928d292591

### file — File object describing a file with meta-information
* [Payload delivery] sha1: <sha1> — HermetiWiper - Win32/KillDisk.NCV - Win32 EXE
* [Payload delivery] md5: <md5> — HermetiWiper - Win32/KillDisk.NCV - Win32 EXE
* [Payload delivery] sha256: <sha256> — HermetiWiper - Win32/KillDisk.NCV - Win32 EXE
* [Payload delivery] filename: DSWvDvj50i.exe
* [Other] text: Trojan.Killdisk

### virustotal-report — VirusTotal report
* [External analysis] link: https://www.virustotal.com/gui/file/0385eeab00e946a302b24a91dea4187c1210597b8e17cd9e2230450f5ece21da/detection

### file — File object describing a file with meta-information
* [Payload delivery] sha1: <sha1> — From https://twitter.com/fr0gger_/status/1496968238013759492?cxt=HHwWiIDSrcyrpsYpAAAA
* [Other] text: Compile date: February 23rd, 2022

### file — File object describing a file with meta-information
* [Payload delivery] sha1: <sha1> — From https://twitter.com/fr0gger_/status/1496968238013759492?cxt=HHwWiIDSrcyrpsYpAAAA

### file — File object describing a file with meta-information
* [Payload delivery] sha1: <sha1> — From https://twitter.com/fr0gger_/status/1496968238013759492?cxt=HHwWiIDSrcyrpsYpAAAA

### file — File object describing a file with meta-information
* [Payload delivery] sha1: <sha1> — From https://twitter.com/fr0gger_/status/1496968238013759492?cxt=HHwWiIDSrcyrpsYpAAAA

### file — File object describing a file with meta-information
* [Payload delivery] md5: <md5> — SentinelLabs - RCDATA_DRV_XP_X86 - ms-compressed

### file — File object describing a file with meta-information
* [Payload delivery] md5: <md5> — SentinelLabs - RCDATA_DRV_X64	- ms-compressed

### file — File object describing a file with meta-information
* [Payload delivery] md5: <md5> — SentinelLabs - RCDATA_DRV_X86	- ms-compressed

### file — File object describing a file with meta-information
* [Payload delivery] md5: <md5> — SentinelLabs - RCDATA_DRV_XP_X64 - ms-compressed

### yara — An object describing a YARA rule (or a YARA rule name) along with its version.
* [Payload installation] yara: rule APT_UA_Hermetic_Wiper_Feb22_1 {
   meta:
      description = "Detects Hermetic Wiper malware"
      author = "Florian Roth"
      reference = "https://www.sentinelone.com/labs/hermetic-wiper-ukraine-under-attack/"
      date = "2022-02-24"
      score = 75
      hash1 = "0385eeab00e946a302b24a91dea4187c1210597b8e17cd9e2230450f5ece21da"
      hash2 = "3c557727953a8f6b4788984464fb77741b821991acbf5e746aebdd02615b1767"
      hash3 = "2c10b2ec0b995b88c27d141d6f7b14d6b8177c52818687e4ff8e6ecf53adf5bf"
      hash4 = "1bc44eef75779e3ca1eefb8ff5a64807dbc942b1e4a2672d77b9f6928d292591"
   strings:
      $xc1 = { 00 5C 00 5C 00 2E 00 5C 00 50 00 68 00 79 00 73
               00 69 00 63 00 61 00 6C 00 44 00 72 00 69 00 76
               00 65 00 25 00 75 00 00 00 5C 00 5C 00 2E 00 5C
               00 45 00 50 00 4D 00 4E 00 54 00 44 00 52 00 56
               00 5C 00 25 00 75 00 00 00 5C 00 5C 00 2E 00 5C
               00 00 00 00 00 25 00 73 00 25 00 2E 00 32 00 73
               00 00 00 00 00 24 00 42 00 69 00 74 00 6D 00 61
               00 70 00 00 00 24 00 4C 00 6F 00 67 00 46 00 69
               00 6C 00 65 }
      $sc1 = { 00 44 00 72 00 69 00 76 00 65 00 72 00 73 00 00
               00 64 00 72 00 76 00 00 00 53 00 79 00 73 00 74
               00 65 00 6D 00 33 00 32 }

      $s1 = "\\\\?\\C:\\Windows\\System32\\winevt\\Logs" wide fullword
      $s2 = "\\\\.\\EPMNTDRV\\%u" wide fullword
      $s3 = "DRV_XP_X64" wide fullword
      $s4 = "%ws%.2ws" wide fullword

      $op1 = { 8b 7e 08 0f 57 c0 8b 46 0c 83 ef 01 66 0f 13 44 24 20 83 d8 00 89 44 24 18 0f 88 3b 01 00 00 }
      $op2 = { 13 fa 8b 55 f4 4e 3b f3 7f e6 8a 45 0f 01 4d f0 0f 57 c0 }
   condition:
      ( uint16(0) == 0x5a53 or uint16(0) == 0x5a4d ) and
      filesize < 400KB and ( 1 of ($x*) or 3 of them )
} — https://github.com/Neo23x0/signature-base/blob/master/yara/apt_ua_hermetic_wiper.yar
* [Other] comment: Detects Hermetic Wiper malware
* [Other] text: disk
* [Other] text: APT_UA_Hermetic_Wiper_Feb22_1

### yara — An object describing a YARA rule (or a YARA rule name) along with its version.
* [Payload installation] yara: rule APT_UA_Hermetic_Wiper_Artefacts_Feb22_1 {
   meta:
      description = "Detects artefacts found in Hermetic Wiper malware related intrusions"
      author = "Florian Roth"
      reference = "https://symantec-enterprise-blogs.security.com/blogs/threat-intelligence/ukraine-wiper-malware-russia"
      date = "2022-02-25"
      score = 75
   strings:
      $sx1 = "/c powershell -c \"rundll32 C:\\windows\\system32\\comsvcs.dll MiniDump" ascii wide
      $sx2 = "appdata\\local\\microsoft\\windows\\winupd.log" ascii wide
      $sx3 = "AppData\\Local\\Microsoft\\Windows\\Winupd.log" ascii wide
      $sx4 = "CSIDL_SYSTEM_DRIVE\\temp\\sys.tmp1" ascii wide
      $sx5 = "\\policydefinitions\\postgresql.exe" ascii wide

      $sx6 = "powershell -v 2 -exec bypass -File text.ps1" ascii wide
      $sx7 = "powershell -exec bypass gp.ps1" ascii wide
      $sx8 = "powershell -exec bypass -File link.ps1" ascii wide

      /* 16 is the prefix of an epoch timestamp that shouldn't change until the 14th of November 2023 */
      $sx9 = " 1> \\\\127.0.0.1\\ADMIN$\\__16" ascii wide
      
      $sa1 = "(New-Object System.Net.WebClient).DownloadFile(" ascii wide
      $sa2 = "CSIDL_SYSTEM_DRIVE\\temp\\" ascii wide
      $sa3 = "1> \\\\127.0.0.1\\ADMIN$" ascii wide
   condition:
      1 of ($sx*) or all of ($sa*)
} — https://github.com/Neo23x0/signature-base/blob/master/yara/apt_ua_hermetic_wiper.yar
* [Other] comment: Detects artefacts found in Hermetic Wiper malware related intrusions
* [Other] text: disk
* [Other] text: APT_UA_Hermetic_Wiper_Artefacts_Feb22_1

### yara — An object describing a YARA rule (or a YARA rule name) along with its version.
* [Payload installation] yara: rule APT_UA_Hermetic_Wiper_Scheduled_Task_Feb22_1 {
   meta:
      description = "Detects scheduled task pattern found in Hermetic Wiper malware related intrusions"
      author = "Florian Roth"
      reference = "https://symantec-enterprise-blogs.security.com/blogs/threat-intelligence/ukraine-wiper-malware-russia"
      date = "2022-02-25"
      score = 85
   strings:
      $a0 = "<Task version=" ascii wide

      $sa1 = "CSIDL_SYSTEM_DRIVE\\temp" ascii wide
      $sa2 = "postgresql.exe 1> \\\\127.0.0.1\\ADMIN$" ascii wide
      $sa3 = "cmd.exe /Q /c move CSIDL_SYSTEM_DRIVE" ascii wide
   condition:
      $a0 and 1 of ($s*)
} — https://github.com/Neo23x0/signature-base/blob/master/yara/apt_ua_hermetic_wiper.yar
* [Other] comment: Detects scheduled task pattern found in Hermetic Wiper malware related intrusions
* [Other] text: disk
* [Other] text: APT_UA_Hermetic_Wiper_Scheduled_Task_Feb22_1
