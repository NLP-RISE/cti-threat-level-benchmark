# Threat Report: 2022-05-13: UNC3524: Eye Spy on Your Email


## Key Intelligence
* Date: 2022-05-13
* Threat Level: 2 (Medium)
* Tags: misp-galaxy:mitre-attack-pattern="Additional Cloud Credentials - T1098.001", misp-galaxy:mitre-attack-pattern="Application Layer Protocol - T1071", misp-galaxy:mitre-attack-pattern="Asymmetric Cryptography - T1573.002", misp-galaxy:mitre-attack-pattern="Compromise Infrastructure - T1584", misp-galaxy:mitre-attack-pattern="DCSync - T1003.006", misp-galaxy:mitre-attack-pattern="Email Collection - T1114", misp-galaxy:mitre-attack-pattern="Install Digital Certificate - T1608.003", misp-galaxy:mitre-attack-pattern="LSA Secrets - T1003.004", misp-galaxy:mitre-attack-pattern="Multi-hop Proxy - T1090.003", misp-galaxy:mitre-attack-pattern="Non-Application Layer Protocol - T1095", misp-galaxy:mitre-attack-pattern="Obfuscated Files or Information - T1027", misp-galaxy:mitre-attack-pattern="PowerShell - T1059.001", misp-galaxy:mitre-attack-pattern="Process Discovery - T1057", misp-galaxy:mitre-attack-pattern="Protocol Tunneling - T1572", misp-galaxy:mitre-attack-pattern="Query Registry - T1012", misp-galaxy:mitre-attack-pattern="Rc.common - T1037.004", misp-galaxy:mitre-attack-pattern="Remote Email Collection - T1114.002", misp-galaxy:mitre-attack-pattern="SSH - T1021.004", misp-galaxy:mitre-attack-pattern="Software Discovery - T1518", misp-galaxy:mitre-attack-pattern="System Network Configuration Discovery - T1016", misp-galaxy:mitre-attack-pattern="System Network Connections Discovery - T1049", misp-galaxy:mitre-attack-pattern="Two-Factor Authentication Interception - T1111", misp-galaxy:mitre-attack-pattern="Virtual Private Server - T1583.003", misp-galaxy:mitre-attack-pattern="Web Shell - T1505.003", misp-galaxy:mitre-attack-pattern="Windows Command Shell - T1059.003", tlp:white

---

## Indicators of Compromise (IOCs)
### Artifacts dropped
* pattern-in-file: grep "\x48\x8b\x3c\xd3\x4c\x89\xe1\xf2\xae" -rs / — Find QUIETEXIT hard-coded byte string using grep
* pattern-in-file: grep '\xDD\xE5\xD5\x97\x20\x53\x27\xBF\xF0\xA2\xBA\xCD\x96\x35\x9A\xAD\x1C\x75\xEB\x47' -rs / — Find QUIETEXIT by looking for the hard-coded password value
* pattern-in-file: grep -e " -[Xx] -p [[:digit:]{2,6}]" -rs /etc — Find QUIETEXIT persistence mechanisms in the appliance’s rc.local directory by looking for the command line arguments

### External analysis
* link: https://www.mandiant.com/resources/unc3524-eye-spy-email

### Network activity
* domain: cloudns.asia — QUIETEXIT Dynamic DN
* domain: dynu.net — QUIETEXIT Dynamic DN
* domain: mywire.org — QUIETEXIT Dynamic DN
* domain: webredirect.org — QUIETEXIT Dynamic DN

## Objects
### yara — An object describing a YARA rule (or a YARA rule name) along with its version.
* [Payload installation] yara: rule QUIETEXIT_strings

{

    meta:

        author = "Mandiant"

        date_created = "2022-01-13"

        date_modified = "2022-01-13"

        rev = 1

    strings:

        $s1 = "auth-agent@openssh.com"

        $s2 = "auth-%.8x-%d"

        $s3 = "Child connection from %s:%s"

        $s4 = "Compiled without normal mode, can't run without -i"

        $s5 = "cancel-tcpip-forward"

        $s6 = "dropbear_prng"

        $s7 = "cron"

    condition:

        uint32be(0) == 0x7F454C46 and filesize < 2MB and all of them

}
* [Other] text: QUIETEXIT_strings

### yara — An object describing a YARA rule (or a YARA rule name) along with its version.
* [Payload installation] yara: rule REGEORG_Tuneller_generic

{

    meta:

        author = "Mandiant"

        date_created = "2021-12-20"

        date_modified = "2021-12-20"

        md5 = "ba22992ce835dadcd06bff4ab7b162f9"

    strings:

        $s1 = "System.Net.IPEndPoint"

        $s2 = "Response.AddHeader"

        $s3 = "Request.InputStream.Read"

        $s4 = "Request.Headers.Get"

        $s5 = "Response.Write"

        $s6 = "System.Buffer.BlockCopy"

        $s7 = "Response.BinaryWrite"

        $s8 = "SocketException soex"

    condition:

        filesize < 1MB and 7 of them

}
* [Other] text: REGEORG_Tuneller_generic

### yara — An object describing a YARA rule (or a YARA rule name) along with its version.
* [Payload installation] yara: rule UNC3524_sha1

{

    meta:

        author = "Mandiant"

        date_created = "2022-01-19"

        date_modified = "2022-01-19"

   strings:

        $h1 = { DD E5 D5 97 20 53 27 BF F0 A2 BA CD 96 35 9A AD 1C 75 EB 47 }

    condition:

        uint32be(0) == 0x7F454C46 and filesize < 10MB and all of them

}
* [Other] text: UNC3524_sha1

### file — File object describing a file with meta-information
* [Payload delivery] md5: <md5> — REGEORG GitHub version
* [Payload delivery] sha1: <sha1> — REGEORG GitHub version
* [Payload delivery] sha256: <sha256> — REGEORG GitHub version
