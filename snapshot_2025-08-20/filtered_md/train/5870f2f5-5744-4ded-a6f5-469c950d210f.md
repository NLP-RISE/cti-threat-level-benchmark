# Threat Report: 2017-01-07: OSINT - 2016 Updates to Shifu Banking Trojan


## Key Intelligence
* Date: 2017-01-07
* Threat Level: 3 (Low)
* Tags: tlp:white, circl:topic="finance", veris:action:social:target="Finance"

---

## Indicators of Compromise (IOCs)
### Artifacts dropped
* pdb: Z:\coding\cryptor\Release\crypted.pdb
* pdb: Z:\coding\malware\tests\Release\cryptoshit.pdb
* pdb: Z:\coding\malware\RDP\output\Release\rdp_bot.pdb
* pdb: Z:\coding\malware\ScanBot\Release\bot.pdb
* pdb: Z:\coding\project\main\payload\payload.x86.pdb

### External analysis
* comment: Shifu is a Banking Trojan first discovered in 2015. Shifu is based on the Shiz source code which incorporated techniques used by Zeus. Attackers use Shifu to steal credentials for online banking websites around the world, starting in Russia but later including the UK, Italy, and others.

Palo Alto Networks Unit 42 research has found that the Shifu authors have evolved Shifu in 2016. Our research has found that Shifu has incorporated multiple new techniques to infect and evade detection on Microsoft Windows systems. Some of these include:

    Exploitation of CVE-2016-0167 a Microsoft Windows Privilege Escalation vulnerability to gain SYSTEM level privileges. Earlier versions of Shifu exploited CVE-2015-0003 to achieve the same goal
    Use of a Windows atom to identify if the host is already infected with Shifu in addition to the mutex used by previous versions
    Use of â€œpush-calc-retâ€ API obfuscation to hide function calls from malware analysts
    Use of alternative Namecoin .bit domains

We have also identified new links between Shifu and other tools which suggest Shifu isnâ€™t simply based on the Shiz Trojan, but is probably the latest evolution of Shiz.

The primary goal of this report is to introduce Shifuâ€™s new features to other malware analysts who may encounter this Trojan in the future. The following sections give an overview of the new features, and the appendix at the end includes the technical details on the overall functionality of Shifu.
* link: http://researchcenter.paloaltonetworks.com/2017/01/unit42-2016-updates-shifu-banking-trojan/
* link: https://www.virustotal.com/file/d3f9c4037f8b4d24f2baff1e0940d2bf238032f9343d06478b5034d0981b2cd9/analysis/1476315072/ — Initial obfuscated loader - Xchecked via VT: d3f9c4037f8b4d24f2baff1e0940d2bf238032f9343d06478b5034d0981b2cd9
* link: https://www.virustotal.com/file/368b23e6d9ec7843e537e9d6547777088cf36581076599d04846287a9162652b/analysis/1476120793/ — Initial obfuscated loader - Xchecked via VT: 368b23e6d9ec7843e537e9d6547777088cf36581076599d04846287a9162652b
* link: https://www.virustotal.com/file/e7e154c65417f5594a8b4602db601ac39156b5758889f708dac7258e415d4a18/analysis/1476121083/ — Initial obfuscated loader - Xchecked via VT: e7e154c65417f5594a8b4602db601ac39156b5758889f708dac7258e415d4a18
* link: https://www.virustotal.com/file/f63ec1e5752eb8b9a07104f42392eebf143617708bfdd0fe31cbf00ef12383f9/analysis/1476121104/ — Initial obfuscated loader - Xchecked via VT: f63ec1e5752eb8b9a07104f42392eebf143617708bfdd0fe31cbf00ef12383f9

### Network activity
* ip-dst: 92.222.80.28 — The main payload of Shifu uses .bit top-level domains which is a decentralized DNS system based on the Namecoin infrastructure. The malware requests the IP addresses of the domains by subsequently contacting the following hardcoded Namecoin DNS servers
* ip-dst: 78.138.97.93 — The main payload of Shifu uses .bit top-level domains which is a decentralized DNS system based on the Namecoin infrastructure. The malware requests the IP addresses of the domains by subsequently contacting the following hardcoded Namecoin DNS servers
* ip-dst: 77.66.108.93 — The main payload of Shifu uses .bit top-level domains which is a decentralized DNS system based on the Namecoin infrastructure. The malware requests the IP addresses of the domains by subsequently contacting the following hardcoded Namecoin DNS servers
* hostname: ns1.dk.dns.d0wn.biz — At the time of analysis, only the following Namecoin DNS server was answering with the IP address of the actual C&C server:
* ip-dst: 103.199.16.106 — Both domain names, klyatiemoskali.bit and slavaukraine.bit, resolved to the IP address 103.199.16.106 at the time of analysis.

### Payload delivery
* sha256: <sha256> — Initial obfuscated loader
* sha256: <sha256> — Initial obfuscated loader
* sha256: <sha256> — Initial obfuscated loader
* sha256: <sha256> — Initial obfuscated loader
* sha256: <sha256> — Second stage injector
* sha256: <sha256> — Second stage injector
* sha256: <sha256> — Exploit injector
* sha256: <sha256> — CVE-2016-0167 exploit (x86)
* sha256: <sha256> — CVE-2016-0167 exploit (x64)
* sha256: <sha256> — Main payload
* sha256: <sha256> — Main payload
* filename: klyatiemoskali.bit — Both domain names, klyatiemoskali.bit and slavaukraine.bit, resolved to the IP address 103.199.16.106 at the time of analysis.
* filename: slavaukraine.bit — Both domain names, klyatiemoskali.bit and slavaukraine.bit, resolved to the IP address 103.199.16.106 at the time of analysis.
* sha1: <sha1> — Initial obfuscated loader - Xchecked via VT: d3f9c4037f8b4d24f2baff1e0940d2bf238032f9343d06478b5034d0981b2cd9
* md5: <md5> — Initial obfuscated loader - Xchecked via VT: d3f9c4037f8b4d24f2baff1e0940d2bf238032f9343d06478b5034d0981b2cd9
* sha1: <sha1> — Initial obfuscated loader - Xchecked via VT: 368b23e6d9ec7843e537e9d6547777088cf36581076599d04846287a9162652b
* md5: <md5> — Initial obfuscated loader - Xchecked via VT: 368b23e6d9ec7843e537e9d6547777088cf36581076599d04846287a9162652b
* sha1: <sha1> — Initial obfuscated loader - Xchecked via VT: e7e154c65417f5594a8b4602db601ac39156b5758889f708dac7258e415d4a18
* md5: <md5> — Initial obfuscated loader - Xchecked via VT: e7e154c65417f5594a8b4602db601ac39156b5758889f708dac7258e415d4a18
* sha1: <sha1> — Initial obfuscated loader - Xchecked via VT: f63ec1e5752eb8b9a07104f42392eebf143617708bfdd0fe31cbf00ef12383f9
* md5: <md5> — Initial obfuscated loader - Xchecked via VT: f63ec1e5752eb8b9a07104f42392eebf143617708bfdd0fe31cbf00ef12383f9

### Payload installation
* vulnerability: CVE-2016-0167 — Exploitation of CVE-2016-0167 a Microsoft Windows Privilege Escalation vulnerability to gain SYSTEM level privileges. Earlier versions of Shifu exploited CVE-2015-0003 to achieve the same goal
* vulnerability: CVE-2015-0003 — Exploitation of CVE-2016-0167 a Microsoft Windows Privilege Escalation vulnerability to gain SYSTEM level privileges. Earlier versions of Shifu exploited CVE-2015-0003 to achieve the same goal
