# Threat Report: 2019-04-09: OSINT - STUXSHOP The Oldest Stuxnet Component Dials Up


## Key Intelligence
* Date: 2019-04-09
* Threat Level: 2 (Medium)
* Tags: type:OSINT, osint:lifetime="perpetual", osint:certainty="50", tlp:white, misp-galaxy:malpedia="Stuxnet", misp-galaxy:tool="Stuxnet"

---

## Indicators of Compromise (IOCs)
### Artifacts dropped
* yara: rule STUXSHOP_OSCheck
{
meta:
author = "â€‹ Silas Cutler (havex@Chronicle.Security)â€‹ "
desc = "â€‹ Identifies the OS Check function in STUXSHOP and CheshireCatâ€‹ "
hash = "â€‹ c1961e54d60e34bbec397c9120564e8d08f2f243ae349d2fb20f736510716579â€‹ "
strings:
$ = {10 F7 D8 1B C0 83 C0 ?? E9 ?? 01 00 00 39 85 7C FF FF FF 0F 85 ?? 01 00
00 83 BD 70 FF FF FF 04 8B 8D 74 FF FF FF 75 0B 85 C9 0F 85 ?? 01 00 00 6A 05
5E }
$ = {01 00 00 3B FA 0F 84 ?? 01 00 00 80 7D 80 00 B1 62 74 1D 6A 0D 8D 45 80
68 ?? ?? ?? 10 50 FF 15 ?? ?? ?? 10 83 C4 0C B1 6F 85 C0 75 03 8A 4D 8D 8B C6
}
condition:
any of them
}
* yara: rule STUXSHOP_config
{
	meta:
          desc â€‹ = â€‹ "Stuxshop standalone sample configuration"
          author = "JAG-S (turla@chronicle.security)"
          hash â€‹ = â€‹ "c1961e54d60e34bbec397c9120564e8d08f2f243ae349d2fb20f736510716579"
        strings:
          $cnc1 = "http://211.24.237.226/index.php?data="â€‹ ascii wide
          $cnc2 = "http://todaysfutbol.com/index.php?data="â€‹ ascii wide
          $cnc3 = "http://78.111.169.146/index.php?data="â€‹ ascii wide"
          $cnc4 = "http://mypremierfutbol.com/index.php?data="â€‹ ascii wide

	  $regkey1 â€‹ = â€‹"Software\\Microsoft\\Windows\\CurrentVersion\\MS-DOS Emulation" ascii wide
          $regkey2  = "NTVDMParams"â€‹ ascii wide
          $flowerOverlap1 = {85 C0 75 3B 57 FF 75 1C FF 75 18 FF 75 14 50 FF 75 10 FF 75 FC FF 15â€‹}
          $flowerOverlap2 = {85 C0 75 4C 8B 45 1C 89 45 0C 8D 45 0C 50 8D 45 08 FF 75 18 50 6A 00 FF 75 10 FF 75 20 FF 15â€‹}
          $flowerOverlap3 = {55 8B EC 53 56 8B 75 20 85 F6 74 03 83 26 00 8D 45 20 50 68 19 00 02 00 6A 00 FF 75 0C FF 75 08â€‹}
          $flowerOverlap4 = {55 8B EC 51 8D 4D FC 33 C0 51 50 6A 26 50 89 45 FC FF 15 }
          $flowerOverlap5 â€‹= {85 DB 74 04 8B C3 EB 1A 8B 45 08 3B 45 14 74 07 B8 5D 06 00 00 EB 0B 85 F6 74 05 8B 45 0C 89 06â€‹}
          $flowerOverlap6 = {85 FF 74 12 83 7D F8 01 75 0C FF 75 0C FF 75 08 FF 15â€‹}
        condition:
          all of â€‹ ( â€‹ $flowerOverlapâ€‹ *)
          or
          2â€‹ of â€‹ ( â€‹ $cncâ€‹ *)
          or
          all of â€‹ ( â€‹ $regkeyâ€‹ *)
}
* regkey: HKEY_CURRENT_USER\Control Panel\Appearance\Old

### External analysis
* text: During our research into the GossipGirl Supra Threat Actor (STA) cluster, we discovered apreviously unknown relationship exemplified in an early Stuxnet component â€“built in part on theFlowershop malware framework. While other known versions of Stuxnet were partially linked tothe Flame platform (a.k.a. Flamer, SkyWiper) or the â€˜Tilded Platformâ€™ (a.k.a. DuQu), this older1component shares code with Flowershop â€“an even older malware framework active as early as2002. In an interesting show of longevity, this Stuxnet component â€“which weâ€™ve dubbedStuxshopâ€‹â€“ is configured to communicate with known Stuxnet command-and-control (C&C)servers and even includes logic to suppress dial-up prompts for disconnected (or possiblyairgapped) machines.The value of this recent finding is twofold: First, it suggests that yet another team withits own malware platform was involved in the early development of Stuxnet. And secondly, itsupports the view that Stuxnet is in fact the product of a modular development frameworkmeant to enable collaboration among diverse, independent threat actors. Our recent findings,alongside the outstanding body of previously reported technical analysis on this threat, wouldplace the â€˜Flowershop teamâ€™ alongside Equation, Flame, and Duqu as those involved in toolingthe different phases of Stuxnet as an operation active perhaps as early as 2006. Perhaps themost apt metaphor for Stuxnet is that of a â€˜plane built as its being flownâ€™.
* link: https://storage.googleapis.com/chronicle-research/STUXSHOP%20Stuxnet%20Dials%20In%20.pdf

### Network activity
* url: http://211.24.237.226/index.php?data= — Stuxshop samples identified thus far contain four hardcoded C&C servers such as
* url: http://todaysfutbol.com/index.php?data= — Stuxshop samples identified thus far contain four hardcoded C&C servers such as
* url: http://78.111.169.146/index.php?data= — Stuxshop samples identified thus far contain four hardcoded C&C servers such as
* url: http://mypremierfutbol.com/index.php?data= — Stuxshop samples identified thus far contain four hardcoded C&C servers such as

### Payload delivery
* sha256: <sha256> — Stuxshop Modules
* sha256: <sha256> — Stuxshop Modules
* sha256: <sha256> — Stuxnet Installer with Embedded Stuxshop
* sha256: <sha256> — Stuxnet Installers with Resource 231
* sha256: <sha256> — Stuxnet Installers with Resource 231
* sha256: <sha256> — Deobfuscated Resource 231/Stuxshop modules
* sha256: <sha256> — Flowershop samples with relevant code overlap
* sha256: <sha256> — Flowershop samples with relevant code overlap
* sha256: <sha256> — Flowershop samples with relevant code overlap
* sha256: <sha256> — Flowershop samples with relevant code overlap
* sha256: <sha256> — Flowershop samples with relevant code overlap

## Objects
### file — File object describing a file with meta-information
* [Payload delivery] md5: <md5>
* [Payload delivery] sha256: <sha256>
* [Payload delivery] sha1: <sha1>
* [Other] text: Malicious

### virustotal-report — VirusTotal report
* [Other] datetime: 2019-04-09T09:00:19
* [Payload delivery] link: https://www.virustotal.com/file/c1961e54d60e34bbec397c9120564e8d08f2f243ae349d2fb20f736510716579/analysis/1554800419/
* [Payload delivery] text: 44/70

### file — File object describing a file with meta-information
* [Payload delivery] malware-sample: c1961e54d60e34bbec397c9120564e8d08f2f243ae349d2fb20f736510716579|455abb43295b9a69e355e4e43457bf30
* [Payload delivery] filename: c1961e54d60e34bbec397c9120564e8d08f2f243ae349d2fb20f736510716579
* [Payload delivery] md5: <md5>
* [Payload delivery] sha1: <sha1>
* [Payload delivery] sha256: <sha256>
* [Other] size-in-bytes: 72456

### domain-ip — A domain and IP address seen as a tuple in a specific time frame.
* [Network activity] ip-dst: 211.24.237.226
* [Network activity] domain: todaysfutbol.com

### domain-ip — A domain and IP address seen as a tuple in a specific time frame.
* [Network activity] ip-dst: 78.111.169.146
* [Network activity] domain: mypremierfutbol.com

### file — File object describing a file with meta-information
* [Other] text: We wondered about the deployment of these curious samples. All of the functionality pointed to
a command-and-control module meant to function alongside other components, and not as a
standalone piece. As we hunted, we came across an unpacked/unobfuscated sample of
Stuxnet presumably compiled in 2009 that contained Stuxshop in its entirety
* [Payload delivery] md5: <md5>
* [Payload delivery] sha256: <sha256>
* [Payload delivery] sha1: <sha1>
* [Other] text: Malicious

### file — File object describing a file with meta-information
* [Payload delivery] md5: <md5> — Flowershop samples with relevant code overlap
* [Payload delivery] sha1: <sha1> — Flowershop samples with relevant code overlap
* [Payload delivery] sha256: <sha256> — Flowershop samples with relevant code overlap

### virustotal-report — VirusTotal report
* [Other] datetime: 2019-04-09T14:27:10 — Flowershop samples with relevant code overlap
* [Payload delivery] link: https://www.virustotal.com/file/c074aeef97ce81e8c68b7376b124546cabf40e2cd3aff1719d9daa6c3f780532/analysis/1554820030/ — Flowershop samples with relevant code overlap
* [Payload delivery] text: 45/70 — Flowershop samples with relevant code overlap

### file — File object describing a file with meta-information
* [Payload delivery] md5: <md5> — Flowershop samples with relevant code overlap
* [Payload delivery] sha1: <sha1> — Flowershop samples with relevant code overlap
* [Payload delivery] sha256: <sha256> — Flowershop samples with relevant code overlap

### virustotal-report — VirusTotal report
* [Other] datetime: 2019-04-09T17:37:54 — Flowershop samples with relevant code overlap
* [Payload delivery] link: https://www.virustotal.com/file/683ce2c7c80b180768fe4d2a39030dc7c4f67db79d1953ee4803522131f533a3/analysis/1554831474/ — Flowershop samples with relevant code overlap
* [Payload delivery] text: 27/65 — Flowershop samples with relevant code overlap

### file — File object describing a file with meta-information
* [Payload delivery] md5: <md5> — Flowershop samples with relevant code overlap
* [Payload delivery] sha1: <sha1> — Flowershop samples with relevant code overlap
* [Payload delivery] sha256: <sha256> — Flowershop samples with relevant code overlap

### virustotal-report — VirusTotal report
* [Other] datetime: 2019-04-09T14:27:24 — Flowershop samples with relevant code overlap
* [Payload delivery] link: https://www.virustotal.com/file/ec41b029c3ff4147b6a5252cb8b659f851f4538d4af0a574f7e16bc1cd14a300/analysis/1554820044/ — Flowershop samples with relevant code overlap
* [Payload delivery] text: 45/69 — Flowershop samples with relevant code overlap

### file — File object describing a file with meta-information
* [Payload delivery] md5: <md5> — Flowershop samples with relevant code overlap
* [Payload delivery] sha1: <sha1> — Flowershop samples with relevant code overlap
* [Payload delivery] sha256: <sha256> — Flowershop samples with relevant code overlap

### virustotal-report — VirusTotal report
* [Other] datetime: 2019-04-09T14:25:43 — Flowershop samples with relevant code overlap
* [Payload delivery] link: https://www.virustotal.com/file/32159d2a16397823bc882ddd3cd77ecdbabe0fde934e62f297b8ff4d7b89832a/analysis/1554819943/ — Flowershop samples with relevant code overlap
* [Payload delivery] text: 44/70 — Flowershop samples with relevant code overlap

### file — File object describing a file with meta-information
* [Payload delivery] md5: <md5> — Stuxshop Modules
* [Payload delivery] sha1: <sha1> — Stuxshop Modules
* [Payload delivery] sha256: <sha256> — Stuxshop Modules

### virustotal-report — VirusTotal report
* [Other] datetime: 2019-04-09T17:37:53 — Stuxshop Modules
* [Payload delivery] link: https://www.virustotal.com/file/1daa2b15b70e486927c8fc06eed434080ab408a1b320be9fefe193c20d1d9a7f/analysis/1554831473/ — Stuxshop Modules
* [Payload delivery] text: 43/68 — Stuxshop Modules

### file — File object describing a file with meta-information
* [Payload delivery] md5: <md5> — Flowershop samples with relevant code overlap
* [Payload delivery] sha1: <sha1> — Flowershop samples with relevant code overlap
* [Payload delivery] sha256: <sha256> — Flowershop samples with relevant code overlap

### virustotal-report — VirusTotal report
* [Other] datetime: 2019-04-09T14:20:50 — Flowershop samples with relevant code overlap
* [Payload delivery] link: https://www.virustotal.com/file/63735d555f219765d486b3d253e39bd316bbcb1c0ec595ea45ddf6e419bef3cb/analysis/1554819650/ — Flowershop samples with relevant code overlap
* [Payload delivery] text: 45/71 — Flowershop samples with relevant code overlap

### file — File object describing a file with meta-information
* [Payload delivery] md5: <md5> — Stuxnet Installers with Resource 231
* [Payload delivery] sha1: <sha1> — Stuxnet Installers with Resource 231
* [Payload delivery] sha256: <sha256> — Stuxnet Installers with Resource 231

### virustotal-report — VirusTotal report
* [Other] datetime: 2019-04-09T17:37:55 — Stuxnet Installers with Resource 231
* [Payload delivery] link: https://www.virustotal.com/file/a01845255bdc61b610cac269a5562ad09415aaf2a1490d53d55c4c3597670803/analysis/1554831475/ — Stuxnet Installers with Resource 231
* [Payload delivery] text: 44/64 — Stuxnet Installers with Resource 231

### file — File object describing a file with meta-information
* [Payload delivery] md5: <md5> — Stuxnet Installers with Resource 231
* [Payload delivery] sha1: <sha1> — Stuxnet Installers with Resource 231
* [Payload delivery] sha256: <sha256> — Stuxnet Installers with Resource 231

### virustotal-report — VirusTotal report
* [Other] datetime: 2019-04-09T17:37:55 — Stuxnet Installers with Resource 231
* [Payload delivery] link: https://www.virustotal.com/file/77211838bb6783121fe1aeff182c8cc1cba9c9f0c1e5a0027e0c0b9dfa18e2ac/analysis/1554831475/ — Stuxnet Installers with Resource 231
* [Payload delivery] text: 53/70 — Stuxnet Installers with Resource 231

### malware-config — Malware configuration recovered or extracted from a malicious binary.
* [Other] text: F117FA1CE233C1D7BB7726C0E49615C4622E2D1895F0D8AD4B23BADC4FD70C
* [Other] text: not included
* [Other] text: other

### registry-key — Registry key object describing a Windows registry key with value and last-modified timestamp
* [Persistence mechanism] regkey: SOFTWARE\Microsoft\Windows\CurrentVersion\MS-DOS Emulation
* [Persistence mechanism] text: NTVDM â€‹ TRACE
* [Persistence mechanism] text: 19790509
* [Other] text: HKCC
* [Persistence mechanism] text: REG_NONE
