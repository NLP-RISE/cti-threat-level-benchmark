# Threat Report: 2023-04-13: HALFRIG - Malware Analysis Report


## Key Intelligence
* Date: 2023-04-13
* Threat Level: 1 (High)
* Tags: type:OSINT, osint:lifetime="perpetual", tlp:white, tlp:clear, misp-galaxy:tool="HALFRIG", misp-galaxy:mitre-attack-pattern="Virtual Private Server - T1583.003", misp-galaxy:mitre-attack-pattern="Compromise Infrastructure - T1584", misp-galaxy:mitre-attack-pattern="Phishing - T1566", misp-galaxy:mitre-attack-pattern="Spearphishing Attachment - T1566.001", misp-galaxy:mitre-attack-pattern="User Execution - T1204", misp-galaxy:mitre-attack-pattern="Malicious File - T1204.002", misp-galaxy:mitre-attack-pattern="Registry Run Keys / Startup Folder - T1547.001", misp-galaxy:mitre-attack-pattern="DLL Search Order Hijacking - T1574.001", misp-galaxy:mitre-attack-pattern="DLL Side-Loading - T1574.002", misp-galaxy:mitre-attack-pattern="HTML Smuggling - T1027.006", misp-galaxy:mitre-attack-pattern="Deobfuscate/Decode Files or Information - T1140", misp-galaxy:mitre-attack-pattern="Mark-of-the-Web Bypass - T1553.005", admiralty-scale:source-reliability="a", estimative-language:confidence-in-analytic-judgment="high", estimative-language:likelihood-probability="almost-certain"

---

## Indicators of Compromise (IOCs)
### Network activity
* pattern-in-traffic: sawabfoundation.net/p.php?ip=<IP>&ua=<USER_AGENT> — Pattern-ENVYSCOUT backend fingerprint collector
* url: sawabfoundation.net/note.html — ENVYSCOUT
* domain: sawabfoundation.net — compromised hosting used for ENVYSCOUT
* domain: communitypowersports.com — CobaltStrike redirector
* domain: sanjosemotosport.com — Actual CobaltStrike C2

## Objects
### report — Metadata used to generate an executive level report
* [External analysis] link: https://www.gov.pl/attachment/64193e8d-05e2-4cbf-bb4c-5f58da21fefb
* [Other] text: HALFRIG is a stager for CobaltStrike Beacon that was used in an espionage campaign significantly
overlapping with publicly described activity linked to the APT291 and NOBELIUM2 activity sets. HALFRIG
has significant code overlap with the QUARTERRIG and it is highly probable that it was developed
by the same team.
* [Other] text: Report
* [External analysis] attachment: HALFRIG_.pdf

### yara — An object describing a YARA rule (or a YARA rule name) along with its version.
* [Other] comment: A rule that can be used to scan for HALFRIG
* [External analysis] link: https://www.gov.pl/attachment/64193e8d-05e2-4cbf-bb4c-5f58da21fefb
* [Payload installation] yara: rule APT29_HALFRIG_OBFUSCATION
{
meta:
description = "Detects obfuscation patterns used in HALFRIG. This rule wasn't tested against large dataset, it should be used for threat hunting and not on services like VTI."

strings:

// Decryption constants and decryption operation

$ = {48 BB 0B 91 09 19 4D FD 9B F3 }


$ = {4D 8D 40 01 48 8B CA 48 8B C2 48 C1 E9 38 48 83 C9 01 48 C1 E0 08 48 8B D1 48 33 D0}


$ = {C7 05 [3] 00 F7 91 4D 01 }

 condition:

uint16(0) == 0x5A4D

and

filesize < 500KB

and

all of them
}
* [Other] text: APT29_HALFRIG_OBFUSCATION

### file — File object describing a file with meta-information
* [Payload delivery] sha1: <sha1>
* [Payload delivery] md5: <md5>
* [Payload delivery] sha256: <sha256>
* [Payload delivery] filename: Note.exe
* [Other] size-in-bytes: 1597000

### file — File object describing a file with meta-information
* [Payload delivery] sha1: <sha1>
* [Payload delivery] md5: <md5>
* [Payload delivery] sha256: <sha256>
* [Payload delivery] filename: Note.iso
* [Other] size-in-bytes: 2688000

### file — File object describing a file with meta-information
* [Payload delivery] sha1: <sha1>
* [Payload delivery] md5: <md5>
* [Payload delivery] sha256: <sha256>
* [Payload delivery] filename: AppvIsvSubsystems64.dll
* [Other] size-in-bytes: 27000

### file — File object describing a file with meta-information
* [Payload delivery] sha1: <sha1>
* [Payload delivery] md5: <md5>
* [Payload delivery] sha256: <sha256>
* [Payload delivery] filename: msword.dll
* [Other] size-in-bytes: 53000

### file — File object describing a file with meta-information
* [Payload delivery] sha1: <sha1>
* [Payload delivery] md5: <md5>
* [Payload delivery] sha256: <sha256>
* [Payload delivery] filename: envsrv.dll
* [Other] size-in-bytes: 56000

### file — File object describing a file with meta-information
* [Payload delivery] sha1: <sha1>
* [Payload delivery] md5: <md5>
* [Payload delivery] sha256: <sha256>
* [Payload delivery] filename: mschost.dll
* [Other] size-in-bytes: 391000

### process — Object describing a system process.
* [Other] text: RunTimeBroker.exe

### process — Object describing a system process.
* [Other] text: TaskHostW.exe

### process — Object describing a system process.
* [Other] text: Svchost.exe

### process — Object describing a system process.
* [Other] text: IpfHelper.exe

### process — Object describing a system process.
* [Other] text: SecurityHealthService.exe

### process — Object describing a system process.
* [Other] text: ApplicationFrameHost.exe
