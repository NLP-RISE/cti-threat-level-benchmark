# Threat Report: 2018-06-20: OSINT - GZipDe: An Encrypted Downloader Serving Metasploit


## Key Intelligence
* Date: 2018-06-20
* Threat Level: 3 (Low)
* Tags: tlp:white, circl:incident-classification="malware", osint:source-type="blog-post", workflow:todo="add-missing-misp-galaxy-cluster-values", workflow:todo="expansion"

---

## Indicators of Compromise (IOCs)
### External analysis
* link: https://www.alienvault.com/blogs/labs-research/gzipde-an-encrypted-downloader-serving-metasploit
* text: At the end of May a Middle Eastern news network published an article about the next Shanghai Cooperation Organization Summit. A week ago, AlienVault Labs detected a new malicious document targeting the area. It uses a piece of text taken from the report as a decoy:
* attachment: GZipDe_malicious_document.png

### Network activity
* url: http://118.193.251.137/dropbox/filesfhjdfkjsjdkfjsdkfjsdfjksdfjsdkfasdfjnadsfjnasdnj/utorrent.exe
* url: http://118.193.251.137/dropbox/?p=BT67HU78HZ
* ip-dst: 175.194.42.8
* ip-dst: 118.193.251.137

### Payload delivery
* yara: rule gzipde_hunt {

    meta:

        author = "AlienVault Labs"

        description = "Hunt rule to identify files related to Gzipde"

        copyright = "Alienvault Inc. 2018"

        reference = "https://otx.alienvault.com/pulse/5b239254174e5d5edab34e05"

  strings:

    $a = "118.193.251.137" nocase wide ascii

    $b = "BT67HU78HZ" nocase wide ascii

    $c = "2E0EB747-BE46-441A-A8B1-97AB27B49EC5" nocase wide ascii

    $d = "gzipde.pdb" nocase wide ascii

    $e = "C:\\Users\\jhon\\Documents\\Visual Studio 2008" nocase wide ascii

  condition:

    any of them

}


import "dotnet"

rule MeterpreterEncryptedPayloadDotNetGzipDE {

            meta:

                        type = "malware"

                        description = "GZipDe"

                        author = "jblasco@alienvault.com"

                        reference1 = "https://github.com/DamonMohammadbagher/NativePayload_Reverse_tcp/blob/master/NativePayload_Reverse_tcp.cs"

                        reference2= "https://otx.alienvault.com/indicator/file/33c03d94f75698fac6a39a5a6c328c2be4a079717520e0ec411597b9ca3a9bef"

            strings:

                        $pdb = "gzipde.pdb"

                        $st1 = "PAGE_EXECUTE_READWRITE"

                        $st2 = "EncryptInitalize"

                        $st3 = "EncryptOutput"

                        $st4 = "CreateThread"

                        $st5 = "VirtualAlloc"

            condition:

                        uint16(0) == 0x5A4D and

                        ((dotnet.typelib == "c1181bc0-0102-44e9-82ba-7c1ca7d24219" and

                        dotnet.guids[0] == "2e0eb747-be46-441a-a8b1-97ab27b49ec5") or

                        $pdb or

                        (dotnet.number_of_modulerefs == 1 and

                        dotnet.modulerefs[0] == "kernel32" and

                        all of ($st*)))

}

## Objects
### file — File object describing a file with meta-information
* [Payload delivery] md5: <md5>
* [Payload delivery] sha1: <sha1>
* [Payload delivery] sha256: <sha256>
* [Other] text: Malicious
* [Other] size-in-bytes: 60416

### pe — Object describing a Portable Executable
* [Other] text: PE32 executable (GUI) Intel 80386 Mono/.Net assembly, for MS Windows
* [Other] text: exe
* [Payload delivery] imphash: <imphash>
* [Payload delivery] pehash: <pehash>

### file — File object describing a file with meta-information
* [Payload delivery] md5: <md5>
* [Payload delivery] sha1: <sha1>
* [Payload delivery] sha256: <sha256>
* [Other] text: Malicious
* [Other] size-in-bytes: 10240

### file — File object describing a file with meta-information
* [Payload delivery] md5: <md5>
* [Payload delivery] sha1: <sha1>
* [Payload delivery] sha256: <sha256>
* [Other] text: Malicious
* [Other] size-in-bytes: 17951

### file — File object describing a file with meta-information
* [Payload delivery] md5: <md5>
* [Payload delivery] sha1: <sha1>
* [Payload delivery] sha256: <sha256>
* [Other] text: Malicious
* [Other] size-in-bytes: 483840
