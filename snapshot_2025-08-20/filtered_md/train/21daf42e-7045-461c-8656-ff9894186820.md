# Threat Report: 2021-07-16: OSINT -  Protecting customers from a private-sector offensive actor using 0-day exploits and DevilsTongue malware


## Key Intelligence
* Date: 2021-07-16
* Threat Level: 1 (High)
* Tags: type:OSINT, osint:lifetime="perpetual", osint:certainty="50", tlp:white

---

## Indicators of Compromise (IOCs)
### External analysis
* vulnerability: CVE-2021-31979
* vulnerability: CVE-2021-33771

### Network activity
* domain: noc-service-streamer.com
* domain: fbcdnads.live
* domain: hilocake.info
* domain: backxercise.com
* domain: winmslaf.xyz
* domain: service-deamon.com
* domain: online-affiliate-mon.com
* domain: codeingasmylife.com
* domain: kenoratravels.com
* domain: weathercheck.digital
* domain: colorpallatess.com
* domain: library-update.com
* domain: online-source-validate.com
* domain: grayhornet.com
* domain: johnshopkin.net
* domain: eulenformacion.com
* domain: pochtarossiy.info

## Objects
### report — Metadata used to generate an executive level report
* [External analysis] link: https://www.microsoft.com/security/blog/2021/07/15/protecting-customers-from-a-private-sector-offensive-actor-using-0-day-exploits-and-devilstongue-malware/
* [Other] text: The Microsoft Threat Intelligence Center (MSTIC) alongside the Microsoft Security Response Center (MSRC) has uncovered a private-sector offensive actor, or PSOA, that we are calling SOURGUM in possession of now-patched, Windows 0-day exploits (CVE-2021-31979 and CVE-2021-33771).

Private-sector offensive actors are private companies that manufacture and sell cyberweapons in hacking-as-a-service packages, often to government agencies around the world, to hack into their targets’ computers, phones, network infrastructure, and other devices. With these hacking packages, usually the government agencies choose the targets and run the actual operations themselves. The tools, tactics, and procedures used by these companies only adds to the complexity, scale, and sophistication of attacks. We take these threats seriously and have moved swiftly alongside our partners to build in the latest protections for our customers.

MSTIC believes SOURGUM is an Israel-based private-sector offensive actor. We would like to thank the Citizen Lab, at the University of Toronto’s Munk School, for sharing the sample of malware that initiated this work and their collaboration during the investigation. In their blog, Citizen Lab asserts with high confidence that SOURGUM is an Israeli company commonly known as Candiru. Third-party reports indicate Candiru produces “hacking tools [that] are used to break into computers and servers”.
* [Other] text: Blog post

### vulnerability — Vulnerability object describing a common vulnerability enumeration which can describe published, unpublished, under review or embargo vulnerability for software, equipments or hardware.
* [External analysis] vulnerability: CVE-2021-31979 — CVE-2021-31979: Enriched via the cve_advanced module
* [Other] text: Windows Kernel Elevation of Privilege Vulnerability This CVE ID is unique from CVE-2021-33771, CVE-2021-34514. — CVE-2021-31979: Enriched via the cve_advanced module
* [Other] datetime: 2021-07-14T19:14:00+00:00 — CVE-2021-31979: Enriched via the cve_advanced module
* [Other] datetime: 2021-07-14T18:15:00+00:00 — CVE-2021-31979: Enriched via the cve_advanced module
* [Other] text: Published — CVE-2021-31979: Enriched via the cve_advanced module
* [External analysis] link: https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2021-31979 — CVE-2021-31979: Enriched via the cve_advanced module

### vulnerability — Vulnerability object describing a common vulnerability enumeration which can describe published, unpublished, under review or embargo vulnerability for software, equipments or hardware.
* [External analysis] vulnerability: CVE-2021-33771 — CVE-2021-33771: Enriched via the cve_advanced module
* [Other] text: Windows Kernel Elevation of Privilege Vulnerability This CVE ID is unique from CVE-2021-31979, CVE-2021-34514. — CVE-2021-33771: Enriched via the cve_advanced module
* [Other] datetime: 2021-07-14T19:14:00+00:00 — CVE-2021-33771: Enriched via the cve_advanced module
* [Other] datetime: 2021-07-14T18:15:00+00:00 — CVE-2021-33771: Enriched via the cve_advanced module
* [Other] text: Published — CVE-2021-33771: Enriched via the cve_advanced module
* [External analysis] link: https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2021-33771 — CVE-2021-33771: Enriched via the cve_advanced module

### yara — An object describing a YARA rule (or a YARA rule name) along with its version.
* [Other] text: all
* [Payload installation] yara: import "pe"
rule DevilsTongue_HijackDll
{
meta:
description = "Detects SOURGUM's DevilsTongue hijack DLL"
author = "Microsoft Threat Intelligence Center (MSTIC)"
date = "2021-07-15"
strings:
$str1 = "windows.old\\windows" wide
$str2 = "NtQueryInformationThread"
$str3 = "dbgHelp.dll" wide
$str4 = "StackWalk64"
$str5 = "ConvertSidToStringSidW"
$str6 = "S-1-5-18" wide
$str7 = "SMNew.dll" // DLL original name
// Call check in stack manipulation
// B8 FF 15 00 00   mov     eax, 15FFh
// 66 39 41 FA      cmp     [rcx-6], ax
// 74 06            jz      short loc_1800042B9
// 80 79 FB E8      cmp     byte ptr [rcx-5], 0E8h ; 'è'
$code1 = {B8 FF 15 00 00 66 39 41 FA 74 06 80 79 FB E8}
// PRNG to generate number of times to sleep 1s before exiting
// 44 8B C0 mov r8d, eax
// B8 B5 81 4E 1B mov eax, 1B4E81B5h
// 41 F7 E8 imul r8d
// C1 FA 05 sar edx, 5
// 8B CA    mov ecx, edx
// C1 E9 1F shr ecx, 1Fh
// 03 D1    add edx, ecx
// 69 CA 2C 01 00 00 imul ecx, edx, 12Ch
// 44 2B C1 sub r8d, ecx
// 45 85 C0 test r8d, r8d
// 7E 19    jle  short loc_1800014D0
$code2 = {44 8B C0 B8 B5 81 4E 1B 41 F7 E8 C1 FA 05 8B CA C1 E9 1F 03 D1 69 CA 2C 01 00 00 44 2B C1 45 85 C0 7E 19}
condition:
filesize < 800KB and
uint16(0) == 0x5A4D and
(pe.characteristics & pe.DLL) and
(
4 of them or
($code1 and $code2) or
(pe.imphash() == "9a964e810949704ff7b4a393d9adda60")
)
}

### file — File object describing a file with meta-information
* [Payload delivery] md5: <md5>
* [Payload delivery] sha1: <sha1>
* [Payload delivery] sha256: <sha256>
