# Threat Report: 2017-07-31: OSINT - TwoFace Webshell: Persistent Access Point for Lateral Movement


## Key Intelligence
* Date: 2017-07-31
* Threat Level: 3 (Low)
* Tags: tlp:white

---

## Indicators of Compromise (IOCs)
### Artifacts dropped
* sha1: <sha1> — The TwoFace payload shell requires a password that is sent within HTTP POST data or within the HTTP Cookie, specifically with a field with a name â€œpwdâ€. The â€œpwdâ€ field is used for authentication as a password, which the payload will generate the SHA1 hash and compare it with a hash that is hardcoded within the payload. We extracted the SHA1 hashes used for authentication from the known TwoFace shells, as seen in Table 4 and were able to find the associated password string for three of them. One of the passwords, â€œRamdanAlKarim12â€ contains a phrase that means â€œRamadan the generousâ€ in Arabic (Ø±Ù…Ø¶Ø§Ù† Ø§Ù„ÙƒØ±ÙŠÙ…). Another known password is â€œFreeMe!â€, while the last known password contains what may be an acronym of a middle eastern energy organization followed by â€œpassâ€. It is possible that the actor chose this acronym based on the targeted organization, but we cannot confirm this.
* sha1: <sha1> — The TwoFace payload shell requires a password that is sent within HTTP POST data or within the HTTP Cookie, specifically with a field with a name â€œpwdâ€. The â€œpwdâ€ field is used for authentication as a password, which the payload will generate the SHA1 hash and compare it with a hash that is hardcoded within the payload. We extracted the SHA1 hashes used for authentication from the known TwoFace shells, as seen in Table 4 and were able to find the associated password string for three of them. One of the passwords, â€œRamdanAlKarim12â€ contains a phrase that means â€œRamadan the generousâ€ in Arabic (Ø±Ù…Ø¶Ø§Ù† Ø§Ù„ÙƒØ±ÙŠÙ…). Another known password is â€œFreeMe!â€, while the last known password contains what may be an acronym of a middle eastern energy organization followed by â€œpassâ€. It is possible that the actor chose this acronym based on the targeted organization, but we cannot confirm this.
* sha1: <sha1> — The TwoFace payload shell requires a password that is sent within HTTP POST data or within the HTTP Cookie, specifically with a field with a name â€œpwdâ€. The â€œpwdâ€ field is used for authentication as a password, which the payload will generate the SHA1 hash and compare it with a hash that is hardcoded within the payload. We extracted the SHA1 hashes used for authentication from the known TwoFace shells, as seen in Table 4 and were able to find the associated password string for three of them. One of the passwords, â€œRamdanAlKarim12â€ contains a phrase that means â€œRamadan the generousâ€ in Arabic (Ø±Ù…Ø¶Ø§Ù† Ø§Ù„ÙƒØ±ÙŠÙ…). Another known password is â€œFreeMe!â€, while the last known password contains what may be an acronym of a middle eastern energy organization followed by â€œpassâ€. It is possible that the actor chose this acronym based on the targeted organization, but we cannot confirm this.
* sha1: <sha1> — The TwoFace payload shell requires a password that is sent within HTTP POST data or within the HTTP Cookie, specifically with a field with a name â€œpwdâ€. The â€œpwdâ€ field is used for authentication as a password, which the payload will generate the SHA1 hash and compare it with a hash that is hardcoded within the payload. We extracted the SHA1 hashes used for authentication from the known TwoFace shells, as seen in Table 4 and were able to find the associated password string for three of them. One of the passwords, â€œRamdanAlKarim12â€ contains a phrase that means â€œRamadan the generousâ€ in Arabic (Ø±Ù…Ø¶Ø§Ù† Ø§Ù„ÙƒØ±ÙŠÙ…). Another known password is â€œFreeMe!â€, while the last known password contains what may be an acronym of a middle eastern energy organization followed by â€œpassâ€. It is possible that the actor chose this acronym based on the targeted organization, but we cannot confirm this.
* sha1: <sha1> — The TwoFace payload shell requires a password that is sent within HTTP POST data or within the HTTP Cookie, specifically with a field with a name â€œpwdâ€. The â€œpwdâ€ field is used for authentication as a password, which the payload will generate the SHA1 hash and compare it with a hash that is hardcoded within the payload. We extracted the SHA1 hashes used for authentication from the known TwoFace shells, as seen in Table 4 and were able to find the associated password string for three of them. One of the passwords, â€œRamdanAlKarim12â€ contains a phrase that means â€œRamadan the generousâ€ in Arabic (Ø±Ù…Ø¶Ø§Ù† Ø§Ù„ÙƒØ±ÙŠÙ…). Another known password is â€œFreeMe!â€, while the last known password contains what may be an acronym of a middle eastern energy organization followed by â€œpassâ€. It is possible that the actor chose this acronym based on the targeted organization, but we cannot confirm this.
* sha1: <sha1> — The TwoFace payload shell requires a password that is sent within HTTP POST data or within the HTTP Cookie, specifically with a field with a name â€œpwdâ€. The â€œpwdâ€ field is used for authentication as a password, which the payload will generate the SHA1 hash and compare it with a hash that is hardcoded within the payload. We extracted the SHA1 hashes used for authentication from the known TwoFace shells, as seen in Table 4 and were able to find the associated password string for three of them. One of the passwords, â€œRamdanAlKarim12â€ contains a phrase that means â€œRamadan the generousâ€ in Arabic (Ø±Ù…Ø¶Ø§Ù† Ø§Ù„ÙƒØ±ÙŠÙ…). Another known password is â€œFreeMe!â€, while the last known password contains what may be an acronym of a middle eastern energy organization followed by â€œpassâ€. It is possible that the actor chose this acronym based on the targeted organization, but we cannot confirm this.
* sha1: <sha1> — The TwoFace payload shell requires a password that is sent within HTTP POST data or within the HTTP Cookie, specifically with a field with a name â€œpwdâ€. The â€œpwdâ€ field is used for authentication as a password, which the payload will generate the SHA1 hash and compare it with a hash that is hardcoded within the payload. We extracted the SHA1 hashes used for authentication from the known TwoFace shells, as seen in Table 4 and were able to find the associated password string for three of them. One of the passwords, â€œRamdanAlKarim12â€ contains a phrase that means â€œRamadan the generousâ€ in Arabic (Ø±Ù…Ø¶Ø§Ù† Ø§Ù„ÙƒØ±ÙŠÙ…). Another known password is â€œFreeMe!â€, while the last known password contains what may be an acronym of a middle eastern energy organization followed by â€œpassâ€. It is possible that the actor chose this acronym based on the targeted organization, but we cannot confirm this.
* sha1: <sha1> — The TwoFace payload shell requires a password that is sent within HTTP POST data or within the HTTP Cookie, specifically with a field with a name â€œpwdâ€. The â€œpwdâ€ field is used for authentication as a password, which the payload will generate the SHA1 hash and compare it with a hash that is hardcoded within the payload. We extracted the SHA1 hashes used for authentication from the known TwoFace shells, as seen in Table 4 and were able to find the associated password string for three of them. One of the passwords, â€œRamdanAlKarim12â€ contains a phrase that means â€œRamadan the generousâ€ in Arabic (Ø±Ù…Ø¶Ø§Ù† Ø§Ù„ÙƒØ±ÙŠÙ…). Another known password is â€œFreeMe!â€, while the last known password contains what may be an acronym of a middle eastern energy organization followed by â€œpassâ€. It is possible that the actor chose this acronym based on the targeted organization, but we cannot confirm this.

### External analysis
* text: While investigating a recent security incident, Unit 42 found a webshell that we believe was used by the threat actor to remotely access the network of a targeted Middle Eastern organization. The construction of the webshell was interesting by itself, as it was actually two separate webshells: an initial webshell that was responsible for saving and loading the second fully functional webshell. It is this second webshell that enabled the threat actor to run a variety of commands on the compromised server. Due to these two layers, we use the name TwoFace to track this webshell.

During our analysis, we extracted the commands executed by the TwoFace webshell from the server logs on the compromised server. Our analysis shows that the commands issued by the threat actor date back to June 2016; this suggests that the actor had access to this shell for almost an entire year. The commands issued show the actor was interested in gathering credentials from the compromised server using the Mimikatz tool. We also saw the attacker using the TwoFace webshell to move laterally through the network by copying itself and other webshells to other servers.
* link: https://researchcenter.paloaltonetworks.com/2017/07/unit42-twoface-webshell-persistent-access-point-lateral-movement/
* link: https://www.virustotal.com/file/f17272d146f4d46dda5dc2791836bfa783bdc09ca062f33447e4f3a26f26f4e0/analysis/1501873561/ — Mimikatz - Xchecked via VT: f17272d146f4d46dda5dc2791836bfa783bdc09ca062f33447e4f3a26f26f4e0
* link: https://www.virustotal.com/file/49f43f2caaea89bd3bb137f4228e543783ef265abbdc84e3743d93a7d30b0a7e/analysis/1501873544/ — IntrudingDivisor Shell - Xchecked via VT: 49f43f2caaea89bd3bb137f4228e543783ef265abbdc84e3743d93a7d30b0a7e
* link: https://www.virustotal.com/file/fd47825d75e3da3e43dc84f425178d6e834a900d6b2fd850ee1083dbb1e5b113/analysis/1501873497/ — TwoFace Payload - Xchecked via VT: fd47825d75e3da3e43dc84f425178d6e834a900d6b2fd850ee1083dbb1e5b113
* link: https://www.virustotal.com/file/818ac924fd8f7bc1b6062a8ef456226a47c4c59d2f9e38eda89fff463253942f/analysis/1501873479/ — TwoFace Payload - Xchecked via VT: 818ac924fd8f7bc1b6062a8ef456226a47c4c59d2f9e38eda89fff463253942f
* link: https://www.virustotal.com/file/54c8bfa0be1d1419bf0770d49e937b284b52df212df19551576f73653a7d061f/analysis/1501873465/ — TwoFace Payload - Xchecked via VT: 54c8bfa0be1d1419bf0770d49e937b284b52df212df19551576f73653a7d061f
* link: https://www.virustotal.com/file/0a77e28e6d0d7bd057167ca8a63da867397f1619a38d5c713027ebb22b784d4f/analysis/1501954505/ — TwoFace Payload - Xchecked via VT: 0a77e28e6d0d7bd057167ca8a63da867397f1619a38d5c713027ebb22b784d4f
* link: https://www.virustotal.com/file/8f0419493da5ba201429503e53c9ccb8f8170ab73141bdc6ae6b9771512ad84b/analysis/1501873416/ — TwoFace Payload - Xchecked via VT: 8f0419493da5ba201429503e53c9ccb8f8170ab73141bdc6ae6b9771512ad84b
* link: https://www.virustotal.com/file/8d178b9730e09e35c071526bfb91ce72f876797ebc4e81f0bc05e7bb8ad1734e/analysis/1501873395/ — TwoFace++ Loader - Xchecked via VT: 8d178b9730e09e35c071526bfb91ce72f876797ebc4e81f0bc05e7bb8ad1734e
* link: https://www.virustotal.com/file/bca01f14fb3cb4cfbe7f240156feebc55abac73a6c96b9f75da2f9df580101ef/analysis/1501873378/ — TwoFace++ Loader - Xchecked via VT: bca01f14fb3cb4cfbe7f240156feebc55abac73a6c96b9f75da2f9df580101ef
* link: https://www.virustotal.com/file/d0ffd613b1b285b15e2d6c038b0bd4951eb40eb802617cf6eb4f56cda4b023e3/analysis/1501873357/ — TwoFace Loader - Xchecked via VT: d0ffd613b1b285b15e2d6c038b0bd4951eb40eb802617cf6eb4f56cda4b023e3
* link: https://www.virustotal.com/file/9a361019f6fbd4a246b96545868dcb7908c611934c41166b9aa93519504ac813/analysis/1501873330/ — TwoFace Loader - Xchecked via VT: 9a361019f6fbd4a246b96545868dcb7908c611934c41166b9aa93519504ac813
* link: https://www.virustotal.com/file/f4da5cb72246434decb8cf676758da410f6ddc20196dfd484f513aa3b6bc4ac5/analysis/1501873300/ — TwoFace Loader - Xchecked via VT: f4da5cb72246434decb8cf676758da410f6ddc20196dfd484f513aa3b6bc4ac5

### Payload delivery
* sha256: <sha256> — TwoFace Loader
* sha256: <sha256> — TwoFace Loader
* sha256: <sha256> — TwoFace Loader
* sha256: <sha256> — TwoFace Loader
* sha256: <sha256> — TwoFace++ Loader
* sha256: <sha256> — TwoFace++ Loader
* sha256: <sha256> — TwoFace Payload
* sha256: <sha256> — TwoFace Payload
* sha256: <sha256> — TwoFace Payload
* sha256: <sha256> — TwoFace Payload
* sha256: <sha256> — TwoFace Payload
* sha256: <sha256> — TwoFace Payload
* sha256: <sha256> — TwoFace Payload
* sha256: <sha256> — TwoFace Payload
* sha256: <sha256> — IntrudingDivisor Shell
* sha256: <sha256> — IntrudingDivisor Shell
* sha256: <sha256> — Mimikatz
* sha1: <sha1> — Mimikatz - Xchecked via VT: f17272d146f4d46dda5dc2791836bfa783bdc09ca062f33447e4f3a26f26f4e0
* md5: <md5> — Mimikatz - Xchecked via VT: f17272d146f4d46dda5dc2791836bfa783bdc09ca062f33447e4f3a26f26f4e0
* sha1: <sha1> — IntrudingDivisor Shell - Xchecked via VT: 49f43f2caaea89bd3bb137f4228e543783ef265abbdc84e3743d93a7d30b0a7e
* md5: <md5> — IntrudingDivisor Shell - Xchecked via VT: 49f43f2caaea89bd3bb137f4228e543783ef265abbdc84e3743d93a7d30b0a7e
* sha1: <sha1> — TwoFace Payload - Xchecked via VT: fd47825d75e3da3e43dc84f425178d6e834a900d6b2fd850ee1083dbb1e5b113
* md5: <md5> — TwoFace Payload - Xchecked via VT: fd47825d75e3da3e43dc84f425178d6e834a900d6b2fd850ee1083dbb1e5b113
* sha1: <sha1> — TwoFace Payload - Xchecked via VT: 818ac924fd8f7bc1b6062a8ef456226a47c4c59d2f9e38eda89fff463253942f
* md5: <md5> — TwoFace Payload - Xchecked via VT: 818ac924fd8f7bc1b6062a8ef456226a47c4c59d2f9e38eda89fff463253942f
* sha1: <sha1> — TwoFace Payload - Xchecked via VT: 54c8bfa0be1d1419bf0770d49e937b284b52df212df19551576f73653a7d061f
* md5: <md5> — TwoFace Payload - Xchecked via VT: 54c8bfa0be1d1419bf0770d49e937b284b52df212df19551576f73653a7d061f
* sha1: <sha1> — TwoFace Payload - Xchecked via VT: 0a77e28e6d0d7bd057167ca8a63da867397f1619a38d5c713027ebb22b784d4f
* md5: <md5> — TwoFace Payload - Xchecked via VT: 0a77e28e6d0d7bd057167ca8a63da867397f1619a38d5c713027ebb22b784d4f
* sha1: <sha1> — TwoFace Payload - Xchecked via VT: 8f0419493da5ba201429503e53c9ccb8f8170ab73141bdc6ae6b9771512ad84b
* md5: <md5> — TwoFace Payload - Xchecked via VT: 8f0419493da5ba201429503e53c9ccb8f8170ab73141bdc6ae6b9771512ad84b
* sha1: <sha1> — TwoFace++ Loader - Xchecked via VT: 8d178b9730e09e35c071526bfb91ce72f876797ebc4e81f0bc05e7bb8ad1734e
* md5: <md5> — TwoFace++ Loader - Xchecked via VT: 8d178b9730e09e35c071526bfb91ce72f876797ebc4e81f0bc05e7bb8ad1734e
* sha1: <sha1> — TwoFace++ Loader - Xchecked via VT: bca01f14fb3cb4cfbe7f240156feebc55abac73a6c96b9f75da2f9df580101ef
* md5: <md5> — TwoFace++ Loader - Xchecked via VT: bca01f14fb3cb4cfbe7f240156feebc55abac73a6c96b9f75da2f9df580101ef
* sha1: <sha1> — TwoFace Loader - Xchecked via VT: d0ffd613b1b285b15e2d6c038b0bd4951eb40eb802617cf6eb4f56cda4b023e3
* md5: <md5> — TwoFace Loader - Xchecked via VT: d0ffd613b1b285b15e2d6c038b0bd4951eb40eb802617cf6eb4f56cda4b023e3
* sha1: <sha1> — TwoFace Loader - Xchecked via VT: 9a361019f6fbd4a246b96545868dcb7908c611934c41166b9aa93519504ac813
* md5: <md5> — TwoFace Loader - Xchecked via VT: 9a361019f6fbd4a246b96545868dcb7908c611934c41166b9aa93519504ac813
* sha1: <sha1> — TwoFace Loader - Xchecked via VT: f4da5cb72246434decb8cf676758da410f6ddc20196dfd484f513aa3b6bc4ac5
* md5: <md5> — TwoFace Loader - Xchecked via VT: f4da5cb72246434decb8cf676758da410f6ddc20196dfd484f513aa3b6bc4ac5
