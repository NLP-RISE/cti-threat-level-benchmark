# Threat Report: 2017-08-19: OSINT - EngineBox Malware Supports 10+ Brazilian Banks


## Key Intelligence
* Date: 2017-08-19
* Threat Level: 3 (Low)
* Tags: tlp:white, veris:actor:motive="Financial", circl:topic="finance"

---

## Indicators of Compromise (IOCs)
### External analysis
* text: After receiving quite a big amount of malspam with similar messages in my honeypots this week, I decided to dedicate some time to analyze what it was about. To my surprise, after peeling multiple encoding layers protecting the malwareâ€™s core (felt like peeling an onion), I could finally find a sophisticated and well structured  banker malware capable of stealing victims' credentials of at least 10 of the biggest Brazilian public and private banks and other financial institutions. Additionally, it can also steal browser, SSH and FTP local stored credentials.

The main malware capabilities include a privilege escalation attempt using MS16â€“032 exploitation; a HTTP Proxy to intercept banking transactions; a backdoor to make it possible for the attacker to issue arbitrary remote commands and a C&C through a IRC channel. As it's being identified as a "Generic Trojan" by most of VirusTotal (VT) engines, let's name it "EngineBox"â€” the core malware class I saw after reverse engineering it.

In today's diary, I'm going to describe the main technical aspects of EngineBox. Let's start with the fluxogram in Figure 1, which illustrates the malware's behavior since the infection vector to the malicious actions. Follow the numbers in blue.
* link: https://isc.sans.edu/diary/22736
* attachment: EB-Figure1.png — Overview
* link: https://technet.microsoft.com/en-us/library/security/ms16-032.aspx — Additional references
* link: https://github.com/FuzzySecurity/PowerShell-Suite/blob/master/Invoke-MS16-032.ps1 — Additional references
* link: http://www.ilspy.net/ — Additional references
* link: https://www.virustotal.com/file/e3fe4546a5930d584f9a1ccd0ab0cb8eac041821cc238010f18190cfc25f845a/analysis/1503114310/ — westeros-x.ps - Xchecked via VT: f476db89c2f6621cc36c4a7a11e1e7a3
* link: https://www.virustotal.com/file/70ba57fb0bf2f34b86426d21559f5f6d05c1268193904de8e959d7b06ce964ce/analysis/1503098248/ — malware-binary.exe - Xchecked via VT: eb32c070e658937aa9fa9f3ae629b2b8
* link: https://www.virustotal.com/file/7e476e43a56a56420b5ca05db29979332b327b1c2ccd79f86943a10714afd730/analysis/1503123304/ — aw7.dll - Xchecked via VT: 90ce84d389eabf96b4ad2f3bb083dada
* link: https://www.virustotal.com/file/9663e164be742893c6d1b4586796bff9b778d695823a09cfada18bec0106414a/analysis/1502992532/ — aw7.tiff - Xchecked via VT: bb6756c97ab58fdfeecfe8c75b4bb81e
* link: https://www.virustotal.com/file/c05836c76d0e462bb817742f1c4a9ea2db523161c5b9c8506cfb8c7335060e57/analysis/1503123770/ — 1508201700016067882247230289631.vbs - Xchecked via VT: 78b86206541debb3819e51b7e9c48434
* link: https://www.virustotal.com/file/66c3cae1464231a801b0388a5ea858883118b9ef529fa7071146fae0bdb93565/analysis/1502994328/ — W7.zip - Xchecked via VT: f9f6bc998dcb8a3f04dffcc6b81dcfc3

### Network activity
* url: http://vimfvl6s.bslah3d1ajofjeatqu1qlkiurm0iyzwd.xyz/vzcD8L.php?vzcD8L=vIMfVL6sSUPORTE
* url: http://170.254.236.10/westeros/x

### Payload delivery
* md5: <md5> — W7.zip
* md5: <md5> — W7.dll
* md5: <md5> — 1508201700016067882247230289631.vbs
* md5: <md5> — aw7.tiff
* md5: <md5> — aw7.dll
* md5: <md5> — malware-binary.exe
* md5: <md5> — westeros-x.ps
* ip-dst|port: 54.232.207.222|443 — On port 443 but (the connection is not over SSL)
* sha256: <sha256> — westeros-x.ps - Xchecked via VT: f476db89c2f6621cc36c4a7a11e1e7a3
* sha1: <sha1> — westeros-x.ps - Xchecked via VT: f476db89c2f6621cc36c4a7a11e1e7a3
* sha256: <sha256> — malware-binary.exe - Xchecked via VT: eb32c070e658937aa9fa9f3ae629b2b8
* sha1: <sha1> — malware-binary.exe - Xchecked via VT: eb32c070e658937aa9fa9f3ae629b2b8
* sha256: <sha256> — aw7.dll - Xchecked via VT: 90ce84d389eabf96b4ad2f3bb083dada
* sha1: <sha1> — aw7.dll - Xchecked via VT: 90ce84d389eabf96b4ad2f3bb083dada
* sha256: <sha256> — aw7.tiff - Xchecked via VT: bb6756c97ab58fdfeecfe8c75b4bb81e
* sha1: <sha1> — aw7.tiff - Xchecked via VT: bb6756c97ab58fdfeecfe8c75b4bb81e
* sha256: <sha256> — 1508201700016067882247230289631.vbs - Xchecked via VT: 78b86206541debb3819e51b7e9c48434
* sha1: <sha1> — 1508201700016067882247230289631.vbs - Xchecked via VT: 78b86206541debb3819e51b7e9c48434
* sha256: <sha256> — W7.zip - Xchecked via VT: f9f6bc998dcb8a3f04dffcc6b81dcfc3
* sha1: <sha1> — W7.zip - Xchecked via VT: f9f6bc998dcb8a3f04dffcc6b81dcfc3
