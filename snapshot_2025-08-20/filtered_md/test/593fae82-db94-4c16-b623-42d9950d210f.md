# Threat Report: 2017-06-13: OSINT - CRASHOVERRIDE Analyzing the Threat to Electric Grid Operations


## Key Intelligence
* Date: 2017-06-13
* Threat Level: 2 (Medium)
* Tags: admiralty-scale:information-credibility="6", tlp:white, circl:topic="industry"

---

## Indicators of Compromise (IOCs)
### Artifacts dropped
* yara: import "pe"
import "hash"

rule dragos_crashoverride_exporting_dlls
{
	meta:
		description = "CRASHOVERRIDE v1 Suspicious Export"
		author = "Dragos Inc"

	condition:
		pe.exports("Crash") & pe.characteristics
}

rule dragos_crashoverride_suspcious
{
meta:
	description = "CRASHOVERRIDE v1 Wiper"
	author = "Dragos Inc"

	strings:
		$s0 = "SYS_BASCON.COM" fullword nocase wide
		$s1 = ".pcmp" fullword nocase wide
		$s2 = ".pcmi" fullword nocase wide
		$s3 = ".pcmt" fullword nocase wide
		$s4 = ".cin" fullword nocase wide

	condition:
		pe.exports("Crash") and any of ($s*)
}


rule dragos_crashoverride_name_search {
	meta:
		description = "CRASHOVERRIDE v1 Suspicious Strings and Export"
		author = "Dragos Inc"

	strings:
		$s0 = "101.dll" fullword nocase wide
		$s1 = "Crash101.dll" fullword nocase wide
		$s2 = "104.dll" fullword nocase wide
		$s3 = "Crash104.dll" fullword nocase wide
		$s4 = "61850.dll" fullword nocase wide
		$s5 = "Crash61850.dll" fullword nocase wide
		$s6 = "OPCClientDemo.dll" fullword nocase wide
		$s7 = "OPC" fullword nocase wide
		$s8 = "CrashOPCClientDemo.dll" fullword nocase wide
		$s9 = "D2MultiCommService.exe" fullword nocase wide
		$s10 = "CrashD2MultiCommService.exe" fullword nocase wide
		$s11 = "61850.exe" fullword nocase wide
		$s12 = "OPC.exe" fullword nocase wide
		$s13 = "haslo.exe" fullword nocase wide
		$s14 = "haslo.dat" fullword nocase wide

	condition:
		any of ($s*) and pe.exports("Crash")
}

rule dragos_crashoverride_hashes {

    meta:
        description = "CRASHOVERRIDE Malware Hashes"
        author = "Dragos Inc"

    condition:
        filesize < 1MB and
        hash.sha1(0, filesize) == "f6c21f8189ced6ae150f9ef2e82a3a57843b587d" or
        hash.sha1(0, filesize) == "cccce62996d578b984984426a024d9b250237533" or
        hash.sha1(0, filesize) == "8e39eca1e48240c01ee570631ae8f0c9a9637187" or
        hash.sha1(0, filesize) == "2cb8230281b86fa944d3043ae906016c8b5984d9" or
        hash.sha1(0, filesize) == "79ca89711cdaedb16b0ccccfdcfbd6aa7e57120a" or
        hash.sha1(0, filesize) == "94488f214b165512d2fc0438a581f5c9e3bd4d4c" or
        hash.sha1(0, filesize) == "5a5fafbc3fec8d36fd57b075ebf34119ba3bff04" or
        hash.sha1(0, filesize) == "b92149f046f00bb69de329b8457d32c24726ee00" or
        hash.sha1(0, filesize) == "b335163e6eb854df5e08e85026b2c3518891eda8"
}

rule dragos_crashoverride_moduleStrings {

	meta:
		description = "IEC-104 Interaction Module Program Strings"
		author = "Dragos Inc"

	strings:
		$s1 = "IEC-104 client: ip=%s; port=%s; ASDU=%u" nocase wide ascii
		$s2 = " MSTR ->> SLV" nocase wide ascii
		$s3 = " MSTR <<- SLV" nocase wide ascii
		$s4 = "Unknown APDU format !!!" nocase wide ascii
		$s5 = "iec104.log" nocase wide ascii

	condition:
		any of ($s*)
}

rule crashoverride_configReader
{
	meta:
		description = "CRASHOVERRIDE v1 Config File Parsing"
		author = "Dragos Inc"
	
	strings:
		$s0 = { 68 e8 ?? ?? ?? 6a 00 e8 a3 ?? ?? ?? 8b f8 83 c4 ?8 }
		$s1 = { 8a 10 3a 11 75 ?? 84 d2 74 12 }
		$s2 = { 33 c0 eb ?? 1b c0 83 c8 ?? }
		$s3 = { 85 c0 75 ?? 8d 95 ?? ?? ?? ?? 8b cf ?? ?? }
		
	condition:
		all of them
}

rule crashoverride_weirdMutex
{
	meta:
		description = "Blank mutex creation assoicated with CRASHOVERRIDE"
		author = "Dragos Inc"
	strings:
		$s1 = { 81 ec 08 02 00 00 57 33 ff 57 57 57 ff 15 ?? ?? 40 00 a3 ?? ?? ?? 00 85 c0 }
		$s2 = { 8d 85 ?? ?? ?? ff 50 57 57 6a 2e 57 ff 15 ?? ?? ?? 00 68 ?? ?? 40 00}
	
	condition:
		all of them
}

rule crashoverride_serviceStomper
{
	meta:
		description = "Identify service hollowing and persistence setting"
		author = "Dragos Inc"
	
	strings:
		$s0 = { 33 c9 51 51 51 51 51 51 ?? ?? ?? }
		$s1 = { 6a ff 6a ff 6a ff 50 ff 15 24 ?? 40 00 ff ?? ?? ff 15 20 ?? 40 00 }
	
	condition:
		all of them
}

rule crashoverride_wiperModuleRegistry
{
	meta:
		description = "Registry Wiper functionality assoicated with CRASHOVERRIDE"
		author = "Dragos Inc"
	
	strings:
		$s0 = { 8d 85 a0 ?? ?? ?? 46 50 8d 85 a0 ?? ?? ?? 68 68 0d ?? ?? 50 }
		$s1 = { 6a 02 68 78 0b ?? ?? 6a 02 50 68 b4 0d ?? ?? ff b5 98 ?? ?? ?? ff 15 04 ?? ?? ?? }
		$s2 = { 68 00 02 00 00 8d 85 a0 ?? ?? ?? 50 56 ff b5 9c ?? ?? ?? ff 15 00 ?? ?? ?? 85 c0 }
	
	condition:
		all of them
}

rule crashoverride_wiperFileManipulation
{
	meta:
		description = "File manipulation actions associated with CRASHOVERRIDE wiper"
		author = "Dragos Inc"
	
	strings:
		$s0 = { 6a 00 68 80 00 00 00 6a 03 6a 00 6a 02 8b f9 68 00 00 00 40 57 ff 15 1c ?? ?? ?? 8b d8 }
		$s2 = { 6a 00 50 57 56 53 ff 15 4c ?? ?? ?? 56 }
		
	condition:
		all of them
}

### External analysis
* link: https://www.virustotal.com/file/893e4cca7fe58191d2f6722b383b5e8009d3885b5913dcd2e3577e5a763cdb3f/analysis/1497333819/ — Custom-built port scanner. ,Stage 2: Develop,Recon - Xchecked via VT: b335163e6eb854df5e08e85026b2c3518891eda8
* link: https://www.virustotal.com/file/ad23c7930dae02de1ea3c6836091b5fb3c62a89bf2bcfb83b4b39ede15904910/analysis/1487157094/ — "Wiper module, wipes list of files by extension, removes system processes, and makes registry changes to prevent system boot. ",Stage 2: Attack,Destruction - Xchecked via VT: b92149f046f00bb69de329b8457d32c24726ee00
* link: https://www.virustotal.com/file/018eb62e174efdcdb3af011d34b0bf2284ed1a803718fba6edffe5bc0b446b81/analysis/1497287042/ — "Wiper module, wipes list of files by extension, removes system processes, and makes registry changes to prevent system boot. ",Stage 2: Attack,Destruction - Xchecked via VT: 5a5fafbc3fec8d36fd57b075ebf34119ba3bff04
* link: https://www.virustotal.com/file/7907dd95c1d36cf3dc842a1bd804f0db511a0f68f4b3d382c23a3c974a383cad/analysis/1497333815/ — Module for 104 effect. Exports 'Crash' which is invoked by launcher. Functionality requires config file. ,Stage 2: Attack,Loss of Control - Xchecked via VT: 94488f214b165512d2fc0438a581f5c9e3bd4d4c
* link: https://www.virustotal.com/file/21c1fdd6cfd8ec3ffe3e922f944424b543643dbdab99fa731556f8805b0d5561/analysis/1497333825/ — "Launcher for payload DLL. Takes input as three command line parameters – working directory, module, and config file.",Stage 2: Attack,Loss of Control - Xchecked via VT: 79ca89711cdaedb16b0ccccfdcfbd6aa7e57120a
* link: https://www.virustotal.com/file/ecaf150e087ddff0ec6463c92f7f6cca23cc4fd30fe34c10b3cb7c2a6d135c77/analysis/1497333833/ — Backdoor/RAT Proxy + HTTP CONNECT to 195.16.88.6:443 ,Phase2: C2,Remote Access - Xchecked via VT: 2cb8230281b86fa944d3043ae906016c8b5984d9
* link: https://www.virustotal.com/file/3e3ab9674142dec46ce389e9e759b6484e847f5c1e1fc682fc638fc837c13571/analysis/1497333806/ — Backdoor/RAT Proxy + HTTP CONNECT to 93.115.27.57:443. ,Phase2: C2,Remote Access - Xchecked via VT: 8e39eca1e48240c01ee570631ae8f0c9a9637187
* link: https://www.virustotal.com/file/6d707e647427f1ff4a7a9420188a8831f433ad8c5325dc8b8cc6fc5e7f1f6f47/analysis/1497333810/ — "Traffic to 10.15.1.69:3128, HTTP CONNECT to 5.39.218.152:443. Backdoor/RAT.",Phase2: C2,Remote Access - Xchecked via VT: cccce62996d578b984984426a024d9b250237533
* link: https://www.virustotal.com/file/37d54e3d5e8b838f366b9c202f75fa264611a12444e62ae759c31a0d041aa6e4/analysis/1497333801/ — "Traffic to 10.15.1.69:3128, HTTP CONNECT to 5.39.218.152:443. Backdoor/RAT. ",Phase2: C2,Remote Access - Xchecked via VT: f6c21f8189ced6ae150f9ef2e82a3a57843b587d
* link: https://raw.githubusercontent.com/dragosinc/CRASHOVERRIDE/master/CRASHOVERRIDE%20IOC%202016-06-12.csv
* text: Executive Summary
Dragos, Inc. was notified by the Slovakian anti-virus firm ESET of an ICS tailored
malware on June 8th, 2017. The Dragos team was able to use this notification to find
samples of the malware, identify new functionality and impact scenarios, and confirm
that this was the malware employed in the December 17th, 2016 cyber-attack
on the Kiev, Ukraine transmission substation which resulted in electric grid operations
impact. This report serves as an industry report to inform the electric sector
and security community of the potential implications of this malware and the appropriate details to have a nuanced discussion.
* link: https://dragos.com/blog/crashoverride/CrashOverride-01.pdf

### Network activity
* user-agent: Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; InfoPath.1)
* ip-dst: 5.39.218.152 — External C2 server [DEC 2016] (likely TOR node at time of attack),Stage 2: C2,Remote Access
* ip-dst: 93.115.27.57 — External C2 server [DEC 2016] (likely TOR node at time of attack),Stage 2: C2,Remote Access
* ip-dst: 195.16.88.6 — External C2 server [DEC 2016] (likely TOR node at time of attack),Stage 2: C2,Remote Access

### Payload delivery
* md5: <md5> — Custom-built port scanner. ,Stage 2: Develop,Recon - Xchecked via VT: b335163e6eb854df5e08e85026b2c3518891eda8
* sha256: <sha256> — Custom-built port scanner. ,Stage 2: Develop,Recon - Xchecked via VT: b335163e6eb854df5e08e85026b2c3518891eda8
* md5: <md5> — "Wiper module, wipes list of files by extension, removes system processes, and makes registry changes to prevent system boot. ",Stage 2: Attack,Destruction - Xchecked via VT: b92149f046f00bb69de329b8457d32c24726ee00
* sha256: <sha256> — "Wiper module, wipes list of files by extension, removes system processes, and makes registry changes to prevent system boot. ",Stage 2: Attack,Destruction - Xchecked via VT: b92149f046f00bb69de329b8457d32c24726ee00
* md5: <md5> — "Wiper module, wipes list of files by extension, removes system processes, and makes registry changes to prevent system boot. ",Stage 2: Attack,Destruction - Xchecked via VT: 5a5fafbc3fec8d36fd57b075ebf34119ba3bff04
* sha256: <sha256> — "Wiper module, wipes list of files by extension, removes system processes, and makes registry changes to prevent system boot. ",Stage 2: Attack,Destruction - Xchecked via VT: 5a5fafbc3fec8d36fd57b075ebf34119ba3bff04
* md5: <md5> — Module for 104 effect. Exports 'Crash' which is invoked by launcher. Functionality requires config file. ,Stage 2: Attack,Loss of Control - Xchecked via VT: 94488f214b165512d2fc0438a581f5c9e3bd4d4c
* sha256: <sha256> — Module for 104 effect. Exports 'Crash' which is invoked by launcher. Functionality requires config file. ,Stage 2: Attack,Loss of Control - Xchecked via VT: 94488f214b165512d2fc0438a581f5c9e3bd4d4c
* md5: <md5> — "Launcher for payload DLL. Takes input as three command line parameters – working directory, module, and config file.",Stage 2: Attack,Loss of Control - Xchecked via VT: 79ca89711cdaedb16b0ccccfdcfbd6aa7e57120a
* sha256: <sha256> — "Launcher for payload DLL. Takes input as three command line parameters – working directory, module, and config file.",Stage 2: Attack,Loss of Control - Xchecked via VT: 79ca89711cdaedb16b0ccccfdcfbd6aa7e57120a
* md5: <md5> — Backdoor/RAT Proxy + HTTP CONNECT to 195.16.88.6:443 ,Phase2: C2,Remote Access - Xchecked via VT: 2cb8230281b86fa944d3043ae906016c8b5984d9
* sha256: <sha256> — Backdoor/RAT Proxy + HTTP CONNECT to 195.16.88.6:443 ,Phase2: C2,Remote Access - Xchecked via VT: 2cb8230281b86fa944d3043ae906016c8b5984d9
* md5: <md5> — Backdoor/RAT Proxy + HTTP CONNECT to 93.115.27.57:443. ,Phase2: C2,Remote Access - Xchecked via VT: 8e39eca1e48240c01ee570631ae8f0c9a9637187
* sha256: <sha256> — Backdoor/RAT Proxy + HTTP CONNECT to 93.115.27.57:443. ,Phase2: C2,Remote Access - Xchecked via VT: 8e39eca1e48240c01ee570631ae8f0c9a9637187
* md5: <md5> — "Traffic to 10.15.1.69:3128, HTTP CONNECT to 5.39.218.152:443. Backdoor/RAT.",Phase2: C2,Remote Access - Xchecked via VT: cccce62996d578b984984426a024d9b250237533
* sha256: <sha256> — "Traffic to 10.15.1.69:3128, HTTP CONNECT to 5.39.218.152:443. Backdoor/RAT.",Phase2: C2,Remote Access - Xchecked via VT: cccce62996d578b984984426a024d9b250237533
* md5: <md5> — "Traffic to 10.15.1.69:3128, HTTP CONNECT to 5.39.218.152:443. Backdoor/RAT. ",Phase2: C2,Remote Access - Xchecked via VT: f6c21f8189ced6ae150f9ef2e82a3a57843b587d
* sha256: <sha256> — "Traffic to 10.15.1.69:3128, HTTP CONNECT to 5.39.218.152:443. Backdoor/RAT. ",Phase2: C2,Remote Access - Xchecked via VT: f6c21f8189ced6ae150f9ef2e82a3a57843b587d
* sha1: <sha1> — IEC-61850 enumeration and address manipulation,Stage 2: Attack,Loss of Control
* sha1: <sha1> — OPC Data Access protocol enumeration of servers and addresses ,Stage 2: Attack,Loss of Control
* sha1: <sha1> — Custom-built port scanner. ,Stage 2: Develop,Recon
* sha1: <sha1> — "Wiper module, wipes list of files by extension, removes system processes, and makes registry changes to prevent system boot. ",Stage 2: Attack,Destruction
* sha1: <sha1> — "Wiper module, wipes list of files by extension, removes system processes, and makes registry changes to prevent system boot. ",Stage 2: Attack,Destruction
* sha1: <sha1> — Module for 104 effect. Exports 'Crash' which is invoked by launcher. Functionality requires config file. ,Stage 2: Attack,Loss of Control
* sha1: <sha1> — "Launcher for payload DLL. Takes input as three command line parameters – working directory, module, and config file.",Stage 2: Attack,Loss of Control
* ip-dst|port: 195.16.88.6|443 — On port 443
* sha1: <sha1> — Backdoor/RAT Proxy + HTTP CONNECT to 195.16.88.6:443 ,Phase2: C2,Remote Access
* ip-dst|port: 93.115.27.57|443 — On port 443
* sha1: <sha1> — Backdoor/RAT Proxy + HTTP CONNECT to 93.115.27.57:443. ,Phase2: C2,Remote Access
* sha1: <sha1> — "Traffic to 10.15.1.69:3128, HTTP CONNECT to 5.39.218.152:443. Backdoor/RAT.",Phase2: C2,Remote Access
* ip-dst|port: 5.39.218.152|443 — On port 443
* ip-dst|port: 10.15.1.69|3128 — On port 3128
* sha1: <sha1> — "Traffic to 10.15.1.69:3128, HTTP CONNECT to 5.39.218.152:443. Backdoor/RAT. ",Phase2: C2,Remote Access

### Persistence mechanism
* regkey: HKLM\SYSTEM\CurrentControlSet\Services\<target_service_name>\ImagePath — Change in Service Image Path in the system registry to point to malware allowing malware to restart on system reboot.,Stage 2: Installation,Persistence
* regkey: User>\imapi
