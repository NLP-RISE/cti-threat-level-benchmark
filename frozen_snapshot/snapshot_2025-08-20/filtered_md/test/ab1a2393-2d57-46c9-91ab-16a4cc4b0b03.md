# Threat Report: 2024-01-11: Active Exploitation of Two Zero-Day Vulnerabilities in Ivanti Connect Secure VPN


## Key Intelligence
* Date: 2024-01-11
* Threat Level: 1 (High)
* Tags: misp-galaxy:mitre-attack-pattern="Exploit Public-Facing Application - T1190", type:OSINT, osint:lifetime="perpetual", tlp:white, tlp:clear

---

## Indicators of Compromise (IOCs)
### Network activity
* ip-dst: 206.189.208.156 — DigitalOcean IP address tied to UTA0178
* domain: gpoaccess.com — Suspected UTA0178 domain discovered via domain registration patterns
* domain: webb-institute.com — Suspected UTA0178 domain discovered via domain registration patterns
* domain: symantke.com — UTA0178 domain used to collect credentials from compromised devices
* ip-dst: 75.145.243.85 — UTA0178 IP address observed interacting with compromised device
* ip-dst: 47.207.9.89 — UTA0178 IP address observed interacting with compromised device tied to Cyberoam proxy network
* ip-dst: 98.160.48.170 — UTA0178 IP address observed interacting with compromised device tied to Cyberoam proxy network
* ip-dst: 173.220.106.166 — UTA0178 IP address observed interacting with compromised device tied to Cyberoam proxy network
* ip-dst: 73.128.178.221 — UTA0178 IP address observed interacting with compromised device tied to Cyberoam proxy network
* ip-dst: 50.243.177.161 — UTA0178 IP address observed interacting with compromised device tied to Cyberoam proxy network
* ip-dst: 50.213.208.89 — UTA0178 IP address observed interacting with compromised device tied to Cyberoam proxy network
* ip-dst: 64.24.179.210 — UTA0178 IP address observed interacting with compromised device tied to Cyberoam proxy network
* ip-dst: 75.145.224.109 — UTA0178 IP address observed interacting with compromised device tied to Cyberoam proxy network
* ip-dst: 50.215.39.49 — UTA0178 IP address observed interacting with compromised device tied to Cyberoam proxy network
* ip-dst: 71.127.149.194 — UTA0178 IP address observed interacting with compromised device tied to Cyberoam proxy network
* ip-dst: 173.53.43.7 — UTA0178 IP address observed interacting with compromised device tied to Cyberoam proxy network

## Objects
### file — File object describing a file with meta-information
* [Payload delivery] malware-sample: glasstoken_v2.aspx|701fdc38b2dc9a605fe3f0877baca62e
* [Payload delivery] filename: glasstoken_v2.aspx
* [Payload delivery] md5: <md5>
* [Payload delivery] sha1: <sha1>
* [Payload delivery] sha256: <sha256>
* [Other] size-in-bytes: 818

### file — File object describing a file with meta-information
* [Payload delivery] malware-sample: glasstoken_v1.aspx|da0e21202e53d590e4258a893456ab44
* [Payload delivery] filename: glasstoken_v1.aspx
* [Payload delivery] md5: <md5>
* [Payload delivery] sha1: <sha1>
* [Payload delivery] sha256: <sha256>
* [Other] size-in-bytes: 2265

### yara — An object describing a YARA rule (or a YARA rule name) along with its version.
* [Other] text: all
* [Payload installation] yara: rule hacktool_py_pysoxy
{
    meta:
        author = "threatintel@volexity.com"
        date = "2024-01-09"
        description = "SOCKS5 proxy tool used to relay connections."
        hash1 = "e192932d834292478c9b1032543c53edfc2b252fdf7e27e4c438f4b249544eeb"
        os = "all"
        os_arch = "all"
        reference = "https://github.com/MisterDaneel/pysoxy/blob/master/pysoxy.py"
        report = "TIB-20240109"
        scan_context = "file,memory"
        last_modified = "2024-01-09T13:45Z"
        license = "See license at https://github.com/volexity/threat-intel/blob/main/LICENSE.txt"
        rule_id = 10065
        version = 3

    strings:
        $s1 = "proxy_loop" ascii
        $s2 = "connect_to_dst" ascii
        $s3 = "request_client" ascii
        $s4 = "subnegotiation_client" ascii
        $s5 = "bind_port" ascii

    condition:
        all of them
}
* [Other] text: hacktool_py_pysoxy

### yara — An object describing a YARA rule (or a YARA rule name) along with its version.
* [Other] text: all
* [Payload installation] yara: rule webshell_aspx_regeorg
{
    meta:
        author = "threatintel@volexity.com"
        date = "2018-08-29"
        description = "Detects the reGeorg webshell based on common strings in the webshell. May also detect other webshells which borrow code from ReGeorg."
        hash = "9d901f1a494ffa98d967ee6ee30a46402c12a807ce425d5f51252eb69941d988"
        os = "win"
        os_arch = "all"
        reference = "https://github.com/L-codes/Neo-reGeorg/blob/master/templates/tunnel.aspx"
        report = "TIB-20231215"
        scan_context = "file,memory"
        last_modified = "2024-01-09T10:04Z"
        license = "See license at https://github.com/volexity/threat-intel/blob/main/LICENSE.txt"
        rule_id = 410
        version = 7

    strings:
        $a1 = "every office needs a tool like Georg" ascii
        $a2 = "cmd = Request.QueryString.Get(\"cmd\")" ascii
        $a3 = "exKak.Message" ascii

        $proxy1 = "if (rkey != \"Content-Length\" && rkey != \"Transfer-Encoding\")"

        $proxy_b1 = "StreamReader repBody = new StreamReader(response.GetResponseStream(), Encoding.GetEncoding(\"UTF-8\"));" ascii
        $proxy_b2 = "string rbody = repBody.ReadToEnd();" ascii
        $proxy_b3 = "Response.AddHeader(\"Content-Length\", rbody.Length.ToString());" ascii

    condition:
        any of ($a*) or
        $proxy1 or
        all of ($proxy_b*)
}
* [Other] text: webshell_aspx_regeorg

### yara — An object describing a YARA rule (or a YARA rule name) along with its version.
* [Other] text: all
* [Payload installation] yara: rule apt_webshell_aspx_glasstoken: UTA0178
{
    meta:
        author = "threatintel@volexity.com"
        date = "2023-12-12"
        description = "Detection for a custom webshell seen on external facing server. The webshell contains two functions, the first is to act as a Tunnel, using code borrowed from reGeorg, the second is custom code to execute arbitrary .NET code."
        hash1 = "26cbb54b1feb75fe008e36285334d747428f80aacdb57badf294e597f3e9430d"
        os = "win"
        os_arch = "all"
        report = "TIB-20231215"
        scan_context = "file,memory"
        last_modified = "2024-01-09T10:08Z"
        license = "See license at https://github.com/volexity/threat-intel/blob/main/LICENSE.txt"
        rule_id = 9994
        version = 5

    strings:
        $s1 = "=Convert.FromBase64String(System.Text.Encoding.Default.GetString(" ascii
        $re = /Assembly\.Load\(errors\)\.CreateInstance\("[a-z0-9A-Z]{4,12}"\).GetHashCode\(\);/

    condition:
        for any i in (0..#s1):
            (
                $re in (@s1[i]..@s1[i]+512)
            )
}
* [Other] text: apt_webshell_aspx_glasstoken

### yara — An object describing a YARA rule (or a YARA rule name) along with its version.
* [Other] text: all
* [Payload installation] yara: rule apt_webshell_pl_complyshell: UTA0178
{
    meta:
        author = "threatintel@volexity.com"
        date = "2023-12-13"
        description = "Detection for the COMPLYSHELL webshell."
        hash1 = "8bc8f4da98ee05c9d403d2cb76097818de0b524d90bea8ed846615e42cb031d2"
        os = "linux"
        os_arch = "all"
        report = "TIB-20231215"
        scan_context = "file,memory"
        last_modified = "2024-01-09T10:05Z"
        license = "See license at https://github.com/volexity/threat-intel/blob/main/LICENSE.txt"
        rule_id = 9995
        version = 4

    strings:
        $s = "eval{my $c=Crypt::RC4->new("

    condition:
        $s
}
* [Other] text: apt_webshell_pl_complyshell

### report — Report object to describe a report along with its metadata.
* [External analysis] link: https://www.volexity.com/blog/2024/01/10/active-exploitation-of-two-zero-day-vulnerabilities-in-ivanti-connect-secure-vpn/
* [Other] text: Volexity has uncovered active in-the-wild exploitation of two vulnerabilities allowing unauthenticated remote code execution in Ivanti Connect Secure VPN devices. An official security advisory and knowledge base article have been released by Ivanti that includes mitigation that should be applied immediately. However, a mitigation does not remedy a past or ongoing compromise. Systems should simultaneously be thoroughly analyzed per details in this post to look for signs of a breach.

During the second week of December 2023, Volexity detected suspicious lateral movement on the network of one of its Network Security Monitoring service customers. Upon closer inspection, Volexity found that an attacker was placing webshells on multiple internal and external-facing web servers. These detections kicked off an incident response investigation across multiple systems that Volexity ultimately tracked back to the organization's Internet-facing Ivanti Connect Secure (ICS) VPN appliance (formerly known as Pulse Connect Secure, or simply Pulse Secure). A closer inspection of the ICS VPN appliance showed that its logs had been wiped and logging had been disabled. Further review of historic network traffic from the device also revealed suspect outbound and inbound communication from its management IP address. Volexity found that there was suspect activity originating from the device as early as December 3, 2023.

At this point in its incident response investigation, Volexity suspected a zero-day exploit was likely at play but did not yet have enough evidence to support this theory. Volexity and its customer worked closely with Ivanti in order to obtain disk and memory images from the impacted devices. Forensic analysis of the collected data provided insight into a variety of the attacker's tools, malware, and methods for operating.
* [Other] text: Active Exploitation of Two Zero-Day Vulnerabilities in Ivanti Connect Secure VPN
* [Other] text: Blog
