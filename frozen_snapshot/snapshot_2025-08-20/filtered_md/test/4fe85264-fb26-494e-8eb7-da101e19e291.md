# Threat Report: 2024-10-24: Investigating FortiManager Zero-Day Exploitation (CVE-2024-47575)


## Key Intelligence
* Date: 2024-10-24
* Threat Level: 3 (Low)
* Tags: misp-galaxy:mitre-attack-pattern="Exploit Public-Facing Application - T1190", type:OSINT, osint:lifetime="perpetual", osint:certainty="50", tlp:white, tlp:clear

---

## Indicators of Compromise (IOCs)
### Artifacts dropped
* text: FMG-VMTM23017412 — Malicious Fortinet Device ID
* text: msg="Unregistered device localhost add succeeded" — String indicating exploitation in /log/locallog/elog
* text: changes="Edited device settings (SN FMG-VMTM23017412)" — String indicating exploitation in /log/locallog/elog
* text: changes="Added unregistered device to unregistered table." — String indicating exploitation in /log/locallog/elog
* text: Purity Supreme — Observed in subs.dat and subs.dat.tmp

### External analysis
* vulnerability: CVE-2024-47575

### Network activity
* ip-dst: 45.32.41.202 — UNC5820
* ip-dst: 104.238.141.143 — UNC5820
* ip-dst: 158.247.199.37 — UNC5820
* ip-dst: 195.85.114.78 — UNC5820
* ip-dst: 45.32.63.2 — via https://www.fortiguard.com/psirt/FG-IR-24-423

### Payload delivery
* md5: <md5> — MD5 hash of unreg_devices.txt

## Objects
### report — Report object to describe a report along with its metadata.
* [External analysis] link: https://cloud.google.com/blog/topics/threat-intelligence/fortimanager-zero-day-exploitation-cve-2024-47575
* [Other] text: In October 2024, Mandiant collaborated with Fortinet to investigate the mass exploitation of FortiManager appliances across 50+ potentially compromised FortiManager devices in various industries. The vulnerability, CVE-2024-47575 / FG-IR-24-423, allows a threat actor to use an unauthorized, threat actor-controlled FortiManager device to execute arbitrary code or commands against vulnerable FortiManager devices. 

Mandiant observed a new threat cluster we now track as UNC5820 exploiting the FortiManager vulnerability as early as June 27, 2024. UNC5820 staged and exfiltrated the configuration data of the FortiGate devices managed by the exploited FortiManager. This data contains detailed configuration information of the managed appliances as well as the users and their FortiOS256-hashed passwords. This data could be used by UNC5820 to further compromise the FortiManager, move laterally to the managed Fortinet devices, and ultimately target the enterprise environment.

At this time, the data sources analyzed by Mandiant did not record the specific requests that the threat actor used to leverage the FortiManager vulnerability. Additionally, at this stage of our investigations there is no evidence that UNC5820 leveraged the obtained configuration data to move laterally and further compromise the environment. As a result, at the time of publishing, we lack sufficient data to assess actor motivation or location. As additional information becomes available through our investigations, Mandiant will update this blog’s attribution assessment.

Organizations that may have their FortiManager exposed to the internet should conduct a forensic investigation immediately.
* [Other] text: Investigating FortiManager Zero-Day Exploitation (CVE-2024-47575)
* [Other] text: Blog

### vulnerability — Vulnerability object describing a common vulnerability enumeration which can describe published, unpublished, under review or embargo vulnerability for software, equipments or hardware.
* [External analysis] vulnerability: CVE-2024-47575
* [Other] text: A missing authentication for critical function in FortiManager 7.6.0, FortiManager 7.4.0 through 7.4.4, FortiManager 7.2.0 through 7.2.7, FortiManager 7.0.0 through 7.0.12, FortiManager 6.4.0 through 6.4.14, FortiManager 6.2.0 through 6.2.12, Fortinet FortiManager Cloud 7.4.1 through 7.4.4, FortiManager Cloud 7.2.1 through 7.2.7, FortiManager Cloud 7.0.1 through 7.0.13, FortiManager Cloud 6.4.1 through 6.4.7 allows attacker to execute arbitrary code or commands via specially crafted requests.
* [Other] datetime: 2024-10-24T01:00:00+00:00
* [Other] datetime: 2024-10-23T15:15:00+00:00
* [Other] text: Published
* [External analysis] link: https://fortiguard.fortinet.com/psirt/FG-IR-24-423

### weakness — Weakness object describing a common weakness enumeration which can describe usable, incomplete, draft or deprecated weakness for software, equipment of hardware.
* [External analysis] weakness: CWE-306
* [Other] text: Missing Authentication for Critical Function
* [Other] text: Draft
* [Other] text: Base

### attack-pattern — Attack pattern describing a common attack pattern enumeration and classification.
* [Other] text: 62
* [Other] text: Cross Site Request Forgery
* [Other] text: An attacker crafts malicious web links and distributes them (via web pages, email, etc.), typically in a targeted manner, hoping to induce users to click on the link and execute the malicious action against some third-party application. If successful, the action embedded in the malicious link will be processed and accepted by the targeted application with the users' privilege level. This type of attack leverages the persistence and implicit trust placed in user session cookies by many web applications today. In such an architecture, once the user authenticates to an application and a session cookie is created on the user's system, all following transactions for that session are authenticated using that cookie including potential actions initiated by an attacker and simply "riding" the existing session cookie.
* [Other] text: Use cryptographic tokens to associate a request with a specific action. The token can be regenerated at every request so that if a request with an invalid token is encountered, it can be reliably discarded. The token is considered invalid if it arrived with a request other than the action it was supposed to be associated with. Although less reliable, the use of the optional HTTP Referrer header can also be used to determine whether an incoming request was actually one that the user is authorized for, in the current context. Additionally, the user can also be prompted to confirm an action every time an action concerning potentially sensitive data is invoked. This way, even if the attacker manages to get the user to click on a malicious link and request the desired action, the user has a chance to recover by denying confirmation. This solution is also implicitly tied to using a second factor of authentication before performing such actions. In general, every request must be checked for the appropriate authentication token as well as authorization in the current session context.
* [External analysis] weakness: CWE-1275
* [External analysis] weakness: CWE-306
* [External analysis] weakness: CWE-352
* [External analysis] weakness: CWE-664
* [External analysis] weakness: CWE-716
* [External analysis] weakness: CWE-732

### attack-pattern — Attack pattern describing a common attack pattern enumeration and classification.
* [Other] text: 36
* [Other] text: Using Unpublished Interfaces
* [Other] text: An adversary searches for and invokes interfaces that the target system designers did not intend to be publicly available. If these interfaces fail to authenticate requests the attacker may be able to invoke functionality they are not authorized for.
* [Other] text: The architecture under attack must publish or otherwise make available services that clients can attach to, either in an unauthenticated fashion, or having obtained an authentication token elsewhere. The service need not be 'discoverable', but in the event it isn't it must have some way of being discovered by an attacker. This might include listening on a well-known port. Ultimately, the likelihood of exploit depends on discoverability of the vulnerable service.
* [Other] text: Authenticating both services and their discovery, and protecting that authentication mechanism simply fixes the bulk of this problem. Protecting the authentication involves the standard means, including: 1) protecting the channel over which authentication occurs, 2) preventing the theft, forgery, or prediction of authentication credentials or the resultant tokens, or 3) subversion of password reset and the like.
* [External analysis] weakness: CWE-1242
* [External analysis] weakness: CWE-306
* [External analysis] weakness: CWE-693
* [External analysis] weakness: CWE-695

### attack-pattern — Attack pattern describing a common attack pattern enumeration and classification.
* [Other] text: 166
* [Other] text: Force the System to Reset Values
* [Other] text: An attacker forces the target into a previous state in order to leverage potential weaknesses in the target dependent upon a prior configuration or state-dependent factors. Even in cases where an attacker may not be able to directly control the configuration of the targeted application, they may be able to reset the configuration to a prior state since many applications implement reset functions. Since these functions are usually intended as emergency features to return an application to a stable configuration if the current configuration degrades functionality, they may not be as strongly secured as other configuration options. The resetting of values is dangerous as it may enable undesired functionality, disable services, or modify access controls. At the very least this is a nuisance attack since the administrator will need to re-apply their configuration. At worst, this attack can open avenues for powerful attacks against the application, and, if it isn't obvious that the configuration has been reset, these vulnerabilities may be present a long time before they are notices.
* [Other] text: The targeted application must have a reset function that returns the configuration of the application to an earlier state. The reset functionality must be inadequately protected against use.
* [External analysis] weakness: CWE-1232
* [External analysis] weakness: CWE-306

### attack-pattern — Attack pattern describing a common attack pattern enumeration and classification.
* [Other] text: 12
* [Other] text: Choosing Message Identifier
* [Other] text: This pattern of attack is defined by the selection of messages distributed over via multicast or public information channels that are intended for another client by determining the parameter value assigned to that client. This attack allows the adversary to gain access to potentially privileged information, and to possibly perpetrate other attacks through the distribution means by impersonation. If the channel/message being manipulated is an input rather than output mechanism for the system, (such as a command bus), this style of attack could be used to change the adversary's identifier to more a privileged one.
* [Other] text: Information and client-sensitive (and client-specific) data must be present through a distribution channel available to all users. Distribution means must code (through channel, message identifiers, or convention) message destination in a manner visible within the distribution means itself (such as a control channel) or in the messages themselves.
* [Other] text: The purpose is to architect the system in a way that associates proper authentication/authorization with each channel/message. Re-architect system input/output channels as appropriate to distribute self-protecting data. That is, encrypt (or otherwise protect) channels/messages so that only authorized readers can see them.
* [External analysis] weakness: CWE-201
* [External analysis] weakness: CWE-306

### email — Email object describing an email with meta-information
* [Payload delivery] email-src: 0qsc137p@justdefinition.com
