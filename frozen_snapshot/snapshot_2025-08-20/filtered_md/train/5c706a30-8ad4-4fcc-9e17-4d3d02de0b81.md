# Threat Report: 2019-02-22: OSINT - New BabyShark Malware Targets U.S. National Security Think Tanks


## Key Intelligence
* Date: 2019-02-22
* Threat Level: 3 (Low)
* Tags: type:OSINT, osint:lifetime="perpetual", tlp:white, misp-galaxy:mitre-attack-pattern="Stolen Developer Credentials or Signing Keys - T1441", misp-galaxy:tool="BabyShark", misp-galaxy:threat-actor="STOLEN PENCIL"

---

## Indicators of Compromise (IOCs)
### Artifacts dropped
* yara: import "pe"

rule MAL_PE_Type_BabyShark_Loader {
   meta:
      description = "Detects PE Type babyShark loader mentioned in February 2019 blog post by PaloAltNetworks"
      author = "Florian Roth"
      reference = "https://unit42.paloaltonetworks.com/new-babyshark-malware-targets-u-s-national-security-think-tanks/"
      date = "2019-02-24"
      hash1 = "6f76a8e16908ba2d576cf0e8cdb70114dcb70e0f7223be10aab3a728dc65c41c"
   strings:
      $x1 = "reg add \"HKEY_CURRENT_USER\\Software\\Microsoft\\Command Processor\" /v AutoRun /t REG_SZ /d \"%s\" /f" fullword ascii
      $x2 = /mshta\.exe http:\/\/[a-z0-9\.\/]{5,30}\.hta/

      $xc1 = { 57 69 6E 45 78 65 63 00 6B 65 72 6E 65 6C 33 32
               2E 44 4C 4C 00 00 00 00 } /* WinExec kernel32.DLL */
   condition:
      uint16(0) == 0x5a4d and (
         pe.imphash() == "57b6d88707d9cd1c87169076c24f962e" or
         1 of them or
         for any i in (0 .. pe.number_of_signatures) : (
            pe.signatures[i].issuer contains "thawte SHA256 Code Signing CA" and
            pe.signatures[i].serial == "0f:ff:e4:32:a5:3f:f0:3b:92:23:f8:8b:e1:b8:3d:9d"
         )
      )
}

### External analysis
* link: https://unit42.paloaltonetworks.com/new-babyshark-malware-targets-u-s-national-security-think-tanks/
* comment: In February 2019, Palo Alto Networks Unit 42 researchers identified spear phishing emails sent in November 2018 containing new malware that shares infrastructure with playbooks associated with North Korean campaigns. The spear phishing emails were written to appear as though they were sent from a nuclear security expert who currently works as a consultant for in the U.S. The emails were sent using a public email address with the expertâ€™s name and had a subject referencing North Koreaâ€™s nuclear issues. The emails had a malicious Excel macro document attached, which when executed led to a new Microsoft Visual Basic (VB) script-based malware family which we are dubbing â€œBabySharkâ€.

BabyShark is a relatively new malware. The earliest sample we found from open source repositories and our internal data sets was seen in November 2018. The malware is launched by executing the first stage HTA from a remote location, thus it can be delivered via different file types including PE files as well as malicious documents. It exfiltrates system information to C2 server, maintains persistence on the system, and waits for further instruction from the operator. Figure 1, below, shows the flow of execution.

### Network activity
* url: https://tdalpacafarm.com/files/kr/contents/Vkggy0.hta

### Payload delivery
* sha256: <sha256> — Malicious Documents
* sha256: <sha256> — Malicious Documents
* sha256: <sha256> — Malicious Documents
* sha256: <sha256> — Malicious Documents
* sha256: <sha256> — Malicious Documents
* sha256: <sha256> — Malicious Documents
* sha256: <sha256> — Malicious Documents
* sha256: <sha256> — Malicious Documents
* sha256: <sha256> — Malicious Documents
* sha256: <sha256> — PE version loader, signed with stolen certificate:
* filename: Kendall-AFA 2014 Conference-17Sept14.pdf — Decoy Filename
* filename: U.S. Nuclear Deterrence.pdf — Decoy Filename
* filename: ì œ30ì°¨í•œë¯¸ì•ˆë³´ ì•ˆë‚´ìž¥ ENKO.fdp.etadpU.scr (translates to 30th Korea-U.S. National Security Invitation Update) — Decoy Filename
* filename: Conference Information_2010 IFANS Conference on Global Affairs (1001).pdf — Decoy Filename
* attachment: Figure-1-BabyShark-execution-flow.png — BabyShark is a relatively new malware. The earliest sample we found from open source repositories and our internal data sets was seen in November 2018. The malware is launched by executing the first stage HTA from a remote location, thus it can be delivered via different file types including PE files as well as malicious documents. It exfiltrates system information to C2 server, maintains persistence on the system, and waits for further instruction from the operator. Figure 1, below, shows the flow of execution.

## Objects
### file — File object describing a file with meta-information
* [Payload delivery] md5: <md5> — Malicious Documents
* [Payload delivery] sha1: <sha1> — Malicious Documents
* [Payload delivery] sha256: <sha256> — Malicious Documents

### virustotal-report — VirusTotal report
* [Other] datetime: 2019-02-22T20:12:18 — Malicious Documents
* [Payload delivery] link: https://www.virustotal.com/file/94a09aff59c0c27d1049509032d5ba05e9285fd522eb20b033b8188e0fee4ff0/analysis/1550866338/ — Malicious Documents
* [Payload delivery] text: 25/60 — Malicious Documents

### file — File object describing a file with meta-information
* [Payload delivery] md5: <md5> — Malicious Documents
* [Payload delivery] sha1: <sha1> — Malicious Documents
* [Payload delivery] sha256: <sha256> — Malicious Documents

### virustotal-report — VirusTotal report
* [Other] datetime: 2019-02-22T20:07:15 — Malicious Documents
* [Payload delivery] link: https://www.virustotal.com/file/66439f0e377bbe8cda3e516e801a86c64688e7c3dde0287b1bfb298a5bdbc2a2/analysis/1550866035/ — Malicious Documents
* [Payload delivery] text: 20/60 — Malicious Documents

### file — File object describing a file with meta-information
* [Payload delivery] md5: <md5> — Malicious Documents
* [Payload delivery] sha1: <sha1> — Malicious Documents
* [Payload delivery] sha256: <sha256> — Malicious Documents

### virustotal-report — VirusTotal report
* [Other] datetime: 2019-02-22T20:03:13 — Malicious Documents
* [Payload delivery] link: https://www.virustotal.com/file/7b77112ac7cbb7193bcd891ce48ab2acff35e4f8d523980dff834cb42eaffafa/analysis/1550865793/ — Malicious Documents
* [Payload delivery] text: 22/60 — Malicious Documents

### file — File object describing a file with meta-information
* [Payload delivery] md5: <md5> — Malicious Documents
* [Payload delivery] sha1: <sha1> — Malicious Documents
* [Payload delivery] sha256: <sha256> — Malicious Documents

### virustotal-report — VirusTotal report
* [Other] datetime: 2018-11-27T12:07:50 — Malicious Documents
* [Payload delivery] link: https://www.virustotal.com/file/1334c087390fb946c894c1863dfc9f0a659f594a3d6307fb48f24c30a23e0fc0/analysis/1543320470/ — Malicious Documents
* [Payload delivery] text: 22/60 — Malicious Documents

### file — File object describing a file with meta-information
* [Payload delivery] md5: <md5> — Malicious Documents
* [Payload delivery] sha1: <sha1> — Malicious Documents
* [Payload delivery] sha256: <sha256> — Malicious Documents

### virustotal-report — VirusTotal report
* [Other] datetime: 2019-02-22T20:11:49 — Malicious Documents
* [Payload delivery] link: https://www.virustotal.com/file/dc425e93e83fe02da9c76b56f6fd286eace282eaad6d8d497e17b3ec4059020a/analysis/1550866309/ — Malicious Documents
* [Payload delivery] text: 22/58 — Malicious Documents

### file — File object describing a file with meta-information
* [Payload delivery] md5: <md5> — Malicious Documents
* [Payload delivery] sha1: <sha1> — Malicious Documents
* [Payload delivery] sha256: <sha256> — Malicious Documents

### virustotal-report — VirusTotal report
* [Other] datetime: 2019-02-22T20:04:58 — Malicious Documents
* [Payload delivery] link: https://www.virustotal.com/file/2b6dc1a826a4d5d5de5a30b458e6ed995a4cfb9cad8114d1197541a86905d60e/analysis/1550865898/ — Malicious Documents
* [Payload delivery] text: 21/55 — Malicious Documents

### file — File object describing a file with meta-information
* [Payload delivery] md5: <md5> — Malicious Documents
* [Payload delivery] sha1: <sha1> — Malicious Documents
* [Payload delivery] sha256: <sha256> — Malicious Documents

### virustotal-report — VirusTotal report
* [Other] datetime: 2019-02-22T20:10:06 — Malicious Documents
* [Payload delivery] link: https://www.virustotal.com/file/331d17dbe4ee61d8f2c91d7e4af17fb38102003663872223efaa4a15099554d7/analysis/1550866206/ — Malicious Documents
* [Payload delivery] text: 9/61 — Malicious Documents

### file — File object describing a file with meta-information
* [Payload delivery] md5: <md5> — Malicious Documents
* [Payload delivery] sha1: <sha1> — Malicious Documents
* [Payload delivery] sha256: <sha256> — Malicious Documents

### virustotal-report — VirusTotal report
* [Other] datetime: 2019-02-22T20:03:34 — Malicious Documents
* [Payload delivery] link: https://www.virustotal.com/file/9d842c9c269345cd3b2a9ce7d338a03ffbf3765661f1ee6d5e178f40d409c3f8/analysis/1550865814/ — Malicious Documents
* [Payload delivery] text: 22/60 — Malicious Documents

### file — File object describing a file with meta-information
* [Payload delivery] md5: <md5> — Malicious Documents
* [Payload delivery] sha1: <sha1> — Malicious Documents
* [Payload delivery] sha256: <sha256> — Malicious Documents

### virustotal-report — VirusTotal report
* [Other] datetime: 2019-02-22T20:08:55 — Malicious Documents
* [Payload delivery] link: https://www.virustotal.com/file/8ef4bc09a9534910617834457114b9217cac9cb33ae22b37889040cde4cabea6/analysis/1550866135/ — Malicious Documents
* [Payload delivery] text: 23/60 — Malicious Documents

### file — File object describing a file with meta-information
* [Payload delivery] md5: <md5> — PE version loader, signed with stolen certificate:
* [Payload delivery] sha1: <sha1> — PE version loader, signed with stolen certificate:
* [Payload delivery] sha256: <sha256> — PE version loader, signed with stolen certificate:

### virustotal-report — VirusTotal report
* [Other] datetime: 2019-02-22T20:15:46 — PE version loader, signed with stolen certificate:
* [Payload delivery] link: https://www.virustotal.com/file/6f76a8e16908ba2d576cf0e8cdb70114dcb70e0f7223be10aab3a728dc65c41c/analysis/1550866546/ — PE version loader, signed with stolen certificate:
* [Payload delivery] text: 15/68 — PE version loader, signed with stolen certificate:
