# Threat Report: 2022-02-08: Indicators of Compromise Associated with LockBit 2.0 Ransomware


## Key Intelligence
* Date: 2022-02-08
* Threat Level: 2 (Medium)
* Tags: tlp:white, misp-galaxy:ransomware="LockBit", misp-galaxy:mitre-attack-pattern="Data Encrypted for Impact - T1486"

---

## Indicators of Compromise (IOCs)
### External analysis
* link: https://www.cisa.gov/uscert/ncas/current-activity/2022/02/07/fbi-releases-indicators-compromise-associated-lockbit-20
* link: https://www.ic3.gov/Media/News/2022/220204.pdf

### Network activity
* ip-dst: 139.60.160.200
* ip-dst: 93.190.139.223
* ip-dst: 45.227.255.190
* ip-dst: 193.162.143.218
* ip-dst: 168.100.11.72
* ip-dst: 93.190.143.101
* ip-dst: 88.80.147.102
* ip-dst: 193.38.235.234
* ip-dst: 174.138.62.35
* ip-dst: 185.215.113.39
* ip-dst: 185.182.193.120
* url: http://185.182.193.120/06599379103BD9028AB56AE0EBED457D0 — Stealbit URL Example

### Other
* comment: .lockbit — Extension
* text: Restore-My-Files.txt — LockBit 2.0 Ransom Note
* comment: After a host establishes a connection to one of the command and control servers, a HTTP PUT
request with hexadecimal value and a length of 32 or 33 characters is sent to the command and
control server.
For example, PUT /06599379103BD9028AB56AE0EBED457D0 HTTP/1.1 — Network Indicators
* comment: ping 127.0.0.7 –n 7 > Nul & fsutil file setZeroData offset=0 length=<Stealbit file size>< Stealbit
file path > & Del /f /q <Stealbit executable> — Self-Delete Command
* comment: STEALBIT-MASTER-PIPE — Named Pipe
* comment: LockBit 2.0 operates as an affiliate-based Ransomware-as-a-Service (RaaS) and employs a wide
variety of tactics, techniques, and procedures (TTPs), creating significant challenges for defense
and mitigation. LockBit 2.0 ransomware compromises victim networks through a variety of
techniques, including, but not limited to, purchased access, unpatched vulnerabilities, insider
access, and zero day exploits.
After compromising a victim network, LockBit 2.0 actors use publicly available tools such as
Mimikatz to escalate privileges. The threat actors then use both publicly available and custom
tools to exfiltrate data followed by encryption using the Lockbit malware. The actors always
leave a ransom note in each affected directory within victim systems, which provides
instructions on how to obtain the decryption software. The ransom note also threatens to leak
exfiltrated victim data on the LockBit 2.0 leak site and demands a ransom to avoid these
actions.
In July 2021, LockBit 2.0 released an update which featured the automatic encryption of devices
across windows domains by abusing Active Directory group policies. In August 2021, LockBit 2.0
began to advertise for insiders to establish initial access into potential victim networks, while
promising a portion of the proceeds from a successful attack. LockBit 2.0 also developed a
Linux-based malware which takes advantage of vulnerabilities within VMWare ESXi virtual
machines. — Summary
* comment: LockBit 2.0 is best described as a heavily obfuscated ransomware application leveraging bitwise
operations to decode strings and load required modules to evade detection. Upon launch,
LockBit 2.0 decodes the necessary strings and code to import the required modules followed by
determining if the process has administrative privileges. If privileges are not sufficient, it
attempts to escalate to the required privileges. Lockbit 2.0 then determines the system and
user language settings and only targets those not matching a set list of languages that are
Eastern European. If an Eastern European language is detected, the program exits without
infection. As infection begins, Lockbit 2.0 deletes log files and shadow copies residing on disk.
Lockbit 2.0 enumerates system information to include hostname, host configuration, domain
information, local drive configuration, remote shares, and mounted external storage devices.
Lockbit 2.0 attempts to encrypt any data saved to any local or remote device but skips files
associated with core system functions. Once completed, Lockbit 2.0 deletes itself from disk and
creates persistence at startup.
Prior to encryption, Lockbit affiliates primarily use the Stealbit application obtained directly
from the Lockbit panel to exfiltrate specific file types. The desired file types can be configured
by the affiliate to tailor the attack to the victim. The affiliate configures the application to target
a desired file path and, upon execution, the tool copies the files to an attacker-controlled server
using http. Due to the nature of the affiliate model, some attackers use other commercially
available tools such as rclone and MEGAsync to achieve the same results. Lockbit 2.0 actors
often use publicly available file sharing services including, privatlab[.]net, anonfiles[.]com,
sendspace[.]com, fex[.]net, transfer[.]sh, and send.exploit[.]in. While some of these
applications and services can support legitimate purposes, they can also be used by threat
actors to aid in system compromise or exploration of an enterprise. — Technical details

### Payload delivery
* attachment: 220204.pdf — FBI Flash
* filename: %USERPROFILE%\Desktop\LockBit_Ransomware.hta — Files created
* filename: %WINDIR%\SysWOW64\<First 6 characters of Decryption ID> — Files created
* filename: %TEMP%\<LockBit 2.0 wallpaper> .tmp.bmp — Files created

## Objects
### command-line — Command line and options related to a specific command executed by a program, whether it is malicious or not.
* [Other] text: Description: Deletes Shadow Copies
* [Other] text: cmd.exe /c vssadmin Delete Shadows /All /Quiet

### command-line — Command line and options related to a specific command executed by a program, whether it is malicious or not.
* [Other] text: Description: Disables Win 10 recovery
* [Other] text: cmd.exe /c bcdedit /set {default} recoveryenabled No

### command-line — Command line and options related to a specific command executed by a program, whether it is malicious or not.
* [Other] text: Description: Ignore boot failures
* [Other] text: cmd.exe /c bcdedit /set {default} bootstatuspolicy ignoreallfailures

### command-line — Command line and options related to a specific command executed by a program, whether it is malicious or not.
* [Other] text: Description: This command has an invalid syntax and errors out
* [Other] text: cmd.exe /c wmic SHADOWCOPY /nointeractive

### command-line — Command line and options related to a specific command executed by a program, whether it is malicious or not.
* [Other] text: Description: Deletes security log
* [Other] text: cmd.exe /c wevtutil cl security

### command-line — Command line and options related to a specific command executed by a program, whether it is malicious or not.
* [Other] text: Description: Deletes system log
* [Other] text: cmd.exe /c wevtutil cl system

### command-line — Command line and options related to a specific command executed by a program, whether it is malicious or not.
* [Other] text: Description: Deletes application log
* [Other] text: cmd.exe /c wevtutil cl application

### command-line — Command line and options related to a specific command executed by a program, whether it is malicious or not.
* [Other] text: Description: Wipes and deletes itself
* [Other] text: cmd.exe "%WINDIR%\System32\cmd.exe" /C ping 127.0.0.7 -n 3 >Nul&fsutil file
setZeroData offset=0 length=524288 "%USERPROFILE%\Desktop\Lsystem-234-bit.exe" & Del /f
/q "%USERPROFILE%\Desktop\Lsystem-234-bit.exe"

### command-line — Command line and options related to a specific command executed by a program, whether it is malicious or not.
* [Other] text: Description: Lockbit 2.0 deletes all shadow copies on disc to prevent data recovery
* [Other] text: cmd.exe "%WINDIR%\System32\cmd.exe" /c vssadmin delete shadows /all /quiet & wmic
shadowcopy delete & bcdedit /set {default} bootstatuspolicy ignoreallfailures & bcdedit /set
{default} recoveryenabled no

### registry-key — Registry key object describing a Windows registry key with value and last-modified timestamp
* [Persistence mechanism] text: <LockBit 2.0 Ransomware path>
* [Persistence mechanism] regkey: HKEY_LOCAL_MACHINE\SOFTWARE\WOW6432Node\Microsoft\Windows NT\CurrentVersion\ICM\Calibration\|Display Calibrator

### registry-key — Registry key object describing a Windows registry key with value and last-modified timestamp
* [Persistence mechanism] text: "%WINDIR%\system32\mshta.exe" "%USERPROFILE%\Desktop\LockBit_Ransomware.hta"
* [Persistence mechanism] regkey: HKEY_CLASSES_ROOT\Lockbit\shell\Open\Command\

### registry-key — Registry key object describing a Windows registry key with value and last-modified timestamp
* [Persistence mechanism] text: %WINDIR%\<First 6 characters of LockBit 2.0 Decryption ID>.ico
* [Persistence mechanism] regkey: HKEY_CLASSES_ROOT\Lockbit\DefaultIcon

### registry-key — Registry key object describing a Windows registry key with value and last-modified timestamp
* [Persistence mechanism] text: %USERPROFILE%\Desktop\LockBit_Ransomware.hta
* [Persistence mechanism] regkey: HKEY_CURENT_USER\Software\Microsoft\Windows\CurrentVersion\Run\{GUID}

### registry-key — Registry key object describing a Windows registry key with value and last-modified timestamp
* [Persistence mechanism] regkey: %USERPROFILE%\Desktop\LockBit_Ransomware.hta — Created - Encryption

### registry-key — Registry key object describing a Windows registry key with value and last-modified timestamp
* [Persistence mechanism] regkey: HKEY_CURRENT_USER\Software\< LockBit 2.0 ID >\Public — Created - Encryption

### registry-key — Registry key object describing a Windows registry key with value and last-modified timestamp
* [Persistence mechanism] regkey: HKEY_LOCAL_MACHINE\Software\Classes\.lockbit\DefaultIcon — Created - LockBit 2.0 Icon Location

### registry-key — Registry key object describing a Windows registry key with value and last-modified timestamp
* [Persistence mechanism] text: %APPDATA%\Local\Temp\<LockBit 2.0 wallpaper>.tmp.bmp
* [Persistence mechanism] regkey: HKEY_CURRENT_USER\Control Panel\Desktop

### command-line — Command line and options related to a specific command executed by a program, whether it is malicious or not.
* [Other] text: PowerShell Command – Force GPO Policy
* [Other] text: powershell.exe -Command “Get-ADComputer -filter * -Searchbase ‘%s’ | foreach{ InvokeGPUpdate -computer $_.name -force -RandomDelayInMinutes 0}”

### command-line — Command line and options related to a specific command executed by a program, whether it is malicious or not.
* [Other] text: Anti-Recovery Command
* [Other] text: %WINDIR%\System32\cmd.exe /c vssadmin delete shadows /all /quiet & wmic shadowcopy
delete & bcdedit /set {default} bootstatuspolicy ignoreallfailures & bcdedit /set {default}
recoveryenabled no
