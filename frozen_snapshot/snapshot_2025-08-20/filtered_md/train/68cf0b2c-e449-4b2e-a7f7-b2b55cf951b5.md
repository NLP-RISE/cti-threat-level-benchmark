# Threat Report: 2023-04-13: SNOWYAMBER - Malware Analysis Report


## Key Intelligence
* Date: 2023-04-13
* Threat Level: 1 (High)
* Tags: type:OSINT, osint:lifetime="perpetual", osint:certainty="50", tlp:white, tlp:clear, misp-galaxy:tool="SNOWYAMBER", misp-galaxy:mitre-attack-pattern="Virtual Private Server - T1583.003", misp-galaxy:mitre-attack-pattern="Web Services - T1583.006", misp-galaxy:mitre-attack-pattern="Compromise Infrastructure - T1584", misp-galaxy:mitre-attack-pattern="Phishing - T1566", misp-galaxy:mitre-attack-pattern="Spearphishing Attachment - T1566.001", misp-galaxy:mitre-attack-pattern="Spearphishing Link - T1566.002", misp-galaxy:mitre-attack-pattern="User Execution - T1204", misp-galaxy:mitre-attack-pattern="Malicious File - T1204.002", misp-galaxy:mitre-attack-pattern="Malicious Link - T1204.001", misp-galaxy:mitre-attack-pattern="Registry Run Keys / Startup Folder - T1547.001", misp-galaxy:mitre-attack-pattern="DLL Search Order Hijacking - T1574.001", misp-galaxy:mitre-attack-pattern="DLL Side-Loading - T1574.002", misp-galaxy:mitre-attack-pattern="HTML Smuggling - T1027.006", misp-galaxy:mitre-attack-pattern="Right-to-Left Override - T1036.002", misp-galaxy:mitre-attack-pattern="Deobfuscate/Decode Files or Information - T1140", misp-galaxy:mitre-attack-pattern="Mark-of-the-Web Bypass - T1553.005", misp-galaxy:mitre-attack-pattern="Web Service - T1102", misp-galaxy:mitre-attack-pattern="One-Way Communication - T1102.003"

---

## Indicators of Compromise (IOCs)
### External analysis
* attachment: PhishMailImpers1.png — phishing email mimicking diplomatic correspondence. The link hidden under “here” leads to the ENVYSCOUT

### Network activity
* url: totalmassasje.no/schedule.php — ENVYSCOUT delivering SNOWYAMBER ZIP
* url: signitivelogics.com/Schedule.html — ENVYSCOUT delivering SNOWYAMBER ISO
* url: humanecosmetics.com/category/noteworthy/6426-7346-9789 — Cobalt Strike Team Server
* url: signitivelogics.com/BMW.html — ENVYSCOUT delivering SNOWYAMBER ISO
* domain: badriatimimi.com — BRUTERATEL C2
* url: literaturaelsalvador.com/Instructions.html — ENVYSCOUT delivering SNOWYAMBER ZIP
* url: literaturaelsalvador.com/Schedule.html — ENVYSCOUT delivering SNOWYAMBER ISO
* url: parquesanrafael.cl/note.html — ENVYSCOUT URL
* url: inovaoftalmologia.com.br/form.html — ENVYSCOUT URL

### Payload delivery
* email-src: miodrag.sekulic@mod.gov.rs — Used to distribute phishing emails with a link to ENVYSCOUT
* email-src: bohuslava.kopalova@seznam.cz — Used to distribute phishing emails with a link to ENVYSCOUT
* email-src: navratilova.lucie.etnologie@seznam.cz — Used to distribute phishing emails with a link to i.php (reconnaissance?)
* email-src: zdenek.holych@seznam.cz — Used to distribute phishing emails with a link to ENVYSCOUT

## Objects
### report — Metadata used to generate an executive level report
* [External analysis] link: https://www.gov.pl/attachment/ee91f24d-3e67-436d-aa50-7fa56acf789d
* [Other] text: SNOWYAMBER is a dropper that was used in an espionage campaign significantly overlapping with publicly described activity linked to the APT29 and NOBELIUM activity sets. SNOWYAMBER abuses the NOTION collaboration service as a communication channel. It does not contain any other capabilities aside from downloading and executing 2nd stage. To bypass security products, SNOWYAMBER uses several antidetection and obfuscation techniques, including string encryption, dynamic API resolving, EDR/AV unhooking, and direct syscalls.
* [Other] text: Report
* [External analysis] attachment: SNOWYAMBER_.pdf

### file — File object describing a file with meta-information
* [Payload delivery] filename: vcruntime140.dll

### file — File object describing a file with meta-information
* [Payload delivery] filename: schedule.zip

### file — File object describing a file with meta-information
* [Payload delivery] filename: 7za.dll
* [Other] size-in-bytes: 270336
* [Payload delivery] sha1: <sha1>
* [Payload delivery] md5: <md5>
* [Payload delivery] sha256: <sha256>

### file — File object describing a file with meta-information
* [Payload delivery] filename: november_schedulexe.pdf

### file — File object describing a file with meta-information
* [Payload delivery] filename: Instructions.lnk

### file — File object describing a file with meta-information
* [Payload delivery] filename: BugSplatRc64.dll
* [Payload delivery] sha1: <sha1>
* [Payload delivery] md5: <md5>
* [Payload delivery] sha256: <sha256>
* [Other] size-in-bytes: 271360

### yara — An object describing a YARA rule (or a YARA rule name) along with its version.
* [Payload installation] yara: rule APT29_SNOWYAMBER
{
meta:
description = "Detects APT29-linked SNOWYAMBER dropper"
strings:
// Payload decryption loop
// Custom algorithm based on XOR
$op_decrypt_payload = {49 8B 45 08 48 ?? ?? ?? 48 39 ?? 76 2B 48 89 C8 31 D2 4C 8B 4C 24 ?? 48 F7 74 24 ?? 49 8B 45
00 41 8A 14 11 32 54 08 10 89 C8 41 0F AF C0 31 C2 88 14 0B 48 FF C1}
// Decryption routine generated by Obfuscate library
$op_decrypt_string = {48 39 D0 74 19 48 89 C1 4D 89 C2 83 E1 07 48 C1 E1 03 49 D3 EA 45 30 14 01 48 FF C0 EB E2}
// Hardcoded inital value used as beaconing counter
$op_initialize_emoji = {C6 [3] A5 66 [4] F0 9F}
// src/json.hpp - string left in binary using nlohmann JSON
$str_nlohmann = {73 72 63 2F 6A 73 6F 6E 2E 68 70 70 00}
condition:
uint16(0) == 0x5A4D
and
filesize < 500KB
and
$str_nlohmann
and
$op_decrypt_string
and
($op_initialize_emoji or $op_decrypt_payload)
}
* [Other] text: APT29_SNOWYAMBER

### file — File object describing a file with meta-information
* [Payload delivery] sha1: <sha1>
* [Payload delivery] md5: <md5>
* [Payload delivery] sha256: <sha256>
* [Payload delivery] filename: BugSplatRc64.dll
* [Other] size-in-bytes: 301056

### file — File object describing a file with meta-information
* [Payload delivery] sha1: <sha1>
* [Payload delivery] md5: <md5>
* [Payload delivery] sha256: <sha256>
* [Payload delivery] filename: hXaIk1725.pdf
* [Other] size-in-bytes: 261635

### file — File object describing a file with meta-information
* [Payload delivery] sha1: <sha1>
* [Payload delivery] md5: <md5>
* [Payload delivery] sha256: <sha256>
* [Payload delivery] filename: hXaIk1314.pdf
* [Other] size-in-bytes: 347837
