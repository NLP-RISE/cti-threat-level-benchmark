# Threat Report: 2021-02-15: HAFNIUM targeting Exchange Servers with 0-day exploits


## Key Intelligence
* Date: 2021-02-15
* Threat Level: 1 (High)
* Tags: tlp:white

---

## Indicators of Compromise (IOCs)
### External analysis
* link: https://us-cert.cisa.gov/ncas/alerts/aa21-062a
* link: https://blogs.microsoft.com/on-the-issues/2021/03/02/new-nation-state-cyberattacks/
* link: https://www.microsoft.com/security/blog/2021/03/02/hafnium-targeting-exchange-servers/
* link: https://github.com/microsoft/CSS-Exchange/tree/main/Security
* link: https://web.archive.org/web/20210310164403/https://gist.github.com/testanull/fabd8eeb46f120c4b15f8793617ca7d1
* link: https://www.domaintools.com/resources/blog/examining-exchange-exploitation-and-its-lessons-for-defenders — Examining Exchange Exploitation and its Lessons for Defenders

### Network activity
* ip-dst: 103.77.192.219
* ip-dst: 104.140.114.110
* ip-dst: 104.250.191.110
* ip-dst: 108.61.246.56
* ip-dst: 149.28.14.163
* ip-dst: 157.230.221.198
* ip-dst: 167.99.168.251
* ip-dst: 185.250.151.72
* ip-dst: 192.81.208.169
* ip-dst: 203.160.69.66
* ip-dst: 211.56.98.146
* ip-dst: 5.254.43.18
* ip-dst: 5.2.69.14
* ip-dst: 80.92.205.81
* ip-dst: 91.192.103.43
* ip-dst: 104.248.49.97
* ip-dst: 112.66.255.71
* ip-dst: 139.59.56.239
* ip-dst: 161.35.1.207
* ip-dst: 161.35.1.225
* ip-dst: 161.35.45.41
* ip-dst: 161.35.51.41
* ip-dst: 161.35.76.1
* ip-dst: 167.99.239.29
* ip-dst: 165.232.154.116
* ip-dst: 182.18.152.105
* ip-dst: 188.166.162.201
* ip-dst: 194.87.69.35
* ip-dst: 45.77.252.175
* ip-dst: 77.61.36.169
* ip-dst: 86.105.18.116
* ip-dst: 89.34.111.11

### Payload delivery
* user-agent: antSword/v2.1
* user-agent: Googlebot/2.1+(+http://www.googlebot.com/bot.html)
* user-agent: Mozilla/5.0 (compatible;+Baiduspider/2.0;++http://www.baidu.com/search/spider.html)
* user-agent: DuckDuckBot/1.0;+(+http://duckduckgo.com/duckduckbot.html)
* user-agent: facebookexternalhit/1.1+(+http://www.facebook.com/externalhit_uatext.php)
* user-agent: Mozilla/5.0+(compatible;+Baiduspider/2.0;++http://www.baidu.com/search/spider.html)
* user-agent: Mozilla/5.0+(compatible;+Bingbot/2.0;++http://www.bing.com/bingbot.htm)
* user-agent: Mozilla/5.0+(compatible;+Googlebot/2.1;++http://www.google.com/bot.html
* user-agent: Mozilla/5.0+(compatible;+Konqueror/3.5;+Linux)+KHTML/3.5.5+(like+Gecko)+(Exabot-Thumbnails)
* user-agent: Mozilla/5.0+(compatible;+Yahoo!+Slurp;+http://help.yahoo.com/help/us/ysearch/slurp)
* user-agent: Mozilla/5.0+(compatible;+YandexBot/3.0;++http://yandex.com/bots)
* user-agent: Mozilla/5.0+(X11;+Linux+x86_64)+AppleWebKit/537.36+(KHTML,+like+Gecko)+Chrome/51.0.2704.103+Safari/537.36
* sha256: <sha256>
* sha256: <sha256>
* sha256: <sha256>
* sha256: <sha256>
* sha256: <sha256>
* sha256: <sha256>
* sha256: <sha256>
* sha256: <sha256>
* yara: rule webshell_aspx_sportsball : Webshell Unclassified
{
    meta:
        author = â€œthreatintel@volexity.comâ€
        date = â€œ2021-03-01â€
        description = â€œThe SPORTSBALL webshell allows attackers to upload files or execute commands on the system.â€
        hash = â€œ2fa06333188795110bba14a482020699a96f76fb1ceb80cbfa2df9d3008b5b0aâ€
 
    strings:
        $uniq1 = â€œHttpCookie newcook = new HttpCookie(\â€fqrspt\â€, HttpContext.Current.Request.Formâ€
        $uniq2 = â€œZN2aDAB4rXsszEvCLrzgcvQ4oi5J1TuiRULlQbYwldE=â€
 
        $var1 = â€œResult.InnerText = string.Empty;â€
        $var2 = â€œnewcook.Expires = DateTime.Now.AddDays(â€
        $var3 = â€œSystem.Diagnostics.Process process = new System.Diagnostics.Process();â€
        $var4 = â€œprocess.StandardInput.WriteLine(HttpContext.Current.Request.Form[\â€â€
        $var5 = â€œelse if (!string.IsNullOrEmpty(HttpContext.Current.Request.Form[\â€â€
        $var6 = â€œ<input type=\â€submit\â€ value=\â€Upload\â€ />â€
 
    condition:
        any of ($uniq*) or
        all of ($var*)
}
* yara: rule webshell_aspx_reGeorgTunnel : Webshell Commodity
{
    meta:
        author = â€œthreatintel@volexity.comâ€
        date = â€œ2021-03-01â€
        description = â€œA variation on the reGeorg tunnel webshellâ€
        hash = â€œ406b680edc9a1bb0e2c7c451c56904857848b5f15570401450b73b232ff38928â€
        reference = â€œhttps://github.com/sensepost/reGeorg/blob/master/tunnel.aspxâ€
 
    strings:
        $s1 = â€œSystem.Net.Socketsâ€
        $s2 = â€œSystem.Text.Encoding.Default.GetString(Convert.FromBase64String(StrTr(Request.Headers.Getâ€
        // a bit more experimental
        $t1 = â€œ.Split(â€˜|â€™)â€
        $t2 = â€œRequest.Headers.Getâ€
        $t3 = â€œ.Substring(â€œ
        $t4 = â€œnew Socket(â€œ
        $t5 = â€œIPAddress ip;â€
 
    condition:
        all of ($s*) or
        all of ($t*)
}
* yara: rule webshell_aspx_simpleseesharp : Webshell Unclassified
{
    meta:
        author = â€œthreatintel@volexity.comâ€
        date = â€œ2021-03-01â€
        description = â€œA simple ASPX Webshell that allows an attacker to write further files to disk.â€
        hash = â€œ893cd3583b49cb706b3e55ecb2ed0757b977a21f5c72e041392d1256f31166e2â€
 
    strings:
        $header = â€œ<%@ Page Language=\â€C#\â€ %>â€
        $body = â€œ<% HttpPostedFile thisFile = Request.Files[0];thisFile.SaveAs(Path.Combineâ€
 
    condition:
        $header at 0 and
        $body and
        filesize < 1KB
}
* vulnerability: CVE-2021-26855
* vulnerability: CVE-2021-26857
* vulnerability: CVE-2021-26858
* vulnerability: CVE-2021-27065

### Support Tool
* attachment: poc_proxylogon.py — PoC script from https://web.archive.org/web/20210310164403/https://gist.github.com/testanull/fabd8eeb46f120c4b15f8793617ca7d1
