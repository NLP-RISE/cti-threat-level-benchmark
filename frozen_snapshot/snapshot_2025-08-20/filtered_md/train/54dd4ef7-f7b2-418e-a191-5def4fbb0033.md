# Threat Report: 2023-01-09: Turla: A Galaxy of Opportunity


## Key Intelligence
* Date: 2023-01-09
* Threat Level: 1 (High)
* Tags: misp-galaxy:malpedia="Andromeda", misp-galaxy:malpedia="KopiLuwak", tlp:white, misp-galaxy:mitre-attack-pattern="Application Window Discovery - T1010", misp-galaxy:mitre-attack-pattern="File Deletion - T1070.004", misp-galaxy:mitre-attack-pattern="Hidden Window - T1564.003", misp-galaxy:mitre-attack-pattern="Modify Registry - T1112", misp-galaxy:mitre-attack-pattern="Obfuscated Files or Information - T1027", misp-galaxy:mitre-attack-pattern="Process Discovery - T1057", misp-galaxy:mitre-attack-pattern="Process Injection - T1055", misp-galaxy:mitre-attack-pattern="Query Registry - T1012", misp-galaxy:mitre-attack-pattern="Registry Run Keys / Startup Folder - T1547.001", misp-galaxy:mitre-attack-pattern="System Network Connections Discovery - T1049", misp-galaxy:mitre-attack-pattern="System Owner/User Discovery - T1033", misp-galaxy:mitre-attack-pattern="Archive Collected Data - T1560", misp-galaxy:mitre-attack-pattern="Archive via Utility - T1560.001", misp-galaxy:mitre-attack-pattern="Asymmetric Cryptography - T1573.002", misp-galaxy:mitre-attack-pattern="Compromise Infrastructure - T1584", misp-galaxy:mitre-attack-pattern="File and Directory Discovery - T1083", misp-galaxy:mitre-attack-pattern="Install Digital Certificate - T1608.003", misp-galaxy:mitre-attack-pattern="Software Discovery - T1518", misp-galaxy:mitre-attack-pattern="System Information Discovery - T1082", misp-galaxy:mitre-attack-pattern="System Shutdown/Reboot - T1529", misp-galaxy:mitre-attack-pattern="Web Protocols - T1071.001", misp-galaxy:mitre-intrusion-set="Turla - G0010"

---

## Indicators of Compromise (IOCs)
### Network activity
* hostname: manager.surro.am — KOPILUWAK C2
* ip-dst|port: 194.67.209.186|443 — QUIETCANARY C2

### Payload delivery
* yara: rule M_APT_Kopiluwak_Recon_1

{

    meta:

        author = "Mandiant"

    strings:

        $rc4_1 = ".charCodeAt(i %"

        $rc4_2 = ".length)) % 256"

        $b64_1 = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"

        $b64_3 = ".charAt(parseInt("

        $recon_1 = "WScript.CreateObject"

        $recon_2 = ".Run("

        $Arguments = "WScript.Arguments"

    condition:

        ($rc4_1 and $rc4_2 and $b64_1) and ($Arguments or ($b64_3 and $recon_1 and $recon_2))

} — KOPILUWAK
* yara: ﻿rule M_HUNTING_QUIETCANARY_STRINGS {

  meta:

        author="Mandiant"

  strings:

    $pdb1 = "c:\\Users\\Scott\\source\\repos\\Kapushka.Client\\BrowserTelemetry\\obj\\Release\\CmService.pdb" ascii wide nocase

    $pdb2 = "c:\\Users\\Scott\\source\\repos\\Kapushka.Client\\BrowserTelemetry\\obj\\Release\\BrowserTelemetry.pdb" ascii wide nocase

    $pdb3 = "c:\\Users\\Scott\\source\\repos\\BrowserTelemetry\\BrowserTelemetry\\obj\\Release\\BrowserTelemetry.pdb" ascii wide nocase

    $orb1 = {  68 00 74 00 74 00 70 00 73 00 3A 00 2F 00 2F }

    $orb2 = {  68 00 74 00 74 00 70 00 3A 00 2F 00 2F }

    $command1 = "get_Command" ascii wide nocase

    $command2 = "set_Command" ascii wide nocase

    $command3 = "DownloadCommand" ascii wide nocase

    $command4 = "UploadCommand"  ascii wide nocase

    $command5 = "AddCommand" ascii wide nocase

    $command6 = "ExeCommand" ascii wide nocase

    $command7 = "KillCommand" ascii wide nocase

    $command8 = "ClearCommand"  ascii wide nocase

      $rc4 = {21 00 62 00 76 00 7A 00 65 00 26 00 78 00 61 00 62 00 72 00 39 00 7C 00 38 00 5B 00 3F 00 78 00 77 00 7C 00 7C 00 79 00 26 00 7A 00 6C 00 23 00 74 00 70 00

6B 00 7A 00 6A 00 5E 00 62 00 39 00 61 00 38 00 6A 00 5D 00 40 00 6D 00 39 00 6E 00 28 00 67 00 67 00 24 00 40 00 74 00 74 00 65 00 33 00 33 00 6E 00 28 00 32 00 72 00 7A

00 62 00 7A 00 69 00 74 00 75 00 31 00 2A 00 66 00 61 00 00 80 E9 4D 00 6F 00 7A 00 69 00 6C 00 6C 00 61 }

  condition:

    (1 of ($pdb*)) and (1 of ($orb*)) and (all of ($command*)) or ($rc4)

} — QUIETCANARY

## Objects
### file — File object describing a file with meta-information
* [Payload delivery] md5: <md5>
* [Payload delivery] filename: TrustedInstaller.exe
* [Other] text: C:\Temp\TrustedInstaller.exe

### file — File object describing a file with meta-information
* [Payload delivery] md5: <md5>
* [Payload delivery] filename: mskmde.com
* [Other] text: %ALLUSERSPROFILE%\Local Settings\Temp\mskmde.com

### file — File object describing a file with meta-information
* [Payload delivery] md5: <md5> — KOPILUWAK
* [Payload delivery] filename: 0171ef74.exe
* [Other] text: %TEMP%\0171ef74.exe

### file — File object describing a file with meta-information
* [Payload delivery] md5: <md5>
* [Payload delivery] filename: xpexplore.js
* [Other] text: %WINDIR%\Temp\xpexplore.js

### file — File object describing a file with meta-information
* [Payload delivery] md5: <md5>
* [Payload delivery] filename: 00c3df3b.exe

### domain-ip — A domain/hostname and IP address seen as a tuple in a specific time frame.
* [Network activity] domain: anam0rph.su — ANDROMEDA C2s
* [Network activity] ip-dst: 212.114.52.24 — ANDROMEDA C2s

### domain-ip — A domain/hostname and IP address seen as a tuple in a specific time frame.
* [Network activity] hostname: yelprope.cloudns.cl — ANDROMEDA injected process “wuauclt.exe” made a GET request to this domain
* [Network activity] ip-dst: 212.114.52.24

### domain-ip — A domain/hostname and IP address seen as a tuple in a specific time frame.
* [Network activity] domain: suckmycocklameavindustry.in — C2 domain ANDROMEDA
* [Network activity] ip-dst: 35.205.61.67

### file — File object describing a file with meta-information
* [Payload delivery] md5: <md5>
* [Payload delivery] filename: file.exe
